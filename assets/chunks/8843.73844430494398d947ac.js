(self.webpackChunk=self.webpackChunk||[]).push([[8843],{"../node_modules/mini-css-extract-plugin/dist/loader.js??clonedRuleSet-13.use[1]!../node_modules/css-loader/dist/cjs.js??clonedRuleSet-13.use[2]!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/postcss-loader/dist/cjs.js??clonedRuleSet-13.use[3]!../node_modules/sass-loader/dist/cjs.js??clonedRuleSet-13.use[4]!../node_modules/vue-loader/lib/index.js??vue-loader-options!../node_modules/unplugin/dist/webpack/loaders/transform.js?unpluginName=unplugin-vue-define-options!./js/components/local/markdown-render.vue?vue&type=style&index=0&id=4b25f452&prod&lang=scss&":function(){},"../node_modules/mini-css-extract-plugin/dist/loader.js??clonedRuleSet-13.use[1]!../node_modules/css-loader/dist/cjs.js??clonedRuleSet-13.use[2]!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/postcss-loader/dist/cjs.js??clonedRuleSet-13.use[3]!../node_modules/sass-loader/dist/cjs.js??clonedRuleSet-13.use[4]!../node_modules/vue-loader/lib/index.js??vue-loader-options!../node_modules/unplugin/dist/webpack/loaders/transform.js?unpluginName=unplugin-vue-define-options!./js/pages/admin/maintenance/_components/task-block.vue?vue&type=style&index=0&id=0b4558fe&prod&lang=scss&":function(){},"./js/pages/admin/maintenance/index.vue":function(v,y,r){"use strict";r.r(y),r.d(y,{default:function(){return oe}});var l=function(){var e=this,s=e._self._c,t=e._self._setupProxy;return s("app-page",{attrs:{actions:[{label:e.$gettext("Check all"),icon:"#reload",handler:()=>e.checkAll(),visible:e.hasTasks}]},scopedSlots:e._u([{key:"default",fn:function(){return[s("app-page-section",{staticClass:"maintenance-blocks-grid"},[s("ui-data-iterator",{attrs:{items:e.tasks,"key-prop":"name","empty-message":e.$gettext("No maintenance tasks available"),"empty-icon":"circle-check","empty-icon-theme":"neutral"},scopedSlots:e._u([{key:"item",fn:function(n){return[s("task-block",{attrs:{task:n,check:e.checks[n.name],fix:e.fixes[n.name]},on:{check:function(c){return e.checkTask(n.name)},fix:function(c){return e.fixTask(n.name)}}})]}}])})],1)]},proxy:!0}])})},k=[],d=r("../node_modules/vue/dist/vue.common.prod.js"),R=r("./js/api/openapi/index.ts"),E=r("../node_modules/runtypes/lib/index.js"),S=r("./js/openapi/web.types.ts");const f=(0,R.$d)(),A=R.an.Default(async o=>{const{data:e}=await f.get("/api/maintenance",o);return e.status==="success"&&E.Array(S.$3).guard(e.data)===!1?f.failure({type:"INVALID_RESPONSE",response:e.data}):e}),I=R.an.Default(async(o,e)=>{const{data:s}=await f.post(`/api/maintenance/${o}/check`,e);return s.status==="success"&&S.OB.guard(s.data)===!1?f.failure({type:"INVALID_RESPONSE",response:s.data}):s}),F=async(o,e)=>{const{data:s}=await f.post(`/api/maintenance/${o}/fix`,e);return s.status==="success"&&S.rf.guard(s.data)===!1?f.failure({type:"INVALID_RESPONSE",response:s.data}):s};var O=function(){var e=this,s=e._self._c,t=e._self._setupProxy;return s("div",{staticClass:"maintenance-block",class:[`--severity-${t.props.task.severity}`]},[s("div",{staticClass:"maintenance-block-header"},[s("h6",{staticClass:"maintenance-block-title",domProps:{textContent:e._s(e.task.title)}}),e._v(" "),s("div",{directives:[{name:"flex-item",rawName:"v-flex-item",value:{grow:!0},expression:"{ grow: true }"}]}),e._v(" "),s("ui-updates-bubble",{attrs:{float:!1,content:t.issues}},[s("span",{staticClass:"maintenance-block-severity",domProps:{textContent:e._s(t.severityLabel)}})])],1),e._v(" "),s("ul",{staticClass:"maintenance-block-steps"},[s("ui-link",{staticClass:"maintenance-block-step",class:{"--active":t.contentType==="description"},on:{click:function(n){t.contentType="description"}}},[s("span",{domProps:{textContent:e._s(t.$gettext("Task"))}})]),e._v(" "),s("ui-icon",{attrs:{id:"arrow-right",size:12}}),e._v(" "),s("ui-link",{staticClass:"maintenance-block-step",class:{"--disabled":!e.check,"--active":t.contentType==="check"},attrs:{disabled:!e.check},on:{click:function(n){t.contentType=e.check?"check":t.contentType}}},[s("span",{domProps:{textContent:e._s(t.$gettext("Check Report"))}})]),e._v(" "),s("ui-icon",{attrs:{id:"arrow-right",size:12}}),e._v(" "),s("ui-link",{staticClass:"maintenance-block-step",class:{"--disabled":!e.fix,"--active":t.contentType==="fix"},attrs:{disabled:!e.fix},on:{click:function(n){t.contentType=e.fix?"fix":t.contentType}}},[s("span",{domProps:{textContent:e._s(t.$gettext("Fix Report"))}})])],1),e._v(" "),s(t.MarkdownRender,{staticClass:"maintenance-block-content scrollbar:primary",attrs:{content:t.content}}),e._v(" "),t.contentType==="description"||t.contentType==="fix"?s("ui-link",{key:"check-button",staticClass:"maintenance-block-action",on:{click:function(n){return t.emit("check")}}},[s("ui-icon",{directives:[{name:"margin",rawName:"v-margin:right",value:1,expression:"1",arg:"right"}],attrs:{id:"reload"}}),e._v(" "),s("span",{domProps:{textContent:e._s(t.$gettext("Check server for issues"))}})],1):e._e(),e._v(" "),t.contentType==="check"&&e.check&&e.check.issues&&e.check.fixable?s("ui-link",{key:"check-button",staticClass:"maintenance-block-action",on:{click:function(n){return t.emit("fix")}}},[s("ui-icon",{directives:[{name:"margin",rawName:"v-margin:right",value:1,expression:"1",arg:"right"}],attrs:{id:"settings"}}),e._v(" "),s("span",{domProps:{textContent:e._s(t.$gettextInterpolate(t.$ngettext("Fix %{ n } issue","Fix %{ n } issues",e.check.issues),{n:e.check.issues}))}})],1):e._e()],1)},Z=[],P=r("./js/composables/gettext.ts"),D=function(){var e=this,s=e._self._c,t=e._self._setupProxy;return s("div",{staticClass:"markdown-body",domProps:{innerHTML:e._s(t.renderedText)}})},z=[],H={"":["<em>","</em>"],_:["<strong>","</strong>"],"*":["<strong>","</strong>"],"~":["<s>","</s>"],"\n":["<br />"]," ":["<br />"],"-":["<hr />"]};function L(o){return o.replace(RegExp("^"+(o.match(/^(\t| )+/)||"")[0],"gm"),"")}function x(o){return(o+"").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function C(o,e){var s,t,n,c,a,p=/((?:^|\n+)(?:\n---+|\* \*(?: \*)+)\n)|(?:^``` *(\w*)\n([\s\S]*?)\n```$)|((?:(?:^|\n+)(?:\t|  {2,}).+)+\n*)|((?:(?:^|\n)([>*+-]|\d+\.)\s+.*)+)|(?:!\[([^\]]*?)\]\(([^)]+?)\))|(\[)|(\](?:\(([^)]+?)\))?)|(?:(?:^|\n+)([^\s].*)\n(-{3,}|={3,})(?:\n+|$))|(?:(?:^|\n+)(#{1,6})\s*(.+)(?:\n+|$))|(?:`([^`].*?)`)|(  \n\n*|\n{2,}|__|\*\*|[_*]|~~)/gm,i=[],u="",m=e||{},j=0;function N(_){var g=H[_[1]||""],h=i[i.length-1]==_;return g?g[1]?(h?i.pop():i.push(_),g[0|h]):g[0]:_}function M(){for(var _="";i.length;)_+=N(i[i.length-1]);return _}for(o=o.replace(/^\[(.+?)\]:\s*(.+)$/gm,function(_,g,h){return m[g.toLowerCase()]=h,""}).replace(/^\n+|\n+$/g,"");n=p.exec(o);)t=o.substring(j,n.index),j=p.lastIndex,s=n[0],t.match(/[^\\](\\\\)*\\$/)||((a=n[3]||n[4])?s='<pre class="code '+(n[4]?"poetry":n[2].toLowerCase())+'"><code'+(n[2]?' class="language-'+n[2].toLowerCase()+'"':"")+">"+L(x(a).replace(/^\n+|\n+$/g,""))+"</code></pre>":(a=n[6])?(a.match(/\./)&&(n[5]=n[5].replace(/^\d+/gm,"")),c=C(L(n[5].replace(/^\s*[>*+.-]/gm,""))),a==">"?a="blockquote":(a=a.match(/\./)?"ol":"ul",c=c.replace(/^(.*)(\n|$)/gm,"<li>$1</li>")),s="<"+a+">"+c+"</"+a+">"):n[8]?s='<img src="'+x(n[8])+'" alt="'+x(n[7])+'">':n[10]?(u=u.replace("<a>",'<a href="'+x(n[11]||m[t.toLowerCase()])+'">'),s=M()+"</a>"):n[9]?s="<a>":n[12]||n[14]?s="<"+(a="h"+(n[14]?n[14].length:n[13]>"="?1:2))+">"+C(n[12]||n[15],m)+"</"+a+">":n[16]?s="<code>"+x(n[16])+"</code>":(n[17]||n[1])&&(s=N(n[17]||"--"))),u+=t,u+=s;return(u+o.substring(j)+M()).replace(/^\n+|\n+$/g,"")}var U=(0,d.defineComponent)({__name:"markdown-render",props:{content:null},setup(o){const e=o,s=(0,d.computed)(()=>C(e.content));return{__sfc:!0,props:e,renderedText:s}}}),V=U,ae=r("../node_modules/vue-style-loader/index.js!../node_modules/mini-css-extract-plugin/dist/loader.js??clonedRuleSet-13.use[1]!../node_modules/css-loader/dist/cjs.js??clonedRuleSet-13.use[2]!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/postcss-loader/dist/cjs.js??clonedRuleSet-13.use[3]!../node_modules/sass-loader/dist/cjs.js??clonedRuleSet-13.use[4]!../node_modules/vue-loader/lib/index.js??vue-loader-options!../node_modules/unplugin/dist/webpack/loaders/transform.js?unpluginName=unplugin-vue-define-options!./js/components/local/markdown-render.vue?vue&type=style&index=0&id=4b25f452&prod&lang=scss&"),$=r("../node_modules/vue-loader/lib/runtime/componentNormalizer.js"),B=(0,$.Z)(V,D,z,!1,null,null,null),G=B.exports,J=(0,d.defineComponent)({__name:"task-block",props:{task:null,check:null,fix:null},emits:["fix","check"],setup(o,{emit:e}){const s=o,t=(0,d.ref)("description"),{$gettext:n,$ngettext:c,$gettextInterpolate:a}=(0,P.Z)(),p=(0,d.computed)(()=>({low:n("Low severity"),medium:n("Medium severity"),high:n("High severity")})[s.task.severity]),i=(0,d.computed)(()=>s.check&&t.value==="check"?s.check.details:s.fix&&t.value==="fix"?s.fix.details:s.task.description),u=(0,d.computed)(()=>{var m;return!((m=s.check)===null||m===void 0)&&m.issues?a(c("%{ n } issue","%{ n } issues",s.check.issues),{n:s.check.issues}):""});return(0,d.watch)(()=>s.check,()=>{t.value="check"}),(0,d.watch)(()=>s.fix,()=>{t.value="fix"}),{__sfc:!0,props:s,contentType:t,emit:e,$gettext:n,$ngettext:c,$gettextInterpolate:a,severityLabel:p,content:i,issues:u,MarkdownRender:G}}}),K=J,le=r("../node_modules/vue-style-loader/index.js!../node_modules/mini-css-extract-plugin/dist/loader.js??clonedRuleSet-13.use[1]!../node_modules/css-loader/dist/cjs.js??clonedRuleSet-13.use[2]!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/postcss-loader/dist/cjs.js??clonedRuleSet-13.use[3]!../node_modules/sass-loader/dist/cjs.js??clonedRuleSet-13.use[4]!../node_modules/vue-loader/lib/index.js??vue-loader-options!../node_modules/unplugin/dist/webpack/loaders/transform.js?unpluginName=unplugin-vue-define-options!./js/pages/admin/maintenance/_components/task-block.vue?vue&type=style&index=0&id=0b4558fe&prod&lang=scss&"),Q=(0,$.Z)(K,O,Z,!1,null,null,null),W=Q.exports,X=r("./js/composables/notify.ts"),Y=r("./js/composables/useErrorMessages.ts");const b=(0,d.ref)([]),{$gettextInterpolate:q,$gettext:w,$ngettext:ee}=(0,P.Z)(),T=(0,Y.L)({ACCOUNT_NOT_FOUND:w("Account not found"),ACCOUNT_ROLE_MISMATCH:w("Account role mismatch")});var se=(0,d.defineComponent)({components:{TaskBlock:W},async beforeRouteEnter(o,e,s){const{data:t,error:n}=await A();if(n){T(n),s(!1);return}b.value=t||[],s()},emits:[],setup(){const o=(0,d.computed)(()=>b.value.length>0),e=(0,d.ref)({}),s=(0,d.ref)({}),t=async a=>{const{data:p,error:i}=await I(a);if(i){T(i);return}(0,d.set)(e.value,a,p)};return{tasks:b,checks:e,fixes:s,checkTask:t,fixTask:async a=>{const{data:p,error:i}=await F(a);if(i){T(i);return}const{fixed:u,issues:m}=p,j=ee("Fixed %{ fixed } issue","Fixed %{ fixed } issues",u);(0,X.d$)().success({title:w("Maintenance tasks"),content:q(j,{fixed:u})}),(0,d.set)(e.value[a],"issues",m),(0,d.set)(s.value,a,p)},checkAll:()=>{b.value.forEach(a=>{t(a.name)})},hasTasks:o}}}),ne=se,te=(0,$.Z)(ne,l,k,!1,null,null,null),oe=te.exports},"../node_modules/vue-style-loader/index.js!../node_modules/mini-css-extract-plugin/dist/loader.js??clonedRuleSet-13.use[1]!../node_modules/css-loader/dist/cjs.js??clonedRuleSet-13.use[2]!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/postcss-loader/dist/cjs.js??clonedRuleSet-13.use[3]!../node_modules/sass-loader/dist/cjs.js??clonedRuleSet-13.use[4]!../node_modules/vue-loader/lib/index.js??vue-loader-options!../node_modules/unplugin/dist/webpack/loaders/transform.js?unpluginName=unplugin-vue-define-options!./js/components/local/markdown-render.vue?vue&type=style&index=0&id=4b25f452&prod&lang=scss&":function(v,y,r){var l=r("../node_modules/mini-css-extract-plugin/dist/loader.js??clonedRuleSet-13.use[1]!../node_modules/css-loader/dist/cjs.js??clonedRuleSet-13.use[2]!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/postcss-loader/dist/cjs.js??clonedRuleSet-13.use[3]!../node_modules/sass-loader/dist/cjs.js??clonedRuleSet-13.use[4]!../node_modules/vue-loader/lib/index.js??vue-loader-options!../node_modules/unplugin/dist/webpack/loaders/transform.js?unpluginName=unplugin-vue-define-options!./js/components/local/markdown-render.vue?vue&type=style&index=0&id=4b25f452&prod&lang=scss&");l.__esModule&&(l=l.default),typeof l=="string"&&(l=[[v.id,l,""]]),l.locals&&(v.exports=l.locals);var k=r("../node_modules/vue-style-loader/lib/addStylesClient.js").Z,d=k("d2521890",l,!0,{})},"../node_modules/vue-style-loader/index.js!../node_modules/mini-css-extract-plugin/dist/loader.js??clonedRuleSet-13.use[1]!../node_modules/css-loader/dist/cjs.js??clonedRuleSet-13.use[2]!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/postcss-loader/dist/cjs.js??clonedRuleSet-13.use[3]!../node_modules/sass-loader/dist/cjs.js??clonedRuleSet-13.use[4]!../node_modules/vue-loader/lib/index.js??vue-loader-options!../node_modules/unplugin/dist/webpack/loaders/transform.js?unpluginName=unplugin-vue-define-options!./js/pages/admin/maintenance/_components/task-block.vue?vue&type=style&index=0&id=0b4558fe&prod&lang=scss&":function(v,y,r){var l=r("../node_modules/mini-css-extract-plugin/dist/loader.js??clonedRuleSet-13.use[1]!../node_modules/css-loader/dist/cjs.js??clonedRuleSet-13.use[2]!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/postcss-loader/dist/cjs.js??clonedRuleSet-13.use[3]!../node_modules/sass-loader/dist/cjs.js??clonedRuleSet-13.use[4]!../node_modules/vue-loader/lib/index.js??vue-loader-options!../node_modules/unplugin/dist/webpack/loaders/transform.js?unpluginName=unplugin-vue-define-options!./js/pages/admin/maintenance/_components/task-block.vue?vue&type=style&index=0&id=0b4558fe&prod&lang=scss&");l.__esModule&&(l=l.default),typeof l=="string"&&(l=[[v.id,l,""]]),l.locals&&(v.exports=l.locals);var k=r("../node_modules/vue-style-loader/lib/addStylesClient.js").Z,d=k("e34b2902",l,!0,{})}}]);
