"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[3446],{"./js/pages/user/nginx-templates/index.vue":function(w,r,i){i.r(r),i.d(r,{default:function(){return N}});var c=function(){var e=this,t=e._self._c;return t("app-page",{attrs:{actions:[{label:e.$gettext("Add Template"),icon:"#plus-fill",handler:e.addTemplateDialog,visible:!e.isDisabled,theme:"safe"},{label:e.isDisabled?e.$gettext("Enable"):e.$gettext("Disable"),icon:"#console",handler:e.toggleNginxState,theme:e.isDisabled?"safe":"danger"}]},scopedSlots:e._u([{key:"default",fn:function(){return[t("app-page-section",[t("ui-r-table",{attrs:{rows:e.locations,columns:[{id:"location",label:e.$gettext("Location")},{id:"template",label:e.$gettext("Template")}],"checked-rows":e.selectedRows},on:{"update:checkedRows":function(o){e.selectedRows=o}},scopedSlots:e._u([{key:"table:actions",fn:function(){return[t("ui-table-action",{on:{click:e.deleteTemplates}},[t("span",{domProps:{textContent:e._s(e.$gettext("Delete"))}})])]},proxy:!0}])})],1),e._v(" "),t("add-new-template")]},proxy:!0}])})},m=[],s=i("./js/api/command/index.js"),a=i("../node_modules/ramda/es/index.js");const p=a.WAo((n,e)=>a.UID(([t,o])=>({...o,[n]:t}),a.Zpf(e))),l=s.Z.get({url:"/CMD_NGINX_TEMPLATES",id:"NGINX_TEMPLATES",domain:!0,mapResponse:{locations:a.zGw(a.vgT("locations"),p("location")),templates:a.zGw(a.vgT("templates"),p("template")),settings:a.vgT("settings")}}),u=s.Z.post({url:"/CMD_NGINX_TEMPLATES",domain:!0,params:{action:"save"},schema:{location:s.Z.REQUIRED_STRING,nginx_template:s.Z.REQUIRED_STRING}}),_=s.Z.select({url:"/CMD_NGINX_TEMPLATES",domain:!0,params:{action:"delete"}}),g=s.Z.post({url:"/CMD_DOMAIN",domain:!0,params:{action:"modify",only_affect:"nginx"},schema:{state:s.Z.REQUIRED_BOOL},before:({state:n})=>({state:null,nginx:n?"1":"0"})});var x=function(){var e=this,t=e._self._c;return t("ui-dialog",{attrs:{id:"ADD_TEMPLATE_DIALOG",size:"normal",title:e.$gettext("Add Template")},scopedSlots:e._u([{key:"content",fn:function(){return[t("ui-form-element",{attrs:{vertical:"",group:"add-nginx-template",validators:{required:!0}},scopedSlots:e._u([{key:"title",fn:function(){return[t("span",{domProps:{textContent:e._s(e.$gettext("Location"))}})]},proxy:!0},{key:"content",fn:function(){return[t("input-text",{model:{value:e.location,callback:function(o){e.location=o},expression:"location"}})]},proxy:!0}])}),e._v(" "),t("ui-form-element",{attrs:{vertical:""},scopedSlots:e._u([{key:"title",fn:function(){return[t("span",{domProps:{textContent:e._s(e.$gettext("Template"))}})]},proxy:!0},{key:"content",fn:function(){return[t("input-select",{attrs:{options:e.templates},model:{value:e.template,callback:function(o){e.template=o},expression:"template"}})]},proxy:!0}])})]},proxy:!0},{key:"buttons",fn:function(){return[t("ui-button",{attrs:{theme:"safe","validate-group":"add-nginx-template",disabled:!e.template},on:{click:e.addTemplate}},[t("span",{domProps:{textContent:e._s(e.$gettext("Add Template"))}})])]},proxy:!0}])})},f=[],v={api:l,data:()=>({location:"/",template:""}),computed:{templates(){return this.$api.templates.reduce((n,e)=>({[e.template]:e.name,...n}),{})}},watch:{location(n,e){n===""&&e&&this.$nextTick(()=>{this.location=e})}},methods:{async addTemplate(){await u({location:this.location,nginx_template:this.template})instanceof Error||l()}}},h=v,d=i("../node_modules/vue-loader/lib/runtime/componentNormalizer.js"),T=(0,d.Z)(h,x,f,!1,null,null,null),y=T.exports,D={name:"NginxTemplates",preload:l,api:l,components:{AddNewTemplate:y},data:()=>({selectedRows:[]}),computed:{templateNames(){return this.$api.templates.reduce((n,{template:e,name:t})=>({...n,[e]:t}),{})},locations(){return this.$api.locations.map(n=>({...n,template:this.templateNames[n.nginx_template]}))},nginxProxy(){return this.$_flags.server.nginxProxy},settings(){return this.$api.settings},isDisabled(){return this.nginxProxy===!0&&this.settings.nginx_proxy==="1"&&this.settings.domain_nginx==="0"}},methods:{addTemplateDialog(){this.$dialog("ADD_TEMPLATE_DIALOG").open()},async deleteTemplates(){await _({select:this.selectedRows.map(n=>n.location)}),l(),this.selectedRows=[]},async toggleNginxState(){await g({state:this.isDisabled}),l()}}},b=D,E=(0,d.Z)(b,c,m,!1,null,null,null),N=E.exports}}]);
