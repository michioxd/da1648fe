"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[4318],{"./js/api/commands/admin/users/actions.js":function($,p,r){r.d(p,{Ss:function(){return t},Vt:function(){return a},XB:function(){return g},f1:function(){return d},uV:function(){return i},vk:function(){return c}});var o=r("./js/api/command/index.js");const l=o.Z.post({url:"/CMD_SELECT_USERS",notifySuccess:!0,notifyError:!0,params:{location:"CMD_ALL_USER_SHOW"},schema:{select:o.Z.ROWS},blocking:!0}),d=l.extend({params:{dosuspend:!0},schema:{reason:o.Z.REQUIRED_STRING},blocking:!0}),t=l.extend({params:{dounsuspend:!0},blocking:!0}),a=l.extend({params:{delete:!0,confirmed:!0},schema:{leave_dns:o.Z.OPTIONAL_BOOL},blocking:!0}),i=o.Z.post({url:"/CMD_ACCOUNT_ADMIN",params:{action:"create"},schema:{username:o.Z.REQUIRED_STRING,email:o.Z.REQUIRED_STRING,passwd:o.Z.REQUIRED_STRING,passwd2:o.Z.REQUIRED_STRING,notify:o.Z.REQUIRED_BOOL}}),c=o.Z.post({url:"/CMD_COMMENTS",params:{location:"CMD_SHOW_RESELLER"},schema:{user:o.Z.REQUIRED_STRING,comments:o.Z.REQUIRED_STRING}}),g=o.Z.post({url:"/CMD_MOVE_USERS",id:"USERS_COUNT_PER_RESELLER",response:{},after:_=>_.flow(_.getProp("data_list"),_.mapValues(h=>h.length))})},"./js/api/commands/admin/users/index.js":function($,p,r){r.d(p,{R:function(){return l},v:function(){return d}});var o=r("./js/api/command/index.js");const l=o.Z.get({id:"ALL_USERS",url:"/CMD_ALL_USER_SHOW",pagination:!0,params:{bytes:!0},after:t=>t.flow(t.wrap("users"),t.moveProp({"users.reasons":"options.reasons","users.add_leave_dns":"options.add_leave_dns","users.remote_server":"options.remote_servers","users.RESULT":"options.connectionError"}),t.mapProp("users",t.toTable(t.flow(t.mapArrayProps({username:t.getProp("value"),is_user:t.feedWith(1,t.flow(t.getProp("username.is_user"),t.convert.toAppBoolean)),suspended:t.flow(t.getProp("value"),t.convert.toAppBoolean),reason:t.feedWith(1,a=>a.suspended.reason||"none"),vdomains:t.toLimitedUsage(),bandwidth:t.toLimitedUsage(),quota:t.toLimitedUsage(),date_created:t.convert.toAppDate,mysql:a=>{if(!a)return;const[i,c]=a.split("/").map(g=>g.trim());return t.toLimitedUsage()({limit:Number(c)||1/0,usage:i})}}),t.mapArray(a=>({...a,test:"test"}))))),t.mapProp("options",t.mapProps({add_leave_dns:t.convert.toAppBoolean,connectionError:a=>(a||"").split("<br>\\n").filter(t.notEmpty).join("<br>"),remote_servers:t.flow(a=>a||{},t.mapValues(({ssl:a,port:i},c)=>`${t.convert.toAppBoolean(a)?"https":"http"}://${c}:${i}`)),reasons:t.toSelect})))}),d=o.Z.get({id:"ADMINS",url:"/CMD_ADMIN_SHOW",params:{bytes:!0},pagination:!0,after:t=>t.flow(t.wrap("admins"),t.moveProp({"admins.reasons":"reasons"}),t.mapProp("admins",t.toTable(t.mapArrayProps({nusers:t.convert.toAppNumber,suspended:t.flow(t.getProp("value"),t.isEqual("no:"),t.not),reason:t.feedWith(1,a=>a.suspended.reason||"none"),vdomains:t.toLimitedUsage(),bandwidth:t.toLimitedUsage(),quota:t.toLimitedUsage()}))),t.mapProp("reasons",t.toSelect))})},"./js/pages/admin/users/admins.vue":function($,p,r){r.r(p),r.d(p,{default:function(){return E}});var o=function(){var e=this,s=e._self._c;return s("app-page",{attrs:{actions:[{label:e.$gettext("Create Administrator"),icon:"create-administrator",handler:()=>e.$router.push("/admin/users/admins/create")},{label:e.$gettext("Create Reseller"),icon:"create-reseller",handler:()=>e.$router.push("/admin/users/resellers/create")},{label:e.$gettext("Add New User"),icon:"add-new-user",handler:()=>e.$router.push("/reseller/create-user")}]},scopedSlots:e._u([{key:"details",fn:function(){return[s("ui-infobar-item",{attrs:{title:e.$gettext("Stats")}},[s("ui-infobar-stats",{attrs:{usage:e.count,limit:1/0,title:e.$gettext("Admins Count")}})],1)]},proxy:!0},{key:"default",fn:function(){return[s("app-page-section",[s("ui-api-table",e._b({on:{"action:message":function(n){e.$dialog("CREATE_MESSAGE_DIALOG").open()},"action:suspend":function(n){e.$dialog("SUSPEND_USER_DIALOG").open()},"action:unsuspend":e.unsuspendAdmins,"action:remove":e.showDeleteDialog},scopedSlots:e._u([{key:"col:username",fn:function({username:n,reason:v,suspended:m}){return[s("ui-link",{attrs:{name:"admin/users/resellers/view",params:{user:n}}},[e._v(`
                        `+e._s(n)+`
                    `)]),e._v(" "),m?s("ui-tooltip",{attrs:{theme:"danger",icon:"warning"}},[s("span",{domProps:{textContent:e._s(e.$gettextInterpolate(e.$gettext("Suspended: %{ reason }"),{reason:e.reasons[v]}))}})]):e._e()]}},{key:"col:bandwidth",fn:function({bandwidth:n}){return[s("ui-limited-usage",e._b({},"ui-limited-usage",n,!1))]}},{key:"col:quota",fn:function({quota:n}){return[s("ui-limited-usage",e._b({},"ui-limited-usage",n,!1))]}},{key:"col:vdomains",fn:function({vdomains:n}){return[s("ui-limited-usage",e._b({attrs:{plain:""}},"ui-limited-usage",n,!1))]}},{key:"row:actions",fn:function({username:n,suspended:v}){return[s("ui-actions",[s("ui-link",{on:{click:function(m){e.select=[n],e.$dialog("CREATE_MESSAGE_DIALOG").open()}}},[s("span",{domProps:{textContent:e._s(e.$gettext("Send a Message"))}})]),e._v(" "),v?e._e():s("ui-link",{on:{click:function(m){e.select=[n],e.$dialog("SUSPEND_USER_DIALOG").open()}}},[s("span",{domProps:{textContent:e._s(e.$gettext("Suspend"))}})]),e._v(" "),v?s("ui-link",{on:{click:function(m){e.select=[n],e.unsuspendAdmins()}}},[s("span",{domProps:{textContent:e._s(e.$gettext("Unsuspend"))}})]):e._e(),e._v(" "),s("ui-link",{on:{click:function(m){return e.loginAs(n)}}},[s("span",{domProps:{textContent:e._s(e.$gettextInterpolate(e.$gettext("Login as %{ username }"),{username:n}))}})]),e._v(" "),s("ui-link",{on:{click:function(m){return e.changePassword(n)}}},[s("span",{domProps:{textContent:e._s(e.$gettextInterpolate(e.$gettext("Change %{ username }'s password"),{username:n}))}})]),e._v(" "),s("ui-link",{on:{click:function(m){e.select=[n],e.showDeleteDialog()}}},[s("span",{domProps:{textContent:e._s(e.$gettext("Remove"))}})])],1)]}}]),model:{value:e.select,callback:function(n){e.select=n},expression:"select"}},"ui-api-table",{command:e.$commands.getAdmins,property:"admins",rowID:"username",columns:{username:{label:e.$gettext("Username"),grow:!0,searchable:!0},bandwidth:{label:e.$gettext("Bandwidth"),getClass:n=>n.bandwidth.status?`--usage:${n.bandwidth.status}`:"",width:"20%"},quota:{label:e.$gettext("Disk Usage"),getClass:n=>n.bandwidth.status?`--usage:${n.quota.status}`:"",width:"20%"},nusers:e.$gettext("# of Users"),vdomains:e.$gettext("# of domains"),suspended:{label:e.$gettext("Suspended"),hide:!0,searchable:{type:"select",comparison:"contains",options:{"yes:":e.$gettext("Yes"),"no:":e.$gettext("No")}}}},actions:{message:e.$gettext("Send a Message"),suspend:e.$gettext("Suspend"),unsuspend:e.$gettext("Unsuspend"),remove:e.$gettext("Delete")}},!1))],1),e._v(" "),s("create-message-dialog",{attrs:{users:e.select}}),e._v(" "),s("ui-dialog",{attrs:{id:"DELETE_ADMINS_DIALOG",theme:"danger",size:"normal",title:e.$ngettext("Delete Admin","Delete Admins",e.select.length)},scopedSlots:e._u([{key:"content",fn:function(){return[s("span",{domProps:{textContent:e._s(e.$gettext("Please confirm your request"))}}),e._v(" "),s("input-select-multiple",{attrs:{options:e.select,"hide-header":""},scopedSlots:e._u([e._l(e.selectedAdmins,function(n){return{key:`option:${n.username}`,fn:function(){return[s("span",{key:n.username},[Number(n.nusers)?[s("span",{domProps:{textContent:e._s(e.$gettextInterpolate(e.$ngettext("Admin: %{ username } and %{ nusers } user","Admin: %{ username } and %{ nusers } users",Number(n.nusers)),{username:n.username,nusers:n.nusers}))}}),e._v(" "),s("ui-tooltip",{attrs:{theme:"danger"}},[s("span",{domProps:{textContent:e._s(e.$gettext("You are deleting admin that have users under control. If you proceed, these user accounts, along with ALL the associated website and email contents, which are not listed here, will also be removed."))}})])]:s("span",{domProps:{textContent:e._s(e.$gettextInterpolate(e.$gettext("Admin: %{ username }"),{username:n.username}))}})],2)]},proxy:!0}})],null,!0),model:{value:e.remove,callback:function(n){e.remove=n},expression:"remove"}})]},proxy:!0},{key:"buttons",fn:function(){return[s("ui-button",{attrs:{theme:"danger",disabled:e.remove.length===0},on:{click:e.deleteAdmins}},[s("span",{domProps:{textContent:e._s(e.$gettext("Confirm"))}})])]},proxy:!0}])}),e._v(" "),s("suspend-user-dialog",{attrs:{"api-reasons":e.$api.reasons.options},on:{suspend:e.suspendAdmins}}),e._v(" "),s("change-password-dialog",{ref:"cpd"})]},proxy:!0}])})},l=[],d=r("./js/api/commands/admin/users/index.js"),t=r("./js/api/commands/admin/users/actions.js"),a=r("./js/components/local/create-message-dialog.vue"),i=r("./js/components/local/suspend-user-dialog.vue"),c=r("./js/components/local/change-user-password-dialog.vue"),g={preload:d.v,commands:{getAdmins:d.v},components:{CreateMessageDialog:a.Z,SuspendUserDialog:i.Z,ChangePasswordDialog:c.Z},api:d.v,data:()=>({select:[],remove:[]}),computed:{reasons(){return i.Z.$exports.reasons.call(this,this.$api.reasons.options)},selectedAdmins(){return this.select.map(u=>this.$api.admins.rows.find(e=>e.username===u))},count(){return this.$api.admins.rowsCount}},methods:{reloadTable(){Object.assign(this.$data,this.$options.data.apply(this)),this.$reloadApiTable()},deleteAdmins(){(0,t.Vt)({select:this.remove,location:"CMD_ADMIN_SHOW"}).then(this.reloadTable)},suspendAdmins(u){(0,t.f1)({select:this.select,...u,location:"CMD_ADMIN_SHOW"}).then(this.reloadTable)},unsuspendAdmins(){(0,t.Ss)({select:this.select,location:"CMD_ADMIN_SHOW"}).then(this.reloadTable)},loginAs(u){this.$_ctx.session.impersonateUser(u)},changePassword(u){this.$refs.cpd.show(u)},showDeleteDialog(){this.remove=this.select,this.$dialog("DELETE_ADMINS_DIALOG").open()}}},_=g,h=r("../node_modules/vue-loader/lib/runtime/componentNormalizer.js"),x=(0,h.Z)(_,o,l,!1,null,null,null),E=x.exports}}]);
