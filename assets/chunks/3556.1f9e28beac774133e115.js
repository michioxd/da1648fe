(self.webpackChunk=self.webpackChunk||[]).push([[3556],{"../node_modules/mini-css-extract-plugin/dist/loader.js??clonedRuleSet-13.use[1]!../node_modules/css-loader/dist/cjs.js??clonedRuleSet-13.use[2]!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/postcss-loader/dist/cjs.js??clonedRuleSet-13.use[3]!../node_modules/sass-loader/dist/cjs.js??clonedRuleSet-13.use[4]!../node_modules/vue-loader/lib/index.js??vue-loader-options!../node_modules/unplugin/dist/webpack/loaders/transform.js?unpluginName=unplugin-vue-define-options!./js/pages/user/git-version/_dialogs/modify-repo-dialog.vue?vue&type=style&index=0&id=773a0b6b&prod&lang=scss&scoped=true&":function(){},"./js/pages/user/git-version/helper-functions.ts":function(D,R,n){"use strict";n.d(R,{_:function(){return g},g:function(){return m}});var i=n("./js/composables/notify.ts"),x=n("./js/composables/gettext.ts");const p=(0,i.d$)(),{$gettext:l}=(0,x.Z)(),g=v=>v.length===0?"":["main","master"].find(I=>v.includes(I))||v[0],m=v=>v?!0:(p.info({title:l("Git Fetch"),content:l("Remote is not set")}),!1)},"./js/pages/user/git-version/refs.ts":function(D,R,n){"use strict";n.d(R,{R:function(){return g},T0:function(){return S},YU:function(){return m},lP:function(){return v},nw:function(){return l},yI:function(){return I},z2:function(){return E}});var i=n("../node_modules/vue/dist/vue.common.prod.js"),x=n.n(i),p=n("./js/composables/domain.ts");const{domain:l}=(0,p.a)(),g=(0,i.ref)([]),m=(0,i.ref)({branches:[],deploy_branch:"",deploy_dir:"",keyfile:"",name:"",remote:"",url:"",uuid:"",valid:!1,webhook_url:""}),v=(0,i.ref)({commits:[],more_newer:!1,more_older:!1}),I=(0,i.ref)(""),S=(0,i.ref)(0),E=(0,i.ref)({commit:{author:{name:"",email:""},hash:"",message:"",time:""},diff:[]})},"./js/pages/user/git-version/request.ts":function(D,R,n){"use strict";n.d(R,{cQ:function(){return G},ER:function(){return b},Je:function(){return O},h2:function(){return L},pD:function(){return h},LJ:function(){return k},tQ:function(){return T},St:function(){return N},gJ:function(){return w}});var i=n("./js/api/openapi/index.ts"),x=n("../node_modules/runtypes/lib/index.js"),p=n("./js/openapi/web.types.ts");const l=(0,i.$d)(),g=i.an.Default(async(s,e)=>{const{data:t}=await l.get(`/api/git/domain/${s}`,e);return t.status==="success"&&x.Array(p.Uu).guard(t.data)===!1?l.failure({type:"INVALID_RESPONSE",response:t.data}):t}),m=i.an.Default(async(s,e)=>{const{data:t}=await l.get(`/api/git/uuid/${s}`,e);return t.status==="success"&&p.Uu.guard(t.data)===!1?l.failure({type:"INVALID_RESPONSE",response:t.data}):t}),v=i.an.Default(async(s,e,t,o)=>{const{data:r}=await l.get(`/api/git/uuid/${s}/branch/${e}`,Object.assign({},o||{},{params:t}));return r.status==="success"&&p.B_.guard(r.data)===!1?l.failure({type:"INVALID_RESPONSE",response:r.data}):r}),I=i.an.Default(async(s,e,t)=>{const{data:o}=await l.get(`/api/git/uuid/${s}/commit/${e}`,t);return o.status==="success"&&p.IK.guard(o.data)===!1?l.failure({type:"INVALID_RESPONSE",response:o.data}):o}),S=i.an.Default(async(s,e)=>{const{data:t}=await l.post(`/api/git/uuid/${s}/deploy`,e);return t}),E=i.an.Default(async(s,e,t)=>{const{data:o}=await l.post(`/api/git/domain/${s}`,e,t);return o.status==="success"&&p.Uu.guard(o.data)===!1?l.failure({type:"INVALID_RESPONSE",response:o.data}):o}),$=i.an.Default(async(s,e)=>{const{data:t}=await l.post(`/api/git/uuid/${s}/fetch`,e);return t}),P=i.an.Default(async(s,e,t)=>{const{data:o}=await l.put(`/api/git/uuid/${s}`,e,t);return o}),C=i.an.Default(async(s,e)=>{const{data:t}=await l.delete(`/api/git/uuid/${s}`,e);return t});var u=n("./js/composables/notify.ts"),d=n("./js/composables/gettext.ts"),c=n("./js/composables/useErrorMessages.ts");const{$gettext:a}=(0,d.Z)(),j=(0,u.d$)(),y=(0,c.L)({GIT_DEPLOY_BRANCH_NOT_SET:a("Git deploy branch is not set"),GIT_DEPLOY_DIR_NOT_SET:a("Git deploy directory is not set"),GIT_DIRECTORY_EXISTS:a("Git directory exists %{ directory }"),GIT_REMOTE_PERMISSION_DENIED:a("Lacking authorization to connect to the remote repository"),GIT_REMOTE_CONNECTION_ERROR:a("Server failed to connect to the remote repository")}),b=async s=>{const e=await g(s);return e.error&&y(e.error),e},L=async s=>{const e=await m(s);return e.error&&y(e.error),e},h=async(s,e,t)=>{const o=await v(s,e,t);return o.error&&y(o.error),o},O=async(s,e)=>{const t=await I(s,e);return t.error&&y(t.error),t},k=async s=>{const e=await S(s);return e.error?y(e.error):j.success({title:a("Git Deploy"),content:a("Deployment completed")}),e},N=async(s,e)=>{const t=await E(s,e);return t.error?y(t.error):j.success({title:a("Git"),content:a("Repository created")}),t},T=async s=>{const e=await $(s);return e.error?y(e.error):j.success({title:a("Git Fetch"),content:a("Fetch completed")}),e},w=async(s,e)=>{const t=await P(s,e);return t.error?y(t.error):j.success({title:a("Git Modify"),content:a("Repository modified")}),t},G=async s=>{const e=await C(s);return e.error?y(e.error):j.success({title:a("Delete"),content:a("Repository deleted")}),e}},"./js/pages/user/git-version/_dialogs/modify-repo-dialog.vue":function(D,R,n){"use strict";n.d(R,{Z:function(){return P}});var i=function(){var u=this,d=u._self._c,c=u._self._setupProxy;return d("ui-dialog",{attrs:{id:"MODIFY_GIT_REPO_DIALOG",size:"normal"},on:{"dialog:open":c.initRepoInfo},scopedSlots:u._u([{key:"title",fn:function(){return[d("span",{domProps:{textContent:u._s(u.$gettextInterpolate(u.$gettext("Modify Repository %{ name }"),{name:c.name}))}})]},proxy:!0},{key:"content",fn:function(){return[d("div",[d("ui-form-element",{attrs:{vertical:""},scopedSlots:u._u([{key:"title",fn:function(){return[d("span",{domProps:{textContent:u._s(u.$gettext("Deploy Branch"))}})]},proxy:!0},{key:"content",fn:function(){return[d("input-select",{attrs:{options:c.gitInfo.branches||[]},model:{value:c.gitInfo.deploy_branch,callback:function(a){u.$set(c.gitInfo,"deploy_branch",a)},expression:"gitInfo.deploy_branch"}})]},proxy:!0}])}),u._v(" "),d("ui-form-element",{attrs:{vertical:"",group:"edit-repo",validators:{required:!1}},scopedSlots:u._u([{key:"title",fn:function(){return[d("span",{domProps:{textContent:u._s(u.$gettext("Deploy Directory"))}})]},proxy:!0},{key:"content",fn:function(){return[d("input-text",{on:{keyup:function(a){return!a.type.indexOf("key")&&u._k(a.keyCode,"enter",13,a.key,"Enter")?null:c.submit.apply(null,arguments)}},model:{value:c.gitInfo.deploy_dir,callback:function(a){u.$set(c.gitInfo,"deploy_dir",a)},expression:"gitInfo.deploy_dir"}})]},proxy:!0}])}),u._v(" "),d("ui-form-element",{directives:[{name:"show",rawName:"v-show",value:c.gitInfo.remote,expression:"gitInfo.remote"}],attrs:{vertical:"",group:"edit-repo",validators:{required:!1}},scopedSlots:u._u([{key:"title",fn:function(){return[d("span",{domProps:{textContent:u._s(u.$gettext("Key file"))}})]},proxy:!0},{key:"content",fn:function(){return[d("input-text",{on:{keyup:function(a){return!a.type.indexOf("key")&&u._k(a.keyCode,"enter",13,a.key,"Enter")?null:c.submit.apply(null,arguments)}},model:{value:c.gitInfo.keyfile,callback:function(a){u.$set(c.gitInfo,"keyfile",a)},expression:"gitInfo.keyfile"}})]},proxy:!0}])})],1)]},proxy:!0},{key:"buttons",fn:function(){return[d("ui-button",{attrs:{theme:"primary","validate-group":"edit-repo"},on:{click:c.submit}},[d("span",{domProps:{textContent:u._s(u.$gettext("Save"))}})])]},proxy:!0}])})},x=[],p=n("../node_modules/vue/dist/vue.common.prod.js"),l=n("./js/stores/index.ts"),g=n("./js/pages/user/git-version/request.ts"),m=n("./js/pages/user/git-version/refs.ts"),v=(0,p.defineComponent)({__name:"modify-repo-dialog",props:{uuid:null},emits:["modified"],setup(C,{emit:u}){const d=C,c=(0,l.oR)(PiniaStores.VALIDATION),a=(0,p.computed)(()=>m.YU.value.name);async function j(){const{data:b}=await(0,g.h2)(d.uuid);b&&(m.YU.value=b)}async function y(){if(c.isValid("edit-repo")){const b={deploy_branch:m.YU.value.deploy_branch,deploy_dir:m.YU.value.deploy_dir,keyfile:m.YU.value.keyfile};await(0,g.gJ)(d.uuid,b),u("modified")}}return{__sfc:!0,validationStore:c,props:d,emit:u,name:a,initRepoInfo:j,submit:y,gitInfo:m.YU}}}),I=v,S=n("../node_modules/vue-style-loader/index.js!../node_modules/mini-css-extract-plugin/dist/loader.js??clonedRuleSet-13.use[1]!../node_modules/css-loader/dist/cjs.js??clonedRuleSet-13.use[2]!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/postcss-loader/dist/cjs.js??clonedRuleSet-13.use[3]!../node_modules/sass-loader/dist/cjs.js??clonedRuleSet-13.use[4]!../node_modules/vue-loader/lib/index.js??vue-loader-options!../node_modules/unplugin/dist/webpack/loaders/transform.js?unpluginName=unplugin-vue-define-options!./js/pages/user/git-version/_dialogs/modify-repo-dialog.vue?vue&type=style&index=0&id=773a0b6b&prod&lang=scss&scoped=true&"),E=n("../node_modules/vue-loader/lib/runtime/componentNormalizer.js"),$=(0,E.Z)(I,i,x,!1,null,"773a0b6b",null),P=$.exports},"./js/pages/user/git-version/index.vue":function(D,R,n){"use strict";n.r(R),n.d(R,{default:function(){return G}});var i=function(){var e=this,t=e._self._c,o=e._self._setupProxy;return t("app-page",{attrs:{actions:[{label:e.$gettext("Create Repository"),visible:!0,icon:"#plus-fill",name:"user/git-version/create"}]},scopedSlots:e._u([{key:"default",fn:function(){return[t("app-page-section",[t("ui-r-table",e._b({attrs:{"disable-pagination":""},scopedSlots:e._u([{key:"col:name",fn:function({item:r}){return[t("ui-link",{attrs:{name:"user/git-version/info",params:{uuid:r.uuid},disabled:!r.valid}},[e._v(`
                        `+e._s(r.name)+`
                        `),r.valid?e._e():t("ui-badge",{attrs:{theme:"danger",title:e.$gettext("Repository is not valid")}})],1)]}},{key:"row:actions",fn:function({item:r}){return[t("ui-actions",[r.valid?t("ui-link",{on:{click:function(f){return o.modifyDialog(r)}}},[t("span",{domProps:{textContent:e._s(e.$gettext("Edit"))}})]):e._e(),e._v(" "),r.valid&&r.branches.length?t("ui-link",{attrs:{name:"user/git-version/logs",params:{branch:o.getDefaultBranch(r.branches),uuid:r.uuid,skip:"0"}}},[t("span",{domProps:{textContent:e._s(e.$gettext("Logs"))}})]):e._e(),e._v(" "),r.valid?t("ui-link",{on:{click:function(f){return o.infoDialog(r)}}},[t("span",{domProps:{textContent:e._s(e.$gettext("Info"))}})]):e._e(),e._v(" "),r.valid&&r.remote?t("ui-link",{staticClass:"reload",on:{click:function(f){return o.fetch(r)}}},[t("span",{domProps:{textContent:e._s(e.$gettext("Fetch"))}})]):e._e(),e._v(" "),r.valid?t("ui-link",{staticClass:"download",on:{click:function(f){return o.deploy(r)}}},[t("span",{domProps:{textContent:e._s(e.$gettext("Deploy"))}})]):e._e(),e._v(" "),t("ui-link",{on:{click:function(f){return o.deleteRepoBefore(r)}}},[t("span",{domProps:{textContent:e._s(e.$gettext("Delete"))}})])],1)]}}])},"ui-r-table",{rows:o.repositoryList,columns:[{id:"name",label:e.$gettext("Name")},{id:"url",label:e.$gettext("Url")}],verticalLayout:o.clientStore.isPhone,isCheckable:!1},!1))],1),e._v(" "),t(o.ModifyRepoDialog,{attrs:{uuid:o.currentItem.uuid},on:{modified:o.renewList}}),e._v(" "),t(o.InfoRepoDialogHasRemote,{attrs:{item:o.currentItem}}),e._v(" "),t(o.InfoRepoDialog,{attrs:{item:o.currentItem}}),e._v(" "),t("ui-dialog-delete-items",{on:{"click:confirm":function(r){return o.deleteRepoAfter()}}},[e._v(`
            `+e._s(o.currentItem.name)+`
        `)])]},proxy:!0}])})},x=[],p=n("../node_modules/vue/dist/vue.common.prod.js"),l=n("./js/stores/index.ts"),g=n("./js/composables/dialog.ts"),m=n("./js/composables/domain.ts"),v=n("./js/pages/user/git-version/_dialogs/modify-repo-dialog.vue"),I=function(){var e=this,t=e._self._c,o=e._self._setupProxy;return t("ui-dialog",{attrs:{id:"INFO_GIT_REPO_DIALOG",size:"normal","no-close-btn":!0,title:e.$gettext("Info")},scopedSlots:e._u([{key:"content",fn:function(){return[t("div",[t("table",e._l(e.item,function(r,f){return t("tr",{key:f},[o.showKey(f)?[t("td",{domProps:{textContent:e._s(`${f.replace("_"," ")}`)}}),e._v(" "),t("td",{domProps:{textContent:e._s(r)}})]:e._e(),e._v(" "),f==="branches"?[t("td",{domProps:{textContent:e._s(`${f.replace("_"," ")}`)}}),e._v(" "),t("td",{domProps:{textContent:e._s(r.join(", "))}})]:e._e()],2)}),0)])]},proxy:!0}])})},S=[],E=(0,p.defineComponent)({__name:"info-repo-dialog",props:{item:null},setup(s){function e(t){return!["uuid","remote","webhook_url","keyfile","branches"].includes(t)}return{__sfc:!0,showKey:e}}}),$=E,P=n("../node_modules/vue-loader/lib/runtime/componentNormalizer.js"),C=(0,P.Z)($,I,S,!1,null,null,null),u=C.exports,d=function(){var e=this,t=e._self._c,o=e._self._setupProxy;return t("ui-dialog",{attrs:{id:"INFO_GIT_REPO_DIALOG_HAS_REMOTE",size:"normal","no-close-btn":!0,title:e.$gettext("Info")},scopedSlots:e._u([{key:"content",fn:function(){return[t("div",[t("table",e._l(e.item,function(r,f){return t("tr",{key:f},[f!="uuid"?t("td",{domProps:{textContent:e._s(`${f.replace("_"," ")}`)}}):e._e(),e._v(" "),f=="branches"?t("td",{domProps:{textContent:e._s(r.join(", "))}}):f!="uuid"?t("td",{domProps:{textContent:e._s(r)}}):e._e()])}),0)])]},proxy:!0}])})},c=[],a=(0,p.defineComponent)({__name:"info-repo-dialog-has-remote",props:{item:null},setup(s){return{__sfc:!0}}}),j=a,y=(0,P.Z)(j,d,c,!1,null,null,null),b=y.exports,L=n("./js/pages/user/git-version/helper-functions.ts"),h=n("./js/pages/user/git-version/request.ts"),O=n("./js/pages/user/git-version/refs.ts");const k=(0,p.defineComponent)({async beforeRouteEnter(s,e,t){const{data:o,error:r}=await(0,h.ER)(O.nw.value);if(r){t(!1);return}O.R.value=o,t()}});var N=(0,p.defineComponent)({...k,__name:"index",emits:[],setup(s){const{watchDomain:e}=(0,m.a)(),t=(0,l.oR)("client"),o=(0,p.ref)({uuid:"",name:"",url:"",webhook_url:"",deploy_dir:"",deploy_branch:"",branches:[],keyfile:"",remote:"",valid:!0});e(()=>{r()});async function r(){const{data:_}=await(0,h.ER)(O.nw.value);O.R.value=_!=null?_:[]}function f(_){o.value=_,(0,g.R)("MODIFY_GIT_REPO_DIALOG").open()}async function A(_){const{data:M}=await(0,h.h2)(_.uuid);M&&(o.value=M),_.remote?(0,g.R)("INFO_GIT_REPO_DIALOG_HAS_REMOTE").open():(0,g.R)("INFO_GIT_REPO_DIALOG").open()}async function F(_){(0,L.g)(_.remote)&&await(0,h.tQ)(_.uuid)}async function U(_){await(0,h.LJ)(_.uuid)}async function B(_){o.value=_,(0,g.R)("DELETE_ITEMS_DIALOG").open()}async function Y(){const{error:_}=await(0,h.cQ)(o.value.uuid);_||r()}return{__sfc:!0,watchDomain:e,clientStore:t,currentItem:o,renewList:r,modifyDialog:f,infoDialog:A,fetch:F,deploy:U,deleteRepoBefore:B,deleteRepoAfter:Y,ModifyRepoDialog:v.Z,InfoRepoDialog:u,InfoRepoDialogHasRemote:b,getDefaultBranch:L._,repositoryList:O.R}}}),T=N,w=(0,P.Z)(T,i,x,!1,null,null,null),G=w.exports},"../node_modules/vue-style-loader/index.js!../node_modules/mini-css-extract-plugin/dist/loader.js??clonedRuleSet-13.use[1]!../node_modules/css-loader/dist/cjs.js??clonedRuleSet-13.use[2]!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/postcss-loader/dist/cjs.js??clonedRuleSet-13.use[3]!../node_modules/sass-loader/dist/cjs.js??clonedRuleSet-13.use[4]!../node_modules/vue-loader/lib/index.js??vue-loader-options!../node_modules/unplugin/dist/webpack/loaders/transform.js?unpluginName=unplugin-vue-define-options!./js/pages/user/git-version/_dialogs/modify-repo-dialog.vue?vue&type=style&index=0&id=773a0b6b&prod&lang=scss&scoped=true&":function(D,R,n){var i=n("../node_modules/mini-css-extract-plugin/dist/loader.js??clonedRuleSet-13.use[1]!../node_modules/css-loader/dist/cjs.js??clonedRuleSet-13.use[2]!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/postcss-loader/dist/cjs.js??clonedRuleSet-13.use[3]!../node_modules/sass-loader/dist/cjs.js??clonedRuleSet-13.use[4]!../node_modules/vue-loader/lib/index.js??vue-loader-options!../node_modules/unplugin/dist/webpack/loaders/transform.js?unpluginName=unplugin-vue-define-options!./js/pages/user/git-version/_dialogs/modify-repo-dialog.vue?vue&type=style&index=0&id=773a0b6b&prod&lang=scss&scoped=true&");i.__esModule&&(i=i.default),typeof i=="string"&&(i=[[D.id,i,""]]),i.locals&&(D.exports=i.locals);var x=n("../node_modules/vue-style-loader/lib/addStylesClient.js").Z,p=x("453cb250",i,!0,{})}}]);
