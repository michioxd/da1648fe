"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[3189],{"./js/api/commands/history.js":function($,g,r){r.d(g,{d8:function(){return p},p5:function(){return m},pB:function(){return f}});var h=r("./js/api/command/index.js");const c=h.Z.get({url:"/CMD_USER_HISTORY",response:[],after:o=>o.flow(o.toArray,o.mapArrayProps({bandwidth:o.convert.toAppNumber,quota:o.convert.toAppNumber,inode:o.convert.toAppNumber,year:o.convert.toAppNumber,month:o.convert.toAppNumber}))}),m=c.extend({id:"USER_HISTORY",url:"/CMD_USER_HISTORY",schema:{user:h.Z.OPTIONAL_STRING}}),p=c.extend({id:"RESELLER_HISTORY",url:"/CMD_RESELLER_HISTORY",schema:{user:h.Z.OPTIONAL_STRING}}),f=c.extend({id:"ADMIN_HISTORY",url:"/CMD_ADMIN_HISTORY"})},"./js/components/local/history/base-charts.js":function($,g,r){r.d(g,{o3:function(){return f},x1:function(){return o}});var h=r("../node_modules/chart.js/dist/chart.mjs");function c(d,u){return{render(l){return l("div",{style:this.styles,class:this.cssClasses},[l("canvas",{attrs:{id:this.chartId,width:this.width,height:this.height},ref:"canvas"})])},props:{chartId:{default:d,type:String},width:{default:400,type:Number},height:{default:400,type:Number},cssClasses:{type:String,default:""},styles:{type:Object},plugins:{type:Array,default(){return[]}}},data(){return{_chart:null}},created(){h.kL.register(...h.zX)},methods:{renderChart(l,v){this.$data._chart&&this.$data._chart.destroy();const y=v;if(this.plugins.length>0)for(const i of this.plugins)y.plugins={...y.plugins,...i};this.$data._chart=new h.kL(this.$refs.canvas.getContext("2d"),{type:u,data:l,options:y})}},beforeDestroy(){this.$data._chart&&this.$data._chart.destroy()}}}function m(d,u){if(u){let l=this.$data._chart,v=d.datasets.map(t=>t.label),y=u.datasets.map(t=>t.label);const i=JSON.stringify(y);JSON.stringify(v)===i&&u.datasets.length===d.datasets.length?(d.datasets.forEach((t,s)=>{const _=Object.keys(u.datasets[s]),C=Object.keys(t);_.filter(a=>a!=="_meta"&&C.indexOf(a)===-1).forEach(a=>{delete l.data.datasets[s][a]});for(const a in t)t.hasOwnProperty(a)&&(l.data.datasets[s][a]=t[a])}),d.hasOwnProperty("labels")&&(l.data.labels=d.labels,this.$emit("labels:update")),l.update(),this.$emit("chart:update")):(l&&(l.destroy(),this.$emit("chart:destroy")),this.renderChart(this.chartData,this.options),this.$emit("chart:render"))}else this.$data._chart&&(this.$data._chart.destroy(),this.$emit("chart:destroy")),this.renderChart(this.chartData,this.options),this.$emit("chart:render")}const p={data(){return{chartData:null}},watch:{chartData:m}},f={props:{chartData:{type:Object,required:!0,default:()=>{}}},watch:{chartData:m}},o=c("line-chart","line")},"./js/composables/dateFilter.ts":function($,g,r){r.d(g,{W:function(){return f},f:function(){return m.f}});var h=r("../node_modules/ramda/es/index.js"),c=r("../node_modules/date-fns/esm/format/index.js"),m=r("./js/modules/date-formats.ts"),p=r("./js/modules/customizations/date-formats/default.ts");const f=h.WAo((o,d)=>{if(d)try{return(0,c.Z)(d,m.f.value[o])}catch(u){return console.warn(`Given ${o} format is incorrect:
${u.message}`),(0,c.Z)(d,p.d[o])}return""})},"./js/composables/filters.ts":function($,g,r){r.d(g,{Q0:function(){return t},aS:function(){return _},d5:function(){return s},eB:function(){return y},hT:function(){return l},kC:function(){return u},n9:function(){return e},zM:function(){return v}});var h=r("../node_modules/date-fns/esm/formatDistance/index.js"),c=r("../node_modules/punycode/punycode.es6.js"),m=r("./js/composables/dateFilter.ts"),p=r("./js/composables/gettext.ts");const{$gettext:f,$ngettext:o,$gettextInterpolate:d}=(0,p.Z)(),u=n=>{var a;return n?((a=n.at(0))===null||a===void 0?void 0:a.toUpperCase())+n.slice(1):""},l=(n,a="datetime")=>(0,m.W)(a,n),v=n=>(0,h.Z)(n,new Date),y=(n,a=1024)=>{const b=Number(n);if(!b)return"0 B";const x=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],O=Math.floor(Math.log(b)/Math.log(a));return`${parseFloat((b/a**O).toFixed(2))} ${x[O]}`},i=n=>{try{return(0,c.xX)(n)}catch(a){return n}},e=n=>(0,c.xX)(n),t=n=>{if(!n||!n.includes("@"))return n;const[a,b]=n.split("@");return[a,i(b)].join("@")},s=n=>{if(n<60)return f("less than a minute");const a=Math.floor(n/60)%60,b=Math.floor(n/3600)%24,x=Math.floor(n/(3600*24)),O=[x?o("%{days} day","%{days} days",x):null,b?o("%{hours} hour","%{hours} hours",b):null,a?o("%{minutes} minute","%{minutes} minutes",a):null].filter(Boolean).join(", ");return d(O,{days:x,hours:b,minutes:a})},_=(n,a)=>n.length<=a?n:`${n.substring(0,a)}...`,C=()=>({capitalize:u,date:l,distanceFromNow:v,humanReadableSize:y,p6eUnicode:e,p6eUnicodeEmail:t,formatUptime:s,truncateString:_})},"./js/components/local/history/chart.vue":function($,g,r){r.d(g,{Z:function(){return i}});var h=function(){var t=this,s=t._self._c;return s("app-page-section",[s("ui-form-element",{attrs:{underline:!1,"vertical-on-phone":!1},scopedSlots:t._u([{key:"title",fn:function(){return[s("span",{domProps:{textContent:t._s(t.$gettext("Year:"))}})]},proxy:!0},{key:"content",fn:function(){return[s("input-select",{attrs:{options:t.years},model:{value:t.year,callback:function(_){t.year=_},expression:"year"}})]},proxy:!0}])}),t._v(" "),s("line-chart",t._b({key:t.type},"line-chart",t.chart[t.type],!1))],1)},c=[],m=r("../node_modules/vue/dist/vue.common.prod.js"),p=r.n(m),f=r("./js/components/local/history/base-charts.js"),o=r("./js/composables/filters.ts"),u={components:{LineChart:p().extend({extends:f.x1,mixins:[f.o3],props:["chart","options"],mounted(){this.renderChart(this.chartData,this.options)}})},props:{type:{type:String,required:!1,default:"volumes"},history:{type:Array,required:!0},hideLinks:{type:Boolean,required:!1,default:!1}},data:()=>({year:null,hovered:null}),computed:{years(){return Object.values(this.history.reduce((e,{year:t})=>({[t]:t.toString(),...e}),{}))},rows(){return this.history.filter(e=>e.year.toString()===this.year)},labels(){return this.rows.map(this.getMonthName)},chartData(){return this.chart[this.type].chartData},options(){return this.chart[this.type].options},chart(){const e={enabled:!0,mode:"nearest",intersect:!1,bodySpacing:6,padding:10,titleFont:{family:"Open Sans"},bodyFont:{family:"Open Sans"},footerFont:{family:"Open Sans",size:10},displayColors:!1};return{volumes:{chartData:{labels:this.labels,datasets:[{label:this.$gettext("Bandwidth"),data:this.rows.map(t=>t.bandwidth),...this.datasetOptions("danger")},{label:this.$gettext("Disk Usage"),data:this.rows.map(t=>t.quota),...this.datasetOptions("primary")}]},options:{onClick:this.chartsClick,scales:{y:{ticks:{callback:this.size}}},plugins:{legend:{onClick:()=>{}},tooltip:{...e,callbacks:{title:t=>{const s=this.rows[t[0].dataIndex];return`${this.getMonthName(s)} ${s.year}`},label:({datasetIndex:t,raw:s})=>{const _=[this.$gettext("Bandwidth"),this.$gettext("Disk Usage")][t];return s!==0?`${_}: ${this.size(s)}`:""},footer:t=>t[0].datasetIndex===0&&!this.hideLinks?(this.$emit("hover:date",this.rows[t[0].dataIndex]),this.$gettext("Click for details")):(this.$emit("hover:clear"),"")}}}}},inodes:{chartData:{labels:this.labels,datasets:[{label:this.$gettext("Inodes Count"),data:this.rows.map(t=>t.inode),...this.datasetOptions("safe")}]},options:{plugins:{legend:{onClick:()=>{}},tooltip:{...e,callbacks:{title:t=>{const s=this.rows[t[0].dataIndex];return`${this.getMonthName(s)} ${s.year}`},footer:()=>this.hideLinks?void 0:this.$gettext("Click for details")}}}}}}}},created(){this.year=this.years[this.years.length-1],this.$on("hover:date",({year:e,month:t})=>{this.hovered={year:e,month:t}}),this.$on("hover:clear",()=>{this.hovered=null})},methods:{chartsClick(){this.hovered&&this.$emit("click",this.hovered)},size(e){return(0,o.eB)(e)},datasetOptions(e){const t=s=>getComputedStyle(document.body).getPropertyValue(`--${s}`);return{backgroundColor:t(`${e}-overlay`),borderColor:t(e),pointBackgroundColor:t(e),borderWidth:3,pointRadius:5,pointHitRadius:20,tension:.4}},getMonthName({month:e}){return[this.$gettext("January"),this.$gettext("February"),this.$gettext("March"),this.$gettext("April"),this.$gettext("May"),this.$gettext("June"),this.$gettext("July"),this.$gettext("August"),this.$gettext("September"),this.$gettext("October"),this.$gettext("November"),this.$gettext("December")][parseInt(e,10)-1]}}},l=u,v=r("../node_modules/vue-loader/lib/runtime/componentNormalizer.js"),y=(0,v.Z)(l,h,c,!1,null,null,null),i=y.exports},"./js/components/local/history/table.vue":function($,g,r){r.d(g,{Z:function(){return y}});var h=function(){var e=this,t=e._self._c;return t("app-page-section",[t("ui-r-table",{attrs:{rows:e.rows,sort:e.sort,columns:[{id:"year",label:e.$gettext("Date")},{id:"bandwidth",label:e.$gettext("Bandwidth")},{id:"quota",label:e.$gettext("Disk Usage")},{id:"inode",label:e.$gettext("Inodes Count")}],"rows-count":e.history.length,"is-checkable":!1,"vertical-layout":e.clientStore.isPhone,"is-sortable":"","external-sorting":"","equal-width-layout":""},on:{"update:sort":function(s){e.sort=s}},scopedSlots:e._u([{key:"col:year",fn:function({year:s,month:_}){return[t(e.hideLinks?"span":"ui-link",{tag:"component",staticClass:"txt:bold",on:{click:function(C){return e.$emit("click",{year:s,month:_})}}},[e._v(`
                `+e._s(e.getMonthName(_))+", "+e._s(s)+`
            `)])]}},{key:"col:bandwidth",fn:function({bandwidth:s}){return[e._v(`
            `+e._s(e.humanReadableSize(s))+`
        `)]}},{key:"col:quota",fn:function({quota:s}){return[e._v(`
            `+e._s(e.humanReadableSize(s))+`
        `)]}}])})],1)},c=[],m=r("./js/stores/index.ts"),p=r("../node_modules/ramda/es/index.js"),f=r("./js/context/index.ts"),o=r("./js/composables/filters.ts"),d={name:"HistoryTable",props:{history:{type:Array,required:!0},hideLinks:{type:Boolean,required:!1,default:!1}},data:()=>({sort:{key:"year",order:"DESC"}}),computed:{ipp(){const i=Number(this.$route.query.ipp)||!1;return i&&i>0?i:f.T.options.getItem("tables/ipp")},page(){const i=Number(this.$route.query.page)||!1;return i&&i>0?i:1},sortComparator(){const i=this.sort.order==="DESC"?p.Ck5:p.zU3;return p.HCG(this.sort.key==="year"?[i(p.vgT("year")),i(p.vgT("month"))]:[i(p.vgT(this.sort.key))])},sortedHistory(){return this.sortComparator(this.history)},rows(){return this.sortedHistory.slice((this.page-1)*this.ipp,this.page*this.ipp)},...(0,m.Kc)(["client"])},methods:{humanReadableSize:o.eB,getMonthName(i){return[this.$gettext("January"),this.$gettext("February"),this.$gettext("March"),this.$gettext("April"),this.$gettext("May"),this.$gettext("June"),this.$gettext("July"),this.$gettext("August"),this.$gettext("September"),this.$gettext("October"),this.$gettext("November"),this.$gettext("December")][parseInt(i,10)-1]}}},u=d,l=r("../node_modules/vue-loader/lib/runtime/componentNormalizer.js"),v=(0,l.Z)(u,h,c,!1,null,null,null),y=v.exports}}]);
