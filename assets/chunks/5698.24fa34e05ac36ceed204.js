(self.webpackChunk=self.webpackChunk||[]).push([[5698],{"../node_modules/date-fns/esm/formatDistance/index.js":function(T,S,o){"use strict";o.d(S,{Z:function(){return W}});var d=o("../node_modules/date-fns/esm/_lib/defaultOptions/index.js"),c=o("../node_modules/date-fns/esm/toDate/index.js"),f=o("../node_modules/date-fns/esm/_lib/requiredArgs/index.js");function u(a,i){(0,f.Z)(2,arguments);var r=(0,c.Z)(a),v=(0,c.Z)(i),h=r.getTime()-v.getTime();return h<0?-1:h>0?1:h}function A(a,i){(0,f.Z)(2,arguments);var r=(0,c.Z)(a),v=(0,c.Z)(i),h=r.getFullYear()-v.getFullYear(),E=r.getMonth()-v.getMonth();return h*12+E}function _(a){(0,f.Z)(1,arguments);var i=(0,c.Z)(a);return i.setHours(23,59,59,999),i}function k(a){(0,f.Z)(1,arguments);var i=(0,c.Z)(a),r=i.getMonth();return i.setFullYear(i.getFullYear(),r+1,0),i.setHours(23,59,59,999),i}function j(a){(0,f.Z)(1,arguments);var i=(0,c.Z)(a);return _(i).getTime()===k(i).getTime()}function M(a,i){(0,f.Z)(2,arguments);var r=(0,c.Z)(a),v=(0,c.Z)(i),h=u(r,v),E=Math.abs(A(r,v)),m;if(E<1)m=0;else{r.getMonth()===1&&r.getDate()>27&&r.setDate(30),r.setMonth(r.getMonth()-h*E);var C=u(r,v)===-h;j((0,c.Z)(a))&&E===1&&u(a,v)===1&&(C=!1),m=h*(E-Number(C))}return m===0?0:m}function P(a,i){return(0,f.Z)(2,arguments),(0,c.Z)(a).getTime()-(0,c.Z)(i).getTime()}var $={ceil:Math.ceil,round:Math.round,floor:Math.floor,trunc:function(i){return i<0?Math.ceil(i):Math.floor(i)}},U="trunc";function Z(a){return a?$[a]:$[U]}function R(a,i,r){(0,f.Z)(2,arguments);var v=P(a,i)/1e3;return Z(r==null?void 0:r.roundingMethod)(v)}var D=o("../node_modules/date-fns/esm/_lib/defaultLocale/index.js");function w(a,i){if(a==null)throw new TypeError("assign requires that input parameter not be null or undefined");for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(a[r]=i[r]);return a}function B(a){return w({},a)}var l=o("../node_modules/date-fns/esm/_lib/getTimezoneOffsetInMilliseconds/index.js"),p=1440,b=2520,x=43200,O=86400;function W(a,i,r){var v,h;(0,f.Z)(2,arguments);var E=(0,d.j)(),m=(v=(h=r==null?void 0:r.locale)!==null&&h!==void 0?h:E.locale)!==null&&v!==void 0?v:D.Z;if(!m.formatDistance)throw new RangeError("locale must contain formatDistance property");var C=u(a,i);if(isNaN(C))throw new RangeError("Invalid time value");var g=w(B(r),{addSuffix:Boolean(r==null?void 0:r.addSuffix),comparison:C}),N,L;C>0?(N=(0,c.Z)(i),L=(0,c.Z)(a)):(N=(0,c.Z)(a),L=(0,c.Z)(i));var I=R(L,N),Y=((0,l.Z)(L)-(0,l.Z)(N))/1e3,y=Math.round((I-Y)/60),G;if(y<2)return r!=null&&r.includeSeconds?I<5?m.formatDistance("lessThanXSeconds",5,g):I<10?m.formatDistance("lessThanXSeconds",10,g):I<20?m.formatDistance("lessThanXSeconds",20,g):I<40?m.formatDistance("halfAMinute",0,g):I<60?m.formatDistance("lessThanXMinutes",1,g):m.formatDistance("xMinutes",1,g):y===0?m.formatDistance("lessThanXMinutes",1,g):m.formatDistance("xMinutes",y,g);if(y<45)return m.formatDistance("xMinutes",y,g);if(y<90)return m.formatDistance("aboutXHours",1,g);if(y<p){var K=Math.round(y/60);return m.formatDistance("aboutXHours",K,g)}else{if(y<b)return m.formatDistance("xDays",1,g);if(y<x){var H=Math.round(y/p);return m.formatDistance("xDays",H,g)}else if(y<O)return G=Math.round(y/x),m.formatDistance("aboutXMonths",G,g)}if(G=M(L,N),G<12){var X=Math.round(y/x);return m.formatDistance("xMonths",X,g)}else{var F=G%12,z=Math.floor(G/12);return F<3?m.formatDistance("aboutXYears",z,g):F<9?m.formatDistance("overXYears",z,g):m.formatDistance("almostXYears",z+1,g)}}},"../node_modules/mini-css-extract-plugin/dist/loader.js??clonedRuleSet-13.use[1]!../node_modules/css-loader/dist/cjs.js??clonedRuleSet-13.use[2]!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/postcss-loader/dist/cjs.js??clonedRuleSet-13.use[3]!../node_modules/sass-loader/dist/cjs.js??clonedRuleSet-13.use[4]!../node_modules/vue-loader/lib/index.js??vue-loader-options!../node_modules/unplugin/dist/webpack/loaders/transform.js?unpluginName=unplugin-vue-define-options!./js/pages/user/messages/_dialogs/message-system-options.vue?vue&type=style&index=0&id=c7090fbc&prod&lang=scss&":function(){},"../node_modules/mini-css-extract-plugin/dist/loader.js??clonedRuleSet-13.use[1]!../node_modules/css-loader/dist/cjs.js??clonedRuleSet-13.use[2]!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/postcss-loader/dist/cjs.js??clonedRuleSet-13.use[3]!../node_modules/sass-loader/dist/cjs.js??clonedRuleSet-13.use[4]!../node_modules/vue-loader/lib/index.js??vue-loader-options!../node_modules/unplugin/dist/webpack/loaders/transform.js?unpluginName=unplugin-vue-define-options!./js/pages/user/messages/_dialogs/view-ticket-dialog.vue?vue&type=style&index=0&id=5a32ee59&prod&lang=scss&":function(){},"./js/composables/dateFilter.ts":function(T,S,o){"use strict";o.d(S,{W:function(){return A},f:function(){return f.f}});var d=o("../node_modules/ramda/es/index.js"),c=o("../node_modules/date-fns/esm/format/index.js"),f=o("./js/modules/date-formats.ts"),u=o("./js/modules/customizations/date-formats/default.ts");const A=d.WAo((_,k)=>{if(k)try{return(0,c.Z)(k,f.f.value[_])}catch(j){return console.warn(`Given ${_} format is incorrect:
${j.message}`),(0,c.Z)(k,u.d[_])}return""})},"./js/composables/filters.ts":function(T,S,o){"use strict";o.d(S,{Q0:function(){return R},aS:function(){return w},d5:function(){return D},eB:function(){return $},hT:function(){return M},kC:function(){return j},n9:function(){return Z},zM:function(){return P}});var d=o("../node_modules/date-fns/esm/formatDistance/index.js"),c=o("../node_modules/punycode/punycode.es6.js"),f=o("./js/composables/dateFilter.ts"),u=o("./js/composables/gettext.ts");const{$gettext:A,$ngettext:_,$gettextInterpolate:k}=(0,u.Z)(),j=l=>{var p;return l?((p=l.at(0))===null||p===void 0?void 0:p.toUpperCase())+l.slice(1):""},M=(l,p="datetime")=>(0,f.W)(p,l),P=l=>(0,d.Z)(l,new Date),$=(l,p=1024)=>{const b=Number(l);if(!b)return"0 B";const x=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],O=Math.floor(Math.log(b)/Math.log(p));return`${parseFloat((b/p**O).toFixed(2))} ${x[O]}`},U=l=>{try{return(0,c.xX)(l)}catch(p){return l}},Z=l=>(0,c.xX)(l),R=l=>{if(!l||!l.includes("@"))return l;const[p,b]=l.split("@");return[p,U(b)].join("@")},D=l=>{if(l<60)return A("less than a minute");const p=Math.floor(l/60)%60,b=Math.floor(l/3600)%24,x=Math.floor(l/(3600*24)),O=[x?_("%{days} day","%{days} days",x):null,b?_("%{hours} hour","%{hours} hours",b):null,p?_("%{minutes} minute","%{minutes} minutes",p):null].filter(Boolean).join(", ");return k(O,{days:x,hours:b,minutes:p})},w=(l,p)=>l.length<=p?l:`${l.substring(0,p)}...`,B=()=>({capitalize:j,date:M,distanceFromNow:P,humanReadableSize:$,p6eUnicode:Z,p6eUnicodeEmail:R,formatUptime:D,truncateString:w})},"./js/pages/user/messages/index.vue":function(T,S,o){"use strict";o.r(S),o.d(S,{default:function(){return ce}});var d={};o.r(d),o.d(d,{clearSystem:function(){return Z},deleteMessages:function(){return U},getClearOptions:function(){return R},getMessage:function(){return $},getMessages:function(){return k},getSystemOptions:function(){return D},getTicket:function(){return M},getTickets:function(){return j},markRead:function(){return B},postReply:function(){return P},saveSystemOptions:function(){return w}});var c=function(){var e=this,t=e._self._c;return t("app-page",{scopedSlots:e._u([{key:"default",fn:function(){return[t("app-page-section",[t("ui-tabs",{attrs:{tabs:[{id:"messages",label:e.$gettext("Messages")},e.$_flags.server.ticketsEnabled?{id:"tickets",label:e.$gettext("Tickets")}:{}],"hide-single-tab":"",selected:e.tab,"force-horizontal":""},on:{"update:selected":function(n){e.tab=n}},scopedSlots:e._u([{key:"tab:messages",fn:function(){return[t("ui-api-table",e._b({ref:"table",on:{"action:del":function(n){e.$dialog("DELETE_ITEMS_DIALOG").open()},"action:read":e.markAsRead},scopedSlots:e._u([{key:"col:subject",fn:function({id:n,new:Q,subject:V}){return[t("ui-link",{on:{click:function(J){return e.openMessageDialog(n)}}},[t("span",{class:{"txt:bold":Q},domProps:{innerHTML:e._s(V)}})])]}},{key:"col:last_message",fn:function({last_message:n}){return[e._v(`
                            `+e._s(e.date(n,"datetime"))+`
                        `)]}}]),model:{value:e.select,callback:function(n){e.select=n},expression:"select"}},"ui-api-table",{command:e.$commands.getMessages,rowID:"id",columns:{subject:{label:e.$gettext("Subject"),grow:!0},last_message:e.$gettext("Date")},actions:{read:e.$gettext("Mark as read"),del:e.$gettext("Delete")},initialSort:{key:"last_message",order:"DESC"}},!1))]},proxy:!0},{key:"tab:tickets",fn:function(){return[t("tickets-table")]},proxy:!0}])})],1),e._v(" "),t("ui-dialog-delete-items",{attrs:{subject:e.$ngettext("message","messages",e.select.length)},on:{"click:confirm":e.deleteMessages}}),e._v(" "),t("view-message-dialog"),e._v(" "),e.$commands.getTicket.data.isDone?t("view-ticket-dialog"):e._e(),e._v(" "),t("clear-message-system-dialog",{on:{updateMessages:e.$reloadApiTable}}),e._v(" "),t("message-system-options-dialog")]},proxy:!0},{key:"bottom:links",fn:function(){return[t("ui-link",{attrs:{bullet:""},on:{click:function(n){e.$dialog("CLEAR_MESSAGE_SYSTEM_DIALOG").open()}}},[t("span",{domProps:{textContent:e._s(e.$gettext("Clear Message System"))}})]),e._v(" "),t("ui-link",{attrs:{bullet:""},on:{click:e.openOptionsDialog}},[t("span",{domProps:{textContent:e._s(e.$gettext("Options"))}})]),e._v(" "),e.$_session.creator!=="root"&&e.$_flags.server.ticketsEnabled?t("ui-link",{attrs:{name:"user/create-ticket",bullet:""}},[t("span",{domProps:{textContent:e._s(e.$gettext("Create Ticket"))}})]):e._e()]},proxy:!0}])})},f=[],u=o("./js/api/command/index.js"),A=o("../node_modules/date-fns/esm/formatDistance/index.js");const _="/CMD_TICKET",k=u.Z.get({id:"MESSAGES",url:_,params:{type:"message"},pagination:!0,schema:{sort:{...u.Z.SORT,default:[{key:3,order:"DESC"}]}},after:s=>s.flow(s.project({rows:"messages"}),s.processTableInfo("rows"),s.mapProp("rows",s.flow(s.mapArray(s.moveProp("message","id")),s.mapArrayProps({new:s.convert.toAppBoolean,last_message:s.convert.toAppDate,subject:s.convert.toAppHtml}))))}),j=u.Z.get({id:"TICKETS",url:_,params:{type:"ticket"},pagination:!0,schema:{sort:u.Z.SORT,show_closed:{type:Boolean,required:!1,default:!0}},after:s=>s.flow(s.getProp("tickets"),s.toTable(s.mapArrayProps({subject:s.convert.toAppString,last_message:s.convert.toAppDate,new:s.convert.toAppBoolean})))}),M=u.Z.get({id:"TICKET",url:_,response:[],params:{action:"view",type:"ticket"},schema:{number:u.Z.REQUIRED_STRING},after:s=>s.flow(s.deleteProp("info"),s.toArray,e=>e.reverse(),s.mapArrayProps({message:s.convert.toAppHtml,time:e=>(0,A.Z)(Date.now(),s.convert.toAppDate(e))}))}),P=u.Z.post({url:_,params:{action:"reply",type:"reply",user:"creator",subject:"none",priority:"0"},schema:{message:u.Z.REQUIRED_STRING,number:u.Z.REQUIRED_STRING}}),$=u.Z.get({id:"MESSAGE",url:_,params:{action:"view",type:"message"},schema:{number:u.Z.REQUIRED_STRING},after:s=>s.flow(s.getProp("0"),s.moveProp("message","content"),s.mapProps({priority:s.convert.toAppNumber,content:s.convert.toAppHtml,time:s.convert.toAppDate}))}),U=u.Z.select({url:_,params:{action:"multiple",delete:!0,type:"message"}}),Z=u.Z.post({url:_,params:{action:"clear"},schema:{subject:u.Z.REQUIRED_STRING,when:u.Z.REQUIRED_STRING,delete_messages_days:u.Z.OPTIONAL_STRING}}),R=u.Z.get({id:"CLEAR_MESSAGES_OPTIONS",url:_,after:s=>s.flow(s.project({subjects:"clear_messages.SUBJECT_SELECT",periods:"clear_messages.WHEN_SELECT"}),s.mapProps({subjects:s.flow(s.toArray,s.mapArray(s.getProp("text")),s.filter(s.flow(s.isEqual("-- anything --"),s.not))),periods:s.transformObject(({text:e,value:t})=>({[t]:e}))}))}),D=u.Z.get({id:"MESSAGES_SYSTEM_OPTIONS",url:_,after:s=>s.flow(s.getProp("settings"),s.project({"days.messages":"DELETE_MESSAGES_DAYS","days.tickets":"DELETE_TICKETS_DAYS",email:"EMAIL",send:"EMAILCHECKED"}),s.mapProp("send",s.isEqual("checked")))}),w=u.Z.post({url:_,params:{action:"email",save:!0},schema:{email:u.Z.REQUIRED_STRING,ON:u.Z.REQUIRED_BOOL,delete_tickets_days:u.Z.REQUIRED_STRING,delete_messages_days:u.Z.REQUIRED_STRING},notifySuccess:!1}),B=u.Z.select({url:_,params:{action:"multiple",read:!0,type:"message"}});var l=o("./js/context/index.ts"),p=function(){var e=this,t=e._self._c;return t("ui-dialog",{attrs:{id:"VIEW_MESSAGE_DIALOG",size:"normal","no-close-btn":e.$api.isLoading,title:e.$gettext("Message"),cancel:!1},on:{"dialog:close":function(n){return e.$emit("close")}},scopedSlots:e._u([{key:"content:header",fn:function(){return[e.$api.isLoading?e._e():t("header",{directives:[{name:"flex",rawName:"v-flex",value:{main:"between",cross:"baseline",wrap:!0},expression:`{
                main: 'between',
                cross: 'baseline',
                wrap: true,
            }`},{name:"gutter",rawName:"v-gutter",value:[1,2],expression:"[1, 2]"}]},[t("h2",{directives:[{name:"margin",rawName:"v-margin",value:0,expression:"0"}],staticClass:"overfl:hid toverfl:ellipsis",domProps:{textContent:e._s(e.$api.subject)}}),e._v(" "),t("time",[e._v(`
                `+e._s(e.date(e.$api.time,"datetime"))+`
            `)])])]},proxy:!0},{key:"content",fn:function(){return[t("ui-code-area",{attrs:{content:e.$api.content,"break-lines":""}})]},proxy:!0}])})},b=[],x=o("./js/composables/filters.ts"),O={api:[{command:$,bind:{"response.content":"content","response.time":"time","response.subject":"subject"}}],methods:{date:x.hT}},W=O,a=o("../node_modules/vue-loader/lib/runtime/componentNormalizer.js"),i=(0,a.Z)(W,p,b,!1,null,null,null),r=i.exports,v=function(){var e=this,t=e._self._c;return t("ui-dialog",{attrs:{id:"CLEAR_MESSAGE_SYSTEM_DIALOG",size:"normal",title:e.$gettext("Clear Message System")},scopedSlots:e._u([{key:"content",fn:function(){return[t("ui-form-element",{attrs:{group:"clearMessages"},scopedSlots:e._u([{key:"title",fn:function(){return[t("span",{domProps:{textContent:e._s(e.$gettext("Subject Contains"))}})]},proxy:!0},{key:"content",fn:function(){return[t("input-autocomplete",{attrs:{values:e.subjects,disabled:e.deleteEverything},scopedSlots:e._u([{key:"additions:right",fn:function(){return[t("input-checkbox-button",{model:{value:e.deleteEverything,callback:function(n){e.deleteEverything=n},expression:"deleteEverything"}},[t("span",{domProps:{textContent:e._s(e.$gettext("Anything"))}})])]},proxy:!0}]),model:{value:e.subject,callback:function(n){e.subject=n},expression:"subject"}})]},proxy:!0},{key:"error:validateSubject",fn:function(){return[t("span",{domProps:{textContent:e._s(e.$gettext("Required field"))}})]},proxy:!0}])}),e._v(" "),t("ui-form-element",{attrs:{group:"clearMessages"},scopedSlots:e._u([{key:"title",fn:function(){return[t("span",{domProps:{textContent:e._s(e.$gettext("When"))}})]},proxy:!0},{key:"content",fn:function(){return[e.when==="all"?t("input-select",{attrs:{options:e.periods,disabled:e.deleteEverything,novalidate:""},model:{value:e.when,callback:function(n){e.when=n},expression:"when"}}):t("ui-input-group",{scopedSlots:e._u([{key:"additions:left",fn:function(){return[t("input-select",{attrs:{options:e.periods},model:{value:e.when,callback:function(n){e.when=n},expression:"when"}})]},proxy:!0},{key:"input",fn:function(){return[t("input-text",{attrs:{number:""},model:{value:e.days,callback:function(n){e.days=n},expression:"days"}})]},proxy:!0},{key:"additions:right",fn:function(){return[t("ui-button",{attrs:{disabled:""}},[t("span",{domProps:{textContent:e._s(e.$ngettext("Day","Days",Number(e.days)||1))}})])]},proxy:!0}])})]},proxy:!0}])})]},proxy:!0},{key:"buttons",fn:function(){return[t("ui-button",{attrs:{theme:"danger",disabled:!(e.deleteEverything||e.subject)||!e.days},on:{click:e.clearMessageSystem}},[t("span",{domProps:{textContent:e._s(e.$gettext("Clear"))}})])]},proxy:!0}])})},h=[],E={data:()=>({subject:"",when:"all",days:"1",deleteEverything:!1}),api:[{command:R,bind:"options"}],computed:{subjects(){return this.$api.options.subjects},periods(){return this.$api.options.periods}},watch:{when(s){s==="all"&&!this.days&&(this.days="1")}},methods:{async clearMessageSystem(){await Z({delete_messages_days:this.days,subject:this.deleteEverything?"":this.subject,subject_select:this.deleteEverything?"2":null,when:this.when}),this.$_ctx.session.stateReload(),this.$emit("updateMessages")}}},m=E,C=(0,a.Z)(m,v,h,!1,null,null,null),g=C.exports,N=function(){var e=this,t=e._self._c;return t("ui-dialog",{attrs:{id:"MESSAGE_SYSTEM_OPTIONS_DIALOG",title:e.$gettext("Options")},on:{"dialog:open":e.initData},scopedSlots:e._u([{key:"content",fn:function(){return[t("ui-form-element",{attrs:{vertical:"",group:"messageOptions",validators:{required:e.send}},scopedSlots:e._u([{key:"title",fn:function(){return[t("input-checkbox",{model:{value:e.send,callback:function(n){e.send=n},expression:"send"}},[t("span",{domProps:{textContent:e._s(e.$gettext("E-mail a copy of all messages"))}})])]},proxy:!0},{key:"content",fn:function(){return[t("input-text",{attrs:{disabled:!e.send},model:{value:e.email,callback:function(n){e.email=n},expression:"email"}})]},proxy:!0},{key:"error:regex",fn:function(){return[t("span",{domProps:{textContent:e._s(e.$gettext("Should be valid email"))}})]},proxy:!0}])}),e._v(" "),t("ui-form-element",{attrs:{vertical:"",group:"messageOptions",validators:{required:!0}},scopedSlots:e._u([{key:"title",fn:function(){return[t("input-checkbox",{model:{value:e.deleteTickets,callback:function(n){e.deleteTickets=n},expression:"deleteTickets"}},[t("span",{domProps:{textContent:e._s(e.$gettext("Automatically delete tickets"))}})])]},proxy:!0},{key:"content",fn:function(){return[e.deleteTickets?t("input-text",{attrs:{number:""},scopedSlots:e._u([{key:"additions:left",fn:function(){return[t("ui-button",{attrs:{disabled:""}},[t("span",{staticClass:"wrap:nowrap",domProps:{textContent:e._s(e.$gettext("Older than"))}})])]},proxy:!0},{key:"additions:right",fn:function(){return[t("ui-button",{attrs:{disabled:""}},[t("span",{staticClass:"wrap:nowrap",domProps:{textContent:e._s(e.$gettext("Days"))}})])]},proxy:!0}],null,!1,449330526),model:{value:e.days.tickets,callback:function(n){e.$set(e.days,"tickets",n)},expression:"days.tickets"}}):e._e()]},proxy:!0}])}),e._v(" "),t("ui-form-element",{attrs:{group:"messageOptions",vertical:"",validators:{required:!0}},scopedSlots:e._u([{key:"title",fn:function(){return[t("input-checkbox",{model:{value:e.deleteMessages,callback:function(n){e.deleteMessages=n},expression:"deleteMessages"}},[t("span",{domProps:{textContent:e._s(e.$gettext("Automatically delete messages"))}})])]},proxy:!0},{key:"content",fn:function(){return[e.deleteMessages?t("input-text",{attrs:{number:""},scopedSlots:e._u([{key:"additions:left",fn:function(){return[t("ui-button",{attrs:{disabled:""}},[t("span",{staticClass:"wrap:nowrap",domProps:{textContent:e._s(e.$gettext("Older than"))}})])]},proxy:!0},{key:"additions:right",fn:function(){return[t("ui-button",{attrs:{disabled:""}},[t("span",{staticClass:"wrap:nowrap",domProps:{textContent:e._s(e.$gettext("days"))}})])]},proxy:!0}],null,!1,707100606),model:{value:e.days.messages,callback:function(n){e.$set(e.days,"messages",n)},expression:"days.messages"}}):e._e()]},proxy:!0}])})]},proxy:!0},{key:"buttons",fn:function(){return[t("ui-button",{attrs:{"validate-group":"messageOptions",theme:"primary"},on:{click:e.save}},[t("span",{domProps:{textContent:e._s(e.$gettext("Save"))}})])]},proxy:!0}])})},L=[],I=o("../node_modules/ramda/es/index.js"),Y={data:()=>({send:!1,email:"",days:{tickets:"0",messages:"0"},deleteTickets:!1,deleteMessages:!1}),api:[{command:D,bind:"options"}],created(){this.initData()},methods:{async save(){const{success:s}=await w({delete_messages_days:this.deleteMessages?this.days.messages:"0",delete_tickets_days:this.deleteTickets?this.days.tickets:"0",ON:this.send,email:this.email});s&&this.$notifications.success({title:this.$gettext("Options saved successfully"),content:this.$gettext("Message configuration has been updated")})},initData(){Object.assign(this,I.d9v(this.$api.options)),this.deleteTickets=this.days.tickets!=="0",this.deleteMessages=this.days.messages!=="0"}}},y=Y,G=o("../node_modules/vue-style-loader/index.js!../node_modules/mini-css-extract-plugin/dist/loader.js??clonedRuleSet-13.use[1]!../node_modules/css-loader/dist/cjs.js??clonedRuleSet-13.use[2]!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/postcss-loader/dist/cjs.js??clonedRuleSet-13.use[3]!../node_modules/sass-loader/dist/cjs.js??clonedRuleSet-13.use[4]!../node_modules/vue-loader/lib/index.js??vue-loader-options!../node_modules/unplugin/dist/webpack/loaders/transform.js?unpluginName=unplugin-vue-define-options!./js/pages/user/messages/_dialogs/message-system-options.vue?vue&type=style&index=0&id=c7090fbc&prod&lang=scss&"),K=(0,a.Z)(y,N,L,!1,null,null,null),H=K.exports,X=function(){var e=this,t=e._self._c;return t("ui-dialog",{attrs:{id:"VIEW_TICKET_DIALOG",size:"normal","no-close-btn":""},scopedSlots:e._u([{key:"title",fn:function(){return[t("span",{domProps:{textContent:e._s(e.$gettextInterpolate(e.$gettext("View Ticket: #%{ number }"),{number:e.number}))}})]},proxy:!0},{key:"content",fn:function(){return[t("div",[t("ui-form-element",{staticClass:"pos:rel",attrs:{vertical:"",validators:{required:!0},group:"ticketReply"},scopedSlots:e._u([{key:"content",fn:function(){return[t("input-textarea",{attrs:{rows:"5",placeholder:e.$gettext("Type your reply here...")},model:{value:e.message,callback:function(n){e.message=n},expression:"message"}}),e._v(" "),t("ui-button",{staticClass:"replyButton",attrs:{theme:"safe",size:"normal","validate-group":"ticketReply"},on:{click:e.postReply}},[t("span",{domProps:{textContent:e._s(e.$gettext("Post Reply"))}})])]},proxy:!0}])}),e._v(" "),t("ui-table",{attrs:{items:e.messages,"hide-headers":""}},[t("ui-column",{attrs:{id:"avatar",fit:""},scopedSlots:e._u([{key:"default",fn:function(n){return[t("ui-round-badge",{staticClass:"messageAvatar",attrs:{theme:e.$_useStore("user").name===n.from?"safe":"primary",size:48}},[e._v(`
                            `+e._s(e._f("firstLetter")(n.from))+`
                        `)])]}}])}),e._v(" "),t("ui-column",{attrs:{id:"message"},scopedSlots:e._u([{key:"default",fn:function(n){return[t("ui-grid",{attrs:{column:""}},[t("ui-grid",{attrs:{cross:"center"}},[t("span",{staticClass:"userName"},[e._v(`
                                    `+e._s({admin:e.$gettext("Admin"),reseller:e.$gettext("Reseller"),user:e.$gettext("User")}[n.level])+`:
                                    `+e._s(n.name)+`
                                `)]),e._v(" "),t("span",{staticClass:"c:txt:neutral"},[e._v(`
                                    (`+e._s(n.time)+`)
                                `)])]),e._v(" "),t("p",{domProps:{innerHTML:e._s(n.message)}})],1)]}}])})],1)],1)]},proxy:!0}])})},F=[],z={api:[{command:M,bind:"messages"}],filters:{firstLetter:s=>s[0].toUpperCase()},data:()=>({message:""}),computed:{number(){return M.data.params.number||""},messages(){return this.$api.messages}},methods:{async postReply(){await P({number:this.number,message:this.message}),Object.assign(this.$data,this.$options.data.apply(this)),M({number:this.number})}}},q=z,me=o("../node_modules/vue-style-loader/index.js!../node_modules/mini-css-extract-plugin/dist/loader.js??clonedRuleSet-13.use[1]!../node_modules/css-loader/dist/cjs.js??clonedRuleSet-13.use[2]!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/postcss-loader/dist/cjs.js??clonedRuleSet-13.use[3]!../node_modules/sass-loader/dist/cjs.js??clonedRuleSet-13.use[4]!../node_modules/vue-loader/lib/index.js??vue-loader-options!../node_modules/unplugin/dist/webpack/loaders/transform.js?unpluginName=unplugin-vue-define-options!./js/pages/user/messages/_dialogs/view-ticket-dialog.vue?vue&type=style&index=0&id=5a32ee59&prod&lang=scss&"),ee=(0,a.Z)(q,X,F,!1,null,null,null),te=ee.exports,se=function(){var e=this,t=e._self._c;return t("ui-api-table",e._b({ref:"table",attrs:{"disable-select":""},scopedSlots:e._u([{key:"buttons:before",fn:function(){return[t("input-checkbox",{model:{value:e.showClosed,callback:function(n){e.showClosed=n},expression:"showClosed"}},[t("span",{domProps:{textContent:e._s(e.$gettext("Show closed"))}})])]},proxy:!0},{key:"col:subject",fn:function({new:n,priority:Q,subject:V,ticket:J}){return[t("ui-link",{class:{"txt:bold":n},on:{click:function(pe){return e.openTicket(J)}}},[t("ui-round-badge",{attrs:{theme:{0:"safe",10:"safe",20:"primary",30:"danger"}[Q],size:12}}),e._v(`
            `+e._s(V)+`
        `)],1)]}},{key:"col:status",fn:function({status:n}){return[t("ui-badge",{attrs:{theme:{open:"safe",closed:"neutral"}[n]}},[e._v(`
            `+e._s(e.capitalize(n))+`
        `)])]}},{key:"col:last_message",fn:function({last_message:n}){return[e._v(`
        `+e._s(e.date(n,"datetime"))+`
    `)]}}])},"ui-api-table",{command:e.$commands.getTickets,rowID:"ticket",columns:{ticket:e.$gettext("Ticket #"),subject:e.$gettext("Subject"),replies:e.$gettext("Replies"),status:e.$gettext("Status"),last_message:e.$gettext("Last Message")},requestData:{show_closed:e.showClosed}},!1))},ne=[],ae={data:()=>({showClosed:!0}),computed:{newTickets(){return l.T.session.values.user.newTickets}},commands:{getTickets:j},watch:{newTickets(s,e){Number(s)>Number(e)&&this.$refs.table.reloadTable()}},created(){this.$route.query.ticket&&this.openTicket(this.$route.query.ticket)},methods:{capitalize:x.kC,date:x.hT,async openTicket(s){await M({number:s}),this.$dialog("VIEW_TICKET_DIALOG").open(),this.$_ctx.session.stateReload(),this.$reloadApiTable()}}},oe=ae,re=(0,a.Z)(oe,se,ne,!1,null,null,null),ie=re.exports,le={name:"UserMessages",components:{TicketsTable:ie,ViewMessageDialog:r,ClearMessageSystemDialog:g,MessageSystemOptionsDialog:H,ViewTicketDialog:te},preload:[k,j,R],commands:d,data:()=>({select:[]}),computed:{newMessages(){return l.T.session.values.user.newMessages},tab:{get(){return this.$route.path==="/user/messages"?"messages":"tickets"},set(s){this.$route.path!==`/user/${s}`&&this.$router.push({path:s==="messages"?"/user/messages":"/user/tickets",query:this.$route.query})}},page(){return this.$route.query.page||"1"},ipp(){return this.$route.query.ipp||"20"}},watch:{newMessages(){this.$refs.table&&this.$refs.table.reloadTable()}},created(){this.$route.query.id&&this.openMessageDialog(this.$route.query.id),this.$route.query.ticket&&(this.tab="tickets")},methods:{date:x.hT,async openMessageDialog(s){await $({number:s})?(this.$dialog("VIEW_MESSAGE_DIALOG").open(),this.$_ctx.session.stateReload()):this.$notifications.error({title:this.$gettext("Cannot execute your request"),content:this.$gettext(`Message #${s} is not appears in your message system`)})},async deleteMessages(){await U({select:this.select}),Object.assign(this.$data,this.$options.data.apply(this)),this.$_ctx.session.stateReload(),this.$refs.table.reloadTable()},markAsRead(){B({select:this.select}).then(()=>{Object.assign(this.$data,this.$options.data.apply(this))}).then(this.$reloadApiTable)},async openOptionsDialog(){await D(),this.$dialog("MESSAGE_SYSTEM_OPTIONS_DIALOG").open()}}},ue=le,de=(0,a.Z)(ue,c,f,!1,null,null,null),ce=de.exports},"../node_modules/vue-style-loader/index.js!../node_modules/mini-css-extract-plugin/dist/loader.js??clonedRuleSet-13.use[1]!../node_modules/css-loader/dist/cjs.js??clonedRuleSet-13.use[2]!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/postcss-loader/dist/cjs.js??clonedRuleSet-13.use[3]!../node_modules/sass-loader/dist/cjs.js??clonedRuleSet-13.use[4]!../node_modules/vue-loader/lib/index.js??vue-loader-options!../node_modules/unplugin/dist/webpack/loaders/transform.js?unpluginName=unplugin-vue-define-options!./js/pages/user/messages/_dialogs/message-system-options.vue?vue&type=style&index=0&id=c7090fbc&prod&lang=scss&":function(T,S,o){var d=o("../node_modules/mini-css-extract-plugin/dist/loader.js??clonedRuleSet-13.use[1]!../node_modules/css-loader/dist/cjs.js??clonedRuleSet-13.use[2]!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/postcss-loader/dist/cjs.js??clonedRuleSet-13.use[3]!../node_modules/sass-loader/dist/cjs.js??clonedRuleSet-13.use[4]!../node_modules/vue-loader/lib/index.js??vue-loader-options!../node_modules/unplugin/dist/webpack/loaders/transform.js?unpluginName=unplugin-vue-define-options!./js/pages/user/messages/_dialogs/message-system-options.vue?vue&type=style&index=0&id=c7090fbc&prod&lang=scss&");d.__esModule&&(d=d.default),typeof d=="string"&&(d=[[T.id,d,""]]),d.locals&&(T.exports=d.locals);var c=o("../node_modules/vue-style-loader/lib/addStylesClient.js").Z,f=c("2c7caf98",d,!0,{})},"../node_modules/vue-style-loader/index.js!../node_modules/mini-css-extract-plugin/dist/loader.js??clonedRuleSet-13.use[1]!../node_modules/css-loader/dist/cjs.js??clonedRuleSet-13.use[2]!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/postcss-loader/dist/cjs.js??clonedRuleSet-13.use[3]!../node_modules/sass-loader/dist/cjs.js??clonedRuleSet-13.use[4]!../node_modules/vue-loader/lib/index.js??vue-loader-options!../node_modules/unplugin/dist/webpack/loaders/transform.js?unpluginName=unplugin-vue-define-options!./js/pages/user/messages/_dialogs/view-ticket-dialog.vue?vue&type=style&index=0&id=5a32ee59&prod&lang=scss&":function(T,S,o){var d=o("../node_modules/mini-css-extract-plugin/dist/loader.js??clonedRuleSet-13.use[1]!../node_modules/css-loader/dist/cjs.js??clonedRuleSet-13.use[2]!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/postcss-loader/dist/cjs.js??clonedRuleSet-13.use[3]!../node_modules/sass-loader/dist/cjs.js??clonedRuleSet-13.use[4]!../node_modules/vue-loader/lib/index.js??vue-loader-options!../node_modules/unplugin/dist/webpack/loaders/transform.js?unpluginName=unplugin-vue-define-options!./js/pages/user/messages/_dialogs/view-ticket-dialog.vue?vue&type=style&index=0&id=5a32ee59&prod&lang=scss&");d.__esModule&&(d=d.default),typeof d=="string"&&(d=[[T.id,d,""]]),d.locals&&(T.exports=d.locals);var c=o("../node_modules/vue-style-loader/lib/addStylesClient.js").Z,f=c("831c179a",d,!0,{})}}]);
