"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[3526],{"./js/api/commands/user/email/accounts/index.js":function(h,E,i){i.r(E),i.d(E,{$processors:function(){return _},changeDKIMStatus:function(){return T},changePassword:function(){return a},createAccount:function(){return t},deleteAccounts:function(){return R},getAccounts:function(){return A},getLoginsList:function(){return D},modifyAccount:function(){return s},purgeAccounts:function(){return u},suspendAccounts:function(){return x},unsuspendAccounts:function(){return P},webmailSSO:function(){return M}});var e=i("./js/api/command/index.js"),p=i("../node_modules/monet/dist/monet.js"),S=i.n(p),m=i("./js/api/converters.js");const g=r=>p.Maybe.Some(r).map(Number).filter(Number.isFinite).orSome(1/0),_={sent:r=>p.Maybe.fromNull(r).filter(n=>typeof n=="object").flatMap(({sent:n,send_limit:o})=>{try{return p.Maybe.Some({usage:g(n),limit:g(o)})}catch(l){return p.Maybe.None()}}).orSome(!1),lastChange:r=>p.Maybe.fromNull(r).map(({ip:n,when:o})=>({ip:(0,p.Identity)(n).map(m.toAppString).map(m.toAppText).get(),when:(0,p.Identity)(o).map(m.toAppDate).get()})).orSome(!1)},A=e.Z.get({id:"EMAIL_ACCOUNTS",url:"/CMD_EMAIL_POP",domain:!0,pagination:!0,params:{bytes:!0},after:r=>r.flow(r.wrap("options"),r.moveProp({"options.emails":"emails","options.EMAIL_MESSAGE":"options.email_message"}),r.mapProps({emails:r.toTable(r.mapArray(r.flow(r.moveProp({"usage.last_login":"last_login","usage.last_password_change":"last_password_change"}),r.mapProps({login:n=>n.includes("@")?n.split("@")[0]:n,is_default:(n,{login:o})=>!o.includes("@"),sent:_.sent,usage:r.mapValues(g),last_login:_.lastChange,last_password_change:_.lastChange})))),options:r.mapProps({DKIM:r.isEqual("1"),DKIM_ENABLED:r.isEqual("1"),block_cracking_unblock:r.convert.toAppNumber,clean_forwarders_on_email_delete:r.isEqual("1"),count_pop_usage:r.isEqual("1"),pop_disk_usage_cache:r.isEqual("1"),pop_disk_usage_true_bytes:r.isEqual("1"),user_can_set_email_limit:r.isEqual("1"),purge_select:r.toSelect,when_select:r.toSelect,HAVE_ONE_CLICK_WEBMAIL_LOGIN:r.convert.toAppBoolean,system_user_to_virtual_passwd:r.isEqual("1")})}))}),I=e.Z.post({url:"/CMD_EMAIL_POP",params:{action:"delete"},domain:!0}),x=I.extend({params:{suspend:!0}}),P=I.extend({params:{unsuspend:!0}}),R=I.extend({params:{delete:!0},schema:{clean_forwarders:e.Z.REQUIRED_BOOL}}),u=I.extend({params:{purge:!0},body:{file:e.Z.REQUIRED_STRING,what:e.Z.REQUIRED_STRING}}),t=e.Z.post({url:"/CMD_EMAIL_POP",params:{action:"create"},domain:!0,schema:{user:e.Z.USER,passwd2:e.Z.PASSWORD,passwd:e.Z.PASSWORD,quota:e.Z.REQUIRED_STRING,limit:e.Z.OPTIONAL_STRING},after:r=>r.mapProp("result",n=>n.replace(/(\\n)+/g,`
`))}),s=e.Z.post({url:"/CMD_EMAIL_POP",params:{action:"modify"},domain:!0,schema:{user:e.Z.USER,newuser:e.Z.USER,passwd2:e.Z.OPTIONAL_STRING,passwd:e.Z.OPTIONAL_STRING,quota:e.Z.REQUIRED_STRING,limit:e.Z.OPTIONAL_STRING}}),a=e.Z.post({url:"/CMD_CHANGE_EMAIL_PASSWORD",schema:{email:e.Z.REQUIRED_STRING,oldpassword:e.Z.REQUIRED_STRING,password1:e.Z.REQUIRED_STRING,password2:e.Z.REQUIRED_STRING}}),T=e.Z.post({url:"/CMD_EMAIL_POP",domain:!0,schema:{action:e.Z.REQUIRED_STRING},before:({action:r})=>({action:"set_dkim",[r]:!0})}),M=e.Z.post({url:"/CMD_WEBMAIL_LOGIN",notifySuccess:!1,schema:{email:e.Z.REQUIRED_STRING}}),D=e.Z.get({id:"LOGINS_LIST",url:"/CMD_EMAIL_POP",domain:!0,response:[],params:{quick:!0},mapResponse:r=>r.emails})},"./js/api/endpoint/index.ts":function(h,E,i){i.d(E,{RA:function(){return r},yY:function(){return M},HT:function(){return t},a4:function(){return s},MA:function(){return R}});var e=i("./js/api/endpoint/request.ts"),p=i("../node_modules/vue/dist/vue.common.prod.js");const S=(n,o)=>{const l=(0,p.reactive)({data:n,params:o,state:{isLoading:!1,isOk:!0,isError:!1,error:null}});return{store:l,setData:c=>{l.data=c},setParams:c=>{l.params=c},setState:c=>{l.state=Object.assign({},{isLoading:!1,isOk:!1,isError:!1,error:null},c)}}};var m=i("../node_modules/ramda/es/index.js"),g=i("./js/context/index.ts");const _=(n,o)=>{if(n.includes(":")){const l=/:[a-z]*/g,d=[];return{url:n.replace(l,f=>{if(f===":domain"&&!o.domain)return g.T.session.domain;f=f.slice(1);const c=o[f].toString();if(typeof c=="undefined")throw new Error(`EndpointParamError: ${f} is not defined`);return d.push(f),c}),urlParams:d}}return{url:n,urlParams:[]}},A=(n,o,l={})=>{const{store:d,setData:y,setState:f,setParams:c}=S(l.data||{},{});return{store:d,setData:y,request:async O=>{const N={method:n,url:o,params:O||{},options:l};if(!(O instanceof FormData)){const k=m.D95(L=>typeof L=="string"||typeof L=="number",N.params),U=_(o,k);N.url=U.url,O&&(N.params=m.CEd(U.urlParams,N.params))}c(O||{}),f({isLoading:!0,isError:!1,error:null,isOk:!0});const C=await(0,e.W)(N);return C.state==="success"&&n==="get"&&y(C.data),f({isLoading:!1}),C.state==="error"&&f({error:C,isError:!0,isOk:!1}),C}}},I=(n,o,l={})=>{const{store:d,setData:y,request:f}=A(n,o,l);return Object.freeze({get data(){return m.d9v(d.data)},set data(c){y(c)},get params(){return m.d9v(d.params)},get state(){return m.d9v(d.state)},request:f,bindData(c){return function(){return c?c(d.data):d.data}}})},x=(n,o,l={})=>{const{store:d,request:y}=A(n,o,l);return Object.freeze({get params(){return m.d9v(d.params)},get state(){return m.d9v(d.state)},request:y})},P=(n,o)=>(n.notify(),o(!1)),R=(n,o=P)=>async(l,d,y)=>{const c=(await Promise.all(n.map(v=>v(l,d)))).find(v=>v.state==="error");if(typeof c!="undefined"){const{error:v}=c;return o(v,y)}y()};var u=i("./js/gettext.js");const t=(n,o)=>I("get",n,o),s=(n,o)=>x("post",n,o),a=(n,o)=>createMutation("put",n,o),T=(n,o)=>createMutation("patch",n,o),M=(n,o)=>x("delete",n,o),D=null,r=u.$gettext},"./js/endpoints/imapsync/index.ts":function(h,E,i){i.d(E,{Vv:function(){return S},gi:function(){return g},pv:function(){return m},uW:function(){return _}});var e=i("./js/api/endpoint/index.ts");const p={IMAPSYNC_AUTHENTICATION_FAILURE:(0,e.RA)("ImapSync authentication failure"),IMAPSYNC_CONNECTION_FAILURE:(0,e.RA)("ImapSync connection failure"),IMAPSYNC_CONNECTION_FAILURE_HOST_SRC:(0,e.RA)("ImapSync host source connection failure"),IMAPSYNC_CONNECTION_FAILURE_HOST_DST:(0,e.RA)("ImapSync host destination connection failure"),IMAPSYNC_AUTHENTICATION_FAILURE_USER_SRC:(0,e.RA)("ImapSync user source authentication failure"),IMAPSYNC_AUTHENTICATION_FAILURE_USER_DST:(0,e.RA)("ImapSync user destination authentication failure"),IMAPSYNC_MIGRATION_LIMIT_ERROR:(0,e.RA)("Destination email is currently being used for migration by another process")},S=(0,e.HT)("/imapsync/migrations"),m=(0,e.yY)("/imapsync/migrations/:id",{errorMessages:{IMAPSYNC_PROCESS_NOT_FOUND:(0,e.RA)("ImapSync process not found")}}),g=(0,e.a4)("/imapsync/import",{errorMessages:p}),_=(0,e.a4)("/imapsync/export",{errorMessages:p})},"./js/pages/user/imapsync/import.vue":function(h,E,i){i.r(E),i.d(E,{default:function(){return R}});var e=function(){var t=this,s=t._self._c;return s("app-page",{scopedSlots:t._u([{key:"default",fn:function(){return[s("app-page-section",{scopedSlots:t._u([{key:"section:title",fn:function(){return[s("span",{domProps:{textContent:t._s(t.$gettext("Source"))}})]},proxy:!0}])},[t._v(" "),s("ui-form-element",{attrs:{group:"imapsync",validators:{required:!0,domain:!0,response:t.validateSrcHost}},scopedSlots:t._u([{key:"title",fn:function(){return[s("span",{domProps:{textContent:t._s(t.$gettext("Host"))}})]},proxy:!0},{key:"content",fn:function(){return[s("input-text",{on:{keyup:function(a){return!a.type.indexOf("key")&&t._k(a.keyCode,"enter",13,a.key,"Enter")?null:t.imapsync.apply(null,arguments)}},model:{value:t.from.server,callback:function(a){t.$set(t.from,"server",a)},expression:"from.server"}})]},proxy:!0},{key:"error:response",fn:function(){return[s("span",{domProps:{textContent:t._s(t.$gettext("Host connection failure"))}})]},proxy:!0}])}),t._v(" "),s("ui-form-element",{attrs:{group:"imapsync",validators:{required:!0,response:t.validateSrcUser}},scopedSlots:t._u([{key:"title",fn:function(){return[s("span",{domProps:{textContent:t._s(t.$gettext("User"))}})]},proxy:!0},{key:"content",fn:function(){return[s("input-text",{on:{keyup:function(a){return!a.type.indexOf("key")&&t._k(a.keyCode,"enter",13,a.key,"Enter")?null:t.imapsync.apply(null,arguments)}},model:{value:t.from.username,callback:function(a){t.$set(t.from,"username",a)},expression:"from.username"}})]},proxy:!0},{key:"error:response",fn:function(){return[s("span",{domProps:{textContent:t._s(t.$gettext("User authentication failure"))}})]},proxy:!0}])}),t._v(" "),s("ui-form-element",{attrs:{group:"imapsync",validators:{required:!0,response:t.validateSrcUser},underline:!1},scopedSlots:t._u([{key:"title",fn:function(){return[s("span",{domProps:{textContent:t._s(t.$gettext("Password"))}})]},proxy:!0},{key:"content",fn:function(){return[s("input-password",{on:{keyup:function(a){return!a.type.indexOf("key")&&t._k(a.keyCode,"enter",13,a.key,"Enter")?null:t.imapsync.apply(null,arguments)}},model:{value:t.from.password,callback:function(a){t.$set(t.from,"password",a)},expression:"from.password"}})]},proxy:!0},{key:"error:response",fn:function(){return[s("span",{domProps:{textContent:t._s(t.$gettext("User authentication failure"))}})]},proxy:!0}])})],1),t._v(" "),s("app-page-section",{scopedSlots:t._u([{key:"section:title",fn:function(){return[s("span",{domProps:{textContent:t._s(t.$gettext("Destination"))}})]},proxy:!0}])},[t._v(" "),s("ui-form-element",{attrs:{group:"imapsync",validators:{required:!0},disabled:t.loading},scopedSlots:t._u([{key:"title",fn:function(){return[s("span",{domProps:{textContent:t._s(t.$gettext("User"))}})]},proxy:!0},{key:"content",fn:function(){return[s("input-select",{attrs:{options:t.emailAccounts},scopedSlots:t._u([{key:"additions:right",fn:function(){return[s("ui-button",{attrs:{theme:"light",disabled:""}},[t.loading?s("ui-loader-icon",{attrs:{size:20}}):[t._v(`
                                    @`+t._s(t.$domainUnicode)+`
                                `)]],2)]},proxy:!0}]),model:{value:t.to.account,callback:function(a){t.$set(t.to,"account",a)},expression:"to.account"}})]},proxy:!0}])}),t._v(" "),t.hasSso?s("ui-form-element",{attrs:{underline:!1},scopedSlots:t._u([{key:"title",fn:function(){return[s("span",{domProps:{textContent:t._s(t.$gettext("Authentication"))}})]},proxy:!0},{key:"content",fn:function(){return[s("input-radio-group",{attrs:{options:[{id:"sso",value:!0,label:t.$gettext("Internal sign-in")},{id:"password",value:!1,label:t.$gettext("Password")}]},model:{value:t.to.sso,callback:function(a){t.$set(t.to,"sso",a)},expression:"to.sso"}})]},proxy:!0}],null,!1,2826576943)}):t._e(),t._v(" "),t.to.sso===!1||t.hasSso===!1?s("ui-form-element",{attrs:{underline:!1,group:"imapsync",validators:{validatePassword:t.validatePassword,userdst:t.validateDstUser}},scopedSlots:t._u([{key:"title",fn:function(){return[t.hasSso?s("span"):s("span",{domProps:{textContent:t._s(t.$gettext("Password"))}})]},proxy:!0},{key:"content",fn:function(){return[s("input-password",{attrs:{disabled:t.to.sso===!0&&t.hasSso},on:{keyup:function(a){return!a.type.indexOf("key")&&t._k(a.keyCode,"enter",13,a.key,"Enter")?null:t.imapsync.apply(null,arguments)}},model:{value:t.to.password,callback:function(a){t.$set(t.to,"password",a)},expression:"to.password"}})]},proxy:!0},{key:"error:validatePassword",fn:function(){return[s("span",{domProps:{textContent:t._s(t.$gettext("Required field"))}})]},proxy:!0},{key:"error:userdst",fn:function(){return[s("span",{domProps:{textContent:t._s(t.$gettext("User authentication failure"))}})]},proxy:!0}],null,!1,2903854065)}):t._e()],1)]},proxy:!0},{key:"footer:buttons",fn:function(){return[s("ui-button",{directives:[{name:"margin",rawName:"v-margin:left",value:1,expression:"1",arg:"left"}],attrs:{theme:"primary","validate-group":"imapsync"},on:{click:t.createMigration}},[s("span",{domProps:{textContent:t._s(t.$gettext("Start migration"))}})])]},proxy:!0}])})},p=[],S=i("./js/api/commands/user/email/accounts/index.js"),m=i("./js/endpoints/imapsync/index.ts"),g=i("./js/stores/index.ts");const _=u=>function(){return this.validationError!==u};var A={name:"UserImapsyncImport",api:[{command:S.getAccounts,bind:"getAccounts"}],data:()=>({loading:!1,from:{server:"",username:"",password:""},to:{sso:!1,password:"",account:""},validationError:""}),computed:{emailAccounts(){var u;return this.loading?[]:(((u=this.$api.getAccounts.emails)==null?void 0:u.rows)||[]).map(t=>t.login)},hasSso(){var u;return((u=this.$api.getAccounts.options)==null?void 0:u.HAVE_ONE_CLICK_WEBMAIL_LOGIN)||!1}},watch:{$domain:{handler:"loadAccounts",immediate:!0},to:{handler:"clearValidation",deep:!0},from:{handler:"clearValidation",deep:!0}},methods:{validateSrcHost:_("IMAPSYNC_CONNECTION_FAILURE_HOST_SRC"),validateDstHost:_("IMAPSYNC_CONNECTION_FAILURE_HOST_DST"),validateSrcUser:_("IMAPSYNC_AUTHENTICATION_FAILURE_USER_SRC"),validateDstUser:_("IMAPSYNC_AUTHENTICATION_FAILURE_USER_DST"),validatePassword(u){return this.to.sso?!0:u!==""},forceValidation(u){this.validationError=u,(0,g.oR)(PiniaStores.VALIDATION).revalidateGroup("imapsync")},clearValidation(){this.validationError="",(0,g.oR)(PiniaStores.VALIDATION).revalidateGroup("imapsync")},async loadAccounts(u){this.loading=!0,this.to.account="",await(0,S.getAccounts)({domain:u}),this.$nextTick(()=>{this.to.sso=this.hasSso,this.loading=!1})},async createMigration(){const{error:u}=await m.gi.request({from:{...this.from},to:{...this.to,domain:this.$domain}});u?(u.notify(),this.forceValidation(u.type)):(this.$notifications.success({title:this.$gettext("IMAPSync Manager"),content:this.$gettext("Migration started")}),this.$router.push("/user/imapsync"))}}},I=A,x=i("../node_modules/vue-loader/lib/runtime/componentNormalizer.js"),P=(0,x.Z)(I,e,p,!1,null,null,null),R=P.exports}}]);
