"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[7294],{"./js/api/commands/user/database.js":function(h,_,r){r.d(_,{Cp:function(){return c},Fr:function(){return U},ME:function(){return v},N8:function(){return e},Q6:function(){return u},QZ:function(){return y},Rf:function(){return l},SC:function(){return E},Vt:function(){return s},ZY:function(){return g},ab:function(){return p},cn:function(){return R},l1:function(){return i},nv:function(){return b},oP:function(){return o},oi:function(){return S},p_:function(){return n},q3:function(){return m},rW:function(){return D},th:function(){return P},vc:function(){return A},xf:function(){return N}});var t=r("./js/api/command/index.js"),d=r("../node_modules/ramda/es/index.js");const l=t.Z.get({id:"DB_USERS",url:"/CMD_DB_CREATE",domain:!0,mapResponse:{users:d.zGw(d.CEd(["MAX_DB_LENGTH","MAX_DB_USER_LENGTH"]),d.VO0,d.hXT(({text:a})=>a!=="..."),d.UID(a=>({value:a.value,label:a.text}))),max_db_length:d.vgT("MAX_DB_LENGTH"),max_db_user_length:d.vgT("MAX_DB_USER_LENGTH")}}),p=t.Z.post({url:"/CMD_DB",params:{action:"create"},domain:!0,schema:{name:t.Z.REQUIRED_STRING,user:t.Z.REQUIRED_STRING,passwd:t.Z.OPTIONAL_STRING,passwd2:t.Z.OPTIONAL_STRING,userlist:t.Z.OPTIONAL_STRING},after:a=>a.mapProp("result",a.convert.toAppHtml)}),c=t.Z.get({id:"DATABASES",url:"/CMD_DB",domain:!0,pagination:!0,after:a=>a.mapProps({databases:a.toTable(a.mapArrayProps({nusers:a.convert.toAppNumber,size:a.convert.toAppNumber})),HAVE_ONE_CLICK_PMA_LOGIN:a.convert.toAppBoolean,total_usage:a.convert.toAppNumber,dbs_select:a.toSelect})}),f=t.Z.select({url:"/CMD_DB",domain:!0,params:{json:!0}}),D=f.extend({params:{repair:!0}}),o=f.extend({params:{check:!0}}),u=f.extend({params:{optimize:!0}}),m=f.extend({params:{delete_db:!0}}),n=t.Z.post({url:"/CMD_DB",params:{action:"restore",method:"default"},domain:!0,schema:{name:t.Z.REQUIRED_STRING,dbuser:t.Z.REQUIRED_STRING,dbpass:t.Z.REQUIRED_STRING,file:{type:File,required:!0}},before:({file:a})=>({file1:a,file:null}),fileTransfer:!0,continous:!0}),e=t.Z.get({id:"DB_VIEW",url:"/CMD_DB_VIEW",params:{page:1,ipp:9999},domain:!0,schema:{name:t.Z.REQUIRED_STRING},after:a=>a.flow(a.project({hosts:"access_hosts",users:"db_users",pmaLogin:"HAVE_ONE_CLICK_PMA_LOGIN"}),a.mapProps({users:a.flow(a.deleteProp("info"),a.toArray,a.mapArray(a.getProp("User"))),hosts:a.flow(a.deleteProp("info"),a.toArray,a.mapArray(a.getProp("Access Hosts"))),pmaLogin:a.convert.toAppBoolean}))}),s=t.Z.post({url:"/CMD_DB",method:"POST",params:{action:"deleteuser",delete:!0,json:!0},domain:!0,schema:{name:t.Z.REQUIRED_STRING,select:t.Z.ROWS}}),i=t.Z.post({url:"/CMD_DB_ACCESS",domain:!0,params:{add:!0,json:!0},schema:{name:t.Z.REQUIRED_STRING,host:t.Z.REQUIRED_STRING}}),E=t.Z.select({url:"/CMD_DB_ACCESS",domain:!0,params:{delete:!0,json:!0},schema:{name:t.Z.REQUIRED_STRING}}),R=t.Z.post({url:"/CMD_DB",domain:!0,params:{action:"createuser",json:!0},schema:{name:t.Z.REQUIRED_STRING,passwd:t.Z.REQUIRED_STRING,passwd2:t.Z.REQUIRED_STRING}}),g=t.Z.post({url:"/CMD_DB",domain:!0,params:{action:"createuser",json:!0,passwd:"*****",passwd2:"*****"},schema:{name:t.Z.REQUIRED_STRING,userlist:t.Z.REQUIRED_STRING}}),S=t.Z.post({url:"/CMD_DB",domain:!0,params:{action:"modifyuser",json:!0},schema:{name:t.Z.REQUIRED_STRING,user:t.Z.REQUIRED_STRING,passwd:t.Z.REQUIRED_STRING,passwd2:t.Z.REQUIRED_STRING}}),U=t.Z.get({id:"DB_USER_PRIVS",url:"/CMD_DB_USER_PRIVS",domain:!0,schema:{name:t.Z.REQUIRED_STRING,user:t.Z.REQUIRED_STRING},after:a=>a.mapValues(a.isEqual("Y"))}),v=t.Z.post({url:"/CMD_DB_USER_PRIVS",domain:!0,params:{action:"save "},body:{name:t.Z.REQUIRED_STRING,user:t.Z.REQUIRED_STRING}}),y=t.Z.post({url:"/CMD_PMA_LOGIN",domain:!0,params:{json:!0},notifySuccess:!1,notifyError:!1,schema:{name:t.Z.REQUIRED_STRING}}),A=t.Z.post({url:"/CMD_PMA_LOGIN",params:{json:!0,name:"all",domain:""},notifySuccess:!1,notifyError:!1}),b=t.Z.get({url:"/CMD_DB",response:!1,mapResponse:a=>a.HAVE_ONE_CLICK_PMA_LOGIN==="yes",notifyError:!1}),N=l.extend({mapResponse:a=>Object.values(a).reduce((I,x)=>(x.text&&x.text!=="..."&&I.push(x.text),I),[])}),P=t.Z.get({id:"WORDPRESS_DB_LIST",url:"/CMD_DB",domain:!0,response:[],params:{ipp:999999999},mapResponse:({databases:a})=>(delete a.info,Object.values(a).map(I=>I.database))})},"./js/api/commands/validation/index.js":function(h,_,r){r.d(_,{i9:function(){return i},ty:function(){return e},l7:function(){return m},OE:function(){return s},ub:function(){return S},oH:function(){return D},U5:function(){return o},k_:function(){return f},PR:function(){return n},uo:function(){return g},Jj:function(){return R},rV:function(){return E}});var t=r("./js/api/command/index.js"),d=r("../node_modules/punycode/punycode.es6.js"),l=r("./js/api/commands/converters/index.ts"),p={isValid(v){return typeof v.error=="undefined"},getMessage(v){return(0,l.S8)(v.error||"")}};const c=t.Z.get({url:"/CMD_JSON_VALIDATE",schema:{value:t.Z.REQUIRED_STRING},response:{valid:!0,message:""},mapResponse:{valid:p.isValid,message:p.getMessage}}),f=c.extend({id:"VALIDATE_FORWARDER",params:{type:"forwarder",ignore_system_default:!0}}),D=c.extend({id:"VALIDATE_EMAIL",params:{type:"email",check_mailing_list:!0},schema:{check_exists:{type:Boolean,required:!1,default:!0}}}),o=c.extend({id:"VALIDATE_FTP",params:{type:"ftp"},domain:!0}),u=c.extend({params:{type:"dns"},domain:!0,schema:{record:t.Z.REQUIRED_STRING}}),m=u.extend({id:"VALIDATE_DNS_VALUE",params:{check:"value",name:!0},domain:!0,schema:{value:t.Z.REQUIRED_STRING}}),n=m.extend({id:"VALIDATE_MX_VALUE",params:{record:"MX"},before:({value:v})=>({value:"10",mx_value:v})}),e=u.extend({id:"VALIDATE_DNS_NAME",params:{check:"name",value:!0,mx_value:!0},schema:{name:t.Z.REQUIRED_STRING,value:null}}),s=c.extend({id:"VALIDATE_DATABASE",params:{type:"dbname"}}),i=c.extend({id:"VALIDATE_DATABASE_USER",params:{type:"dbusername"}}),E=c.extend({id:"VALIDATE_USERNAME",params:{type:"username"}}),R=c.extend({id:"VALIDATE_SUBDOMAIN",domain:!0,params:{type:"subdomain"}}),g=c.extend({id:"VALIDATE_PASSWORD",params:{type:"password"}}),S=c.extend({id:"VALIDATE_DOMAIN",params:{type:"domain"},before:({value:v})=>({value:d.ZP.toASCII(v)})}),U=c.extend({id:"VALIDATE_IP_RANGE_LIST",params:{type:"ip_range_list"}})},"./js/api/commands/converters/customItems.ts":function(h,_,r){r.d(_,{CR:function(){return c}});var t=r("../node_modules/ramda/es/index.js"),d=r("./js/api/commands/converters/index.ts"),l=r("./js/api/commands/utils/transduce.ts"),p=r("./js/api/commands/converters/toSelectData.ts");const c=o=>{const u={name:o.name,type:o.type==="listbox"?"select":o.type,label:o.string,description:o.desc||"",value:o.type==="checkbox"?(0,d.sw)(o.checked||"no"):o.value||""};return u.type==="select"?t.BPw(u,(0,p.M1)(o.select||{})):u},f=o=>(0,l.vr)([(0,l.uD)(u=>/^item\d+val$/.test(u)),(0,l.r5)(u=>{const m=u,n=u.replace("val","txt"),e=o[m],s=o[n];return{[e]:s}})],Object.keys(o)),D=(o,u)=>t.qCK(n=>{const e={name:n.name,type:n.type==="listbox"?"select":n.type,description:n.desc||"",value:n.value||"",label:n.string};return n.type==="listbox"?(e.value=n.default,e.options=f(n)):n.type==="checkbox"&&(e.value=n.checked==="yes"),e},t.BPw({name:o}),(0,l.vr)([(0,l.r5)(n=>{const[e,s]=t.Vl2("=",n);return{[e]:s}})]),t.Vl2("&"))(u);_.ZP={fromObject:c,fromString:D}},"./js/api/commands/converters/index.ts":function(h,_,r){r.d(_,{l$:function(){return m.ZP},t0:function(){return t.t0},S8:function(){return t.S8},ql:function(){return t.ql},sw:function(){return t.sw},Qu:function(){return t.Qu},He:function(){return t.He},M1:function(){return u.M1},sf:function(){return e},cc:function(){return o}});var t=r("./js/api/commands/converters/primitive.ts"),d=r("../node_modules/monet/dist/monet.js"),l=r("./js/api/commands/types.ts");const p=s=>typeof s=="object"?d.Either.Right(s):d.Either.Left(new Error("Passed param is not an object")),c=s=>typeof s.usage=="string"?d.Either.Right(s):d.Either.Left(new Error("usage property is required")),f=s=>({usage:(0,t.He)(s.usage),limit:(0,t.Qu)(s.limit)}),D=({usage:s,limit:i})=>{let E=l.H.Normal;const R=Math.floor(s/i*100);return R>=100?E=l.H.OverUsed:R>80&&(E=l.H.AlmostUsed),{usage:s,limit:i,status:E}},o=s=>{const i=d.Either.Right(s).flatMap(p).flatMap(c).map(f).map(D);if(i.isLeft())throw i.left();return i.right()};var u=r("./js/api/commands/converters/toSelectData.ts"),m=r("./js/api/commands/converters/customItems.ts"),n=r("../node_modules/ramda/es/index.js");const e=s=>i=>{const{info:E}=i,R=n.CEd(["info"],i);return{columns:E.columns,rowsCount:Number(E.rows),rows:n.UID(s,n.VO0(R))}}},"./js/api/commands/converters/toSelectData.ts":function(h,_,r){r.d(_,{M1:function(){return D}});var t=r("../node_modules/monet/dist/monet.js"),d=r.n(t),l=r("./js/api/commands/utils/transduce.ts"),p=r("../node_modules/ramda/es/index.js");const c=o=>t.Maybe.Some(o).flatMap(u=>{const m=u.find(n=>n.selected==="yes");return m?t.Maybe.Some(m):t.Maybe.None()}).flatMap(u=>t.Maybe.fromNull(u.value)).orSome(""),f=(0,l.vr)([(0,l.r5)(o=>({[o.value]:o.text}))]),D=o=>{const u=(0,p.VO0)(o);return{value:c(u),options:f(u)}}},"./js/api/commands/types.ts":function(h,_,r){r.d(_,{H:function(){return t}});var t;(function(d){d.Normal="normal",d.AlmostUsed="almost_used",d.OverUsed="overused"})(t||(t={}))},"./js/api/commands/utils/transduce.ts":function(h,_,r){r.d(_,{Re:function(){return p},r5:function(){return d},uD:function(){return l},vr:function(){return u},zh:function(){return D}});var t=r("../node_modules/ramda/es/index.js");const d=m=>n=>(e,s)=>{const i=m(s);return n(e,i)},l=m=>n=>(e,s)=>m(s)?n(e,s):e,p=(m,n)=>(m.push(n),m),c=(m,n)=>t.BPw(m,n),f=(m,n,e,s)=>{const i=t.qCK(...e);return s.reduce(i(n),m)},D=t.WAo(f),o=D([],p),u=D({},c)},"./js/pages/user/database/create.vue":function(h,_,r){r.r(_),r.d(_,{default:function(){return m}});var t=function(){var e=this,s=e._self._c;return s("app-page",{scopedSlots:e._u([{key:"default",fn:function(){return[s("app-page-section",[s("ui-form-element",{attrs:{group:"database",validators:{required:!0,api:e.$commands.validateDatabase,validateLength:e.validateLength},vertical:e.clientStore.isPhone},scopedSlots:e._u([{key:"title",fn:function(){return[e._v(e._s(e.$gettext("Database Name:")))]},proxy:!0},{key:"content",fn:function(){return[s("input-text",{attrs:{prefix:`${e.$_useStore("user").name}_`},model:{value:e.dbName,callback:function(i){e.dbName=i},expression:"dbName"}})]},proxy:!0},{key:"error:validateLength",fn:function(){return[e._v(`
                    `+e._s(e.$gettext("DB Name is too long"))+`
                `)]},proxy:!0}])}),e._v(" "),s("ui-form-element",{attrs:{group:"database",validators:{required:!0,usernameValidation:e.usernameValidation,validateUsernameLength:e.validateUsernameLength},vertical:e.clientStore.isPhone,underline:!!e.dbUser&&!e.existingUser},scopedSlots:e._u([{key:"title",fn:function(){return[e._v(e._s(e.$gettext("Database User:")))]},proxy:!0},{key:"content",fn:function(){return[s("input-autocomplete",{attrs:{values:e.dbUsers,disabled:e.copyDBName},scopedSlots:e._u([{key:"additions:left",fn:function(){return[e._v(`
                            `+e._s(e.$_useStore("user").name)+`_
                        `)]},proxy:!0},{key:"additions:right",fn:function(){return[e.clientStore.isPhone?e._e():s("input-checkbox-button",{model:{value:e.copyDBName,callback:function(i){e.copyDBName=i},expression:"copyDBName"}},[s("span",{domProps:{textContent:e._s(e.$gettext("Same as database name"))}})])]},proxy:!0}]),model:{value:e.dbUser,callback:function(i){e.dbUser=i},expression:"dbUser"}})]},proxy:!0},{key:"error:usernameValidation",fn:function(){return[s("span",{domProps:{innerHTML:e._s(e.$api.dbUserValidation.message)}})]},proxy:!0},{key:"error:validateUsernameLength",fn:function(){return[e._v(`
                    `+e._s(e.$gettext("Username is too long"))+`
                `)]},proxy:!0}])}),e._v(" "),e.clientStore.isPhone?s("ui-form-element",{attrs:{vertical:""},scopedSlots:e._u([{key:"content",fn:function(){return[s("input-checkbox",{model:{value:e.copyDBName,callback:function(i){e.copyDBName=i},expression:"copyDBName"}},[s("span",{domProps:{textContent:e._s(e.$gettext("Same as database name"))}})])]},proxy:!0}],null,!1,2426830917)}):e._e(),e._v(" "),e.dbUser&&!e.existingUser?s("ui-form-element",{attrs:{group:"database",validators:{required:!0,api:e.$commands.validatePassword},vertical:e.clientStore.isPhone,underline:!1},scopedSlots:e._u([{key:"title",fn:function(){return[e._v(`
                    `+e._s(e.$gettext("Database Password:"))+`
                `)]},proxy:!0},{key:"content",fn:function(){return[s("input-password",{attrs:{"show-generator":""},model:{value:e.dbPassword,callback:function(i){e.dbPassword=i},expression:"dbPassword"}})]},proxy:!0}],null,!1,561273686)}):e._e()],1)]},proxy:!0},{key:"footer:buttons",fn:function(){return[s("ui-button",{attrs:{disabled:!e.$valid("database"),theme:"safe"},on:{click:e.createDatabase}},[s("span",{domProps:{textContent:e._s(e.$gettext("Create Database"))}})])]},proxy:!0}])})},d=[],l=r("./js/stores/index.ts"),p=r("./js/api/commands/validation/index.js"),c=r("./js/api/commands/user/database.js"),f={preload:c.Rf,api:[{command:c.Rf,bind:{"response.users":"users","response.max_db_length":"max_db_length","response.max_db_user_length":"max_db_user_length"}},{command:p.i9,bind:"dbUserValidation"}],commands:{validateDatabase:p.OE,validatePassword:p.uo},data(){return{dbName:"",dbUser:"",dbPassword:"",copyDBName:!0}},computed:{dbUsers(){return this.$api.users.map(n=>n.value)},existingUser(){return!!this.dbUsers.find(n=>n===this.dbUser)},maxDBLength(){return Number(this.$api.max_db_length)||1/0},maxUsernameLength(){return Number(this.$api.max_db_user_length)||1/0},...(0,l.Kc)(["client"])},watch:{dbName(n){n&&this.copyDBName&&(this.dbUser=n)}},methods:{async createDatabase(){await(0,c.ab)({name:this.dbName,user:this.dbUser,passwd:this.existingUser?"******":this.dbPassword,passwd2:this.existingUser?"******":this.dbPassword,userlist:this.existingUser?this.dbUser:"..."})&&(this.$_ctx.session.loadUserUsage(),this.$router.push({name:"user/database"}))},async usernameValidation(n){if(!n||this.existingUser)return!0;const{valid:e}=await(0,p.i9)({value:n});return e},validateLength(n){return n?this.maxDBLength>n.length+this.$_useStore("user").name.length+1:!0},validateUsernameLength(n){return n?this.maxUsernameLength>n.length+this.$_useStore("user").name.length+1:!0}}},D=f,o=r("../node_modules/vue-loader/lib/runtime/componentNormalizer.js"),u=(0,o.Z)(D,t,d,!1,null,null,null),m=u.exports}}]);
