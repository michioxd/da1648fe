"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[6399],{"./js/api/commands/get-random-pass.js":function(P,R,c){var t=c("./js/api/command/index.js");R.Z=t.Z.get({url:"/CMD_JSON_VALIDATE",params:{action:"get",type:"password",value:!0},after:l=>l.getProp("success")})},"./js/api/commands/user/database.js":function(P,R,c){c.d(R,{Cp:function(){return d},Fr:function(){return o},ME:function(){return n},N8:function(){return x},Q6:function(){return y},QZ:function(){return i},Rf:function(){return m},SC:function(){return S},Vt:function(){return I},ZY:function(){return w},ab:function(){return _},cn:function(){return v},l1:function(){return D},nv:function(){return e},oP:function(){return E},oi:function(){return r},p_:function(){return b},q3:function(){return N},rW:function(){return g},th:function(){return u},vc:function(){return p},xf:function(){return s}});var t=c("./js/api/command/index.js"),l=c("../node_modules/ramda/es/index.js");const m=t.Z.get({id:"DB_USERS",url:"/CMD_DB_CREATE",domain:!0,mapResponse:{users:l.zGw(l.CEd(["MAX_DB_LENGTH","MAX_DB_USER_LENGTH"]),l.VO0,l.hXT(({text:a})=>a!=="..."),l.UID(a=>({value:a.value,label:a.text}))),max_db_length:l.vgT("MAX_DB_LENGTH"),max_db_user_length:l.vgT("MAX_DB_USER_LENGTH")}}),_=t.Z.post({url:"/CMD_DB",params:{action:"create"},domain:!0,schema:{name:t.Z.REQUIRED_STRING,user:t.Z.REQUIRED_STRING,passwd:t.Z.OPTIONAL_STRING,passwd2:t.Z.OPTIONAL_STRING,userlist:t.Z.OPTIONAL_STRING},after:a=>a.mapProp("result",a.convert.toAppHtml)}),d=t.Z.get({id:"DATABASES",url:"/CMD_DB",domain:!0,pagination:!0,after:a=>a.mapProps({databases:a.toTable(a.mapArrayProps({nusers:a.convert.toAppNumber,size:a.convert.toAppNumber})),HAVE_ONE_CLICK_PMA_LOGIN:a.convert.toAppBoolean,total_usage:a.convert.toAppNumber,dbs_select:a.toSelect})}),f=t.Z.select({url:"/CMD_DB",domain:!0,params:{json:!0}}),g=f.extend({params:{repair:!0}}),E=f.extend({params:{check:!0}}),y=f.extend({params:{optimize:!0}}),N=f.extend({params:{delete_db:!0}}),b=t.Z.post({url:"/CMD_DB",params:{action:"restore",method:"default"},domain:!0,schema:{name:t.Z.REQUIRED_STRING,dbuser:t.Z.REQUIRED_STRING,dbpass:t.Z.REQUIRED_STRING,file:{type:File,required:!0}},before:({file:a})=>({file1:a,file:null}),fileTransfer:!0,continous:!0}),x=t.Z.get({id:"DB_VIEW",url:"/CMD_DB_VIEW",params:{page:1,ipp:9999},domain:!0,schema:{name:t.Z.REQUIRED_STRING},after:a=>a.flow(a.project({hosts:"access_hosts",users:"db_users",pmaLogin:"HAVE_ONE_CLICK_PMA_LOGIN"}),a.mapProps({users:a.flow(a.deleteProp("info"),a.toArray,a.mapArray(a.getProp("User"))),hosts:a.flow(a.deleteProp("info"),a.toArray,a.mapArray(a.getProp("Access Hosts"))),pmaLogin:a.convert.toAppBoolean}))}),I=t.Z.post({url:"/CMD_DB",method:"POST",params:{action:"deleteuser",delete:!0,json:!0},domain:!0,schema:{name:t.Z.REQUIRED_STRING,select:t.Z.ROWS}}),D=t.Z.post({url:"/CMD_DB_ACCESS",domain:!0,params:{add:!0,json:!0},schema:{name:t.Z.REQUIRED_STRING,host:t.Z.REQUIRED_STRING}}),S=t.Z.select({url:"/CMD_DB_ACCESS",domain:!0,params:{delete:!0,json:!0},schema:{name:t.Z.REQUIRED_STRING}}),v=t.Z.post({url:"/CMD_DB",domain:!0,params:{action:"createuser",json:!0},schema:{name:t.Z.REQUIRED_STRING,passwd:t.Z.REQUIRED_STRING,passwd2:t.Z.REQUIRED_STRING}}),w=t.Z.post({url:"/CMD_DB",domain:!0,params:{action:"createuser",json:!0,passwd:"*****",passwd2:"*****"},schema:{name:t.Z.REQUIRED_STRING,userlist:t.Z.REQUIRED_STRING}}),r=t.Z.post({url:"/CMD_DB",domain:!0,params:{action:"modifyuser",json:!0},schema:{name:t.Z.REQUIRED_STRING,user:t.Z.REQUIRED_STRING,passwd:t.Z.REQUIRED_STRING,passwd2:t.Z.REQUIRED_STRING}}),o=t.Z.get({id:"DB_USER_PRIVS",url:"/CMD_DB_USER_PRIVS",domain:!0,schema:{name:t.Z.REQUIRED_STRING,user:t.Z.REQUIRED_STRING},after:a=>a.mapValues(a.isEqual("Y"))}),n=t.Z.post({url:"/CMD_DB_USER_PRIVS",domain:!0,params:{action:"save "},body:{name:t.Z.REQUIRED_STRING,user:t.Z.REQUIRED_STRING}}),i=t.Z.post({url:"/CMD_PMA_LOGIN",domain:!0,params:{json:!0},notifySuccess:!1,notifyError:!1,schema:{name:t.Z.REQUIRED_STRING}}),p=t.Z.post({url:"/CMD_PMA_LOGIN",params:{json:!0,name:"all",domain:""},notifySuccess:!1,notifyError:!1}),e=t.Z.get({url:"/CMD_DB",response:!1,mapResponse:a=>a.HAVE_ONE_CLICK_PMA_LOGIN==="yes",notifyError:!1}),s=m.extend({mapResponse:a=>Object.values(a).reduce((h,A)=>(A.text&&A.text!=="..."&&h.push(A.text),h),[])}),u=t.Z.get({id:"WORDPRESS_DB_LIST",url:"/CMD_DB",domain:!0,response:[],params:{ipp:999999999},mapResponse:({databases:a})=>(delete a.info,Object.values(a).map(h=>h.database))})},"./js/openapi/wordpress.ts":function(P,R,c){c.d(R,{FO:function(){return w},GY:function(){return x},RK:function(){return S},Rf:function(){return E},Sg:function(){return N},c0:function(){return I},cc:function(){return D},il:function(){return v},oi:function(){return y},s8:function(){return b}});var t=c("./js/api/openapi/index.ts"),l=c("../node_modules/runtypes/lib/index.js"),m=c.n(l),_=c("./js/openapi/web.types.ts");const d=(0,t.$d)(),f=t.an.Default(async(r,o)=>{const{data:n}=await d.get(`/api/wordpress/locations/${r}/options`,o);return n.status==="success"&&l.Dictionary(l.String).guard(n.data)===!1?d.failure({type:"INVALID_RESPONSE",response:n.data}):n}),g=t.an.Default(async(r,o,n)=>{const{data:i}=await d.patch(`/api/wordpress/locations/${r}/options`,o,n);return i.status==="success"&&l.Dictionary(l.String).guard(i.data)===!1?d.failure({type:"INVALID_RESPONSE",response:i.data}):i}),E=t.an.Default(async(r,o)=>{const{data:n}=await d.get(`/api/wordpress/locations/${r}/users`,o);return n.status==="success"&&l.Array(_.qD).guard(n.data)===!1?d.failure({type:"INVALID_RESPONSE",response:n.data}):n}),y=t.an.Default(async(r,o,n,i)=>{const{data:p}=await d.post(`/api/wordpress/locations/${r}/users/${o}/change-password`,n,i);return p}),N=t.an.Default(async(r,o,n)=>{const{data:i}=await d.post(`/api/wordpress/locations/${r}/users/${o}/sso-login`,n);return i.status==="success"&&_.Ns.guard(i.data)===!1?d.failure({type:"INVALID_RESPONSE",response:i.data}):i}),b=t.an.Default(async(r,o)=>{const{data:n}=await d.get(`/api/wordpress/locations/${r}/wordpress`,o);return n.status==="success"&&_.qV.guard(n.data)===!1?d.failure({type:"INVALID_RESPONSE",response:n.data}):n}),x=t.an.Default(async(r,o,n)=>{const{data:i}=await d.put(`/api/wordpress/locations/${r}/config/auto-update`,o,n);return i}),I=t.an.Default(async(r,o)=>{const{data:n}=await d.get(`/api/wordpress/locations/${r}/config`,o);return n.status==="success"&&_.FJ.guard(n.data)===!1?d.failure({type:"INVALID_RESPONSE",response:n.data}):n}),D=t.an.Default(async(r,o,n)=>{const{data:i}=await d.put(`/api/wordpress/locations/${r}/config`,o,n);return i.status==="success"&&_.FJ.guard(i.data)===!1?d.failure({type:"INVALID_RESPONSE",response:i.data}):i}),S=t.an.Default(async(r,o)=>{const{data:n}=await d.delete(`/api/wordpress/locations/${r}`,o);return n}),v=t.an.Default(async(r,o)=>{const{data:n}=await d.get("/api/wordpress/locations",Object.assign({},o||{},{params:r}));return n.status==="success"&&l.Array(_.ff).guard(n.data)===!1?d.failure({type:"INVALID_RESPONSE",response:n.data}):n}),w=t.an.Default(async(r,o)=>{const{data:n}=await d.post("/api/wordpress/install",r,o);return n})},"./js/pages/user/wordpress/create.vue":function(P,R,c){c.r(R),c.d(R,{default:function(){return i}});var t=function(){var e=this,s=e._self._c;return s("app-page",{attrs:{actions:[{label:e.$gettext("Back to WordPress Manager"),visible:e.isRefreshedLayout,icon:"#anchor",handler:()=>e.getBack()}]}},[s("app-page-section",{scopedSlots:e._u([{key:"footer:buttons",fn:function(){return[s("ui-button",{attrs:{theme:"primary",disabled:!e.valid},on:{click:e.beforeInstallWordpress}},[s("span",{domProps:{textContent:e._s(e.$gettext("Install"))}})])]},proxy:!0}])},[s("ui-form-element",{scopedSlots:e._u([{key:"title",fn:function(){return[s("span",{domProps:{textContent:e._s(e.$gettext("Directory"))}})]},proxy:!0},{key:"content",fn:function(){return[s("input-text",{attrs:{disabled:""},model:{value:e.directory,callback:function(u){e.directory=u},expression:"directory"}})]},proxy:!0}])}),e._v(" "),s("ui-form-element",{scopedSlots:e._u([{key:"title",fn:function(){return[s("span",{domProps:{textContent:e._s(e.$gettext("Title"))}})]},proxy:!0},{key:"content",fn:function(){return[s("input-text",{model:{value:e.title,callback:function(u){e.title=u},expression:"title"}})]},proxy:!0}])}),e._v(" "),s("ui-form-element",{attrs:{group:"wordpress-admin",validators:{required:!0}},scopedSlots:e._u([{key:"title",fn:function(){return[s("span",{domProps:{textContent:e._s(e.$gettext("Admin Account Name"))}})]},proxy:!0},{key:"content",fn:function(){return[s("input-text",{model:{value:e.admin.name,callback:function(u){e.$set(e.admin,"name",u)},expression:"admin.name"}})]},proxy:!0}])}),e._v(" "),s("ui-form-element",{attrs:{group:"wordpress-admin",validators:{required:!0}},scopedSlots:e._u([{key:"title",fn:function(){return[s("span",{domProps:{textContent:e._s(e.$gettext("Admin Password"))}})]},proxy:!0},{key:"content",fn:function(){return[s("input-password",{attrs:{"show-generator":""},model:{value:e.admin.pass,callback:function(u){e.$set(e.admin,"pass",u)},expression:"admin.pass"}})]},proxy:!0}])}),e._v(" "),s("ui-form-element",{scopedSlots:e._u([{key:"title",fn:function(){return[s("span",{domProps:{textContent:e._s(e.$gettext("Admin Email"))}})]},proxy:!0},{key:"content",fn:function(){return[s("input-text",{model:{value:e.admin.email,callback:function(u){e.$set(e.admin,"email",u)},expression:"admin.email"}})]},proxy:!0}])}),e._v(" "),s("ui-form-element",{scopedSlots:e._u([{key:"title",fn:function(){return[s("span",{domProps:{textContent:e._s(e.$gettext("Database"))}})]},proxy:!0},{key:"content",fn:function(){return[s("div",{directives:[{name:"flex",rawName:"v-flex",value:{dir:"row",cross:"center"},expression:"{ dir: 'row', cross: 'center' }"}]},[s("ui-tooltip",{attrs:{theme:"danger"},scopedSlots:e._u([{key:"trigger",fn:function(){return[s("input-radio",{attrs:{value:"select"},model:{value:e.db.action,callback:function(u){e.$set(e.db,"action",u)},expression:"db.action"}},[s("span",{domProps:{textContent:e._s(e.$gettext("Use existing"))}})])]},proxy:!0}])},[e._v(" "),s("span",{domProps:{textContent:e._s(e.$gettext("Note: selected database will be cleared"))}})]),e._v(" "),s("input-radio",{attrs:{value:"create"},model:{value:e.db.action,callback:function(u){e.$set(e.db,"action",u)},expression:"db.action"}},[s("span",{domProps:{textContent:e._s(e.$gettext("Create new"))}})]),e._v(" "),s("ui-button",{directives:[{name:"show",rawName:"v-show",value:e.db.action==="create"&&!e.limitReached&&!e.createdNew,expression:`
                            db.action === 'create' &&
                            !limitReached &&
                            !createdNew
                        `}],attrs:{theme:"primary"},on:{click:e.createDatabase}},[s("span",{domProps:{textContent:e._s(e.$gettext("Create"))}})]),e._v(" "),s("span",{directives:[{name:"show",rawName:"v-show",value:e.db.action==="create"&&!e.createdNew&&e.databaseLimit!=1/0,expression:`
                            db.action === 'create' &&
                            !createdNew &&
                            databaseLimit != Infinity
                        `}],staticStyle:{"margin-left":"20px"},domProps:{textContent:e._s(e.$gettextInterpolate(e.$gettext("(%{databaseCount} / %{databaseLimit} databases used)"),{databaseCount:e.databaseCount,databaseLimit:e.databaseLimit}))}})],1)]},proxy:!0}])}),e._v(" "),s("ui-form-element",{attrs:{group:"wordpress-db",underline:!1},scopedSlots:e._u([{key:"title",fn:function(){return[s("span",{domProps:{textContent:e._s(e.$gettext("Database Name"))}})]},proxy:!0},{key:"content",fn:function(){return[s(e.db.action==="create"?"input-text":"input-select",{tag:"component",attrs:{disabled:e.db.action==="create",options:e.$api.dbList},model:{value:e.db.name,callback:function(u){e.$set(e.db,"name",u)},expression:"db.name"}})]},proxy:!0}])}),e._v(" "),s("ui-form-element",{scopedSlots:e._u([{key:"title",fn:function(){return[s("span",{domProps:{textContent:e._s(e.$gettext("Database User Name"))}})]},proxy:!0},{key:"content",fn:function(){return[s(e.db.action==="create"?"input-text":"input-select",{tag:"component",attrs:{disabled:e.db.action==="create",options:e.$api.users},model:{value:e.db.user,callback:function(u){e.$set(e.db,"user",u)},expression:"db.user"}})]},proxy:!0}])}),e._v(" "),s("ui-form-element",{scopedSlots:e._u([{key:"title",fn:function(){return[s("span",{domProps:{textContent:e._s(e.$gettext("Database User Password"))}})]},proxy:!0},{key:"content",fn:function(){return[s("input-password",{attrs:{disabled:e.db.action==="create"},model:{value:e.db.pass,callback:function(u){e.$set(e.db,"pass",u)},expression:"db.pass"}})]},proxy:!0}])}),e._v(" "),s("ui-form-element",{scopedSlots:e._u([{key:"title",fn:function(){return[s("span",{domProps:{textContent:e._s(e.$gettext("Table Prefix"))}})]},proxy:!0},{key:"content",fn:function(){return[s("input-text",{model:{value:e.db.prefix,callback:function(u){e.$set(e.db,"prefix",u)},expression:"db.prefix"}})]},proxy:!0}])})],1),e._v(" "),s("ui-dialog-confirm",{attrs:{id:"OVERWRITE_CONFIRMATION_DIALOG"},on:{"click:confirm":e.installWordpress}},[s("span",{domProps:{textContent:e._s(e.$gettext("WordPress installation might overwrite existing files. Do you want to proceed?"))}})])],1)},l=[],m=c("./js/api/commands/user/database.js"),_=c("./js/openapi/wordpress.ts"),d=c("./js/api/commands/get-random-pass.js"),f=c("./js/modules/utils/other.js"),g=c("../node_modules/monet/dist/monet.js");class E{constructor(e,s){this.prefix=e,this.storage=s}getKey(e){return`${this.prefix}${e}`}set(e,s){return this.storage.setItem(this.getKey(e),JSON.stringify(s))}get(e,s){const u=this.getKey(e);return g.Maybe.Some(u).flatMap(a=>g.Maybe.fromNull(this.storage.getItem(a))).flatMap(a=>{try{const h=JSON.parse(a);return g.Maybe.Some(h)}catch(h){return g.Maybe.None()}}).orSome(s)}remove(e){const s=this.getKey(e);this.storage.removeItem(s)}has(e){return this.storage.getItem(this.getKey(e))!==null}}const y={key:f.ZT,getItem:f.ZT,setItem:f.ZT,removeItem:f.ZT,clear:f.ZT},N=new E("da:",window.localStorage||y),b=new E("evo:",window.sessionStorage||y);var x=c("./js/composables/useErrorMessages.ts"),I=c("./js/composables/index.ts");const{$gettext:D}=(0,I.st)(),S=p=>{p.timestamp=Date.now();const e=JSON.stringify(p);return btoa(e).replaceAll(/[^a-zA-Z]/g,"").slice(-7)},v=(0,x.L)({WORDPRESS_DATABASE_ERROR:D("Invalid database credentials"),WORDPRESS_ALREADY_INSTALLED:D("Wordpress is already installed")});var w={name:"WordpressCreate",beforeRouteEnter:(p,e,s)=>s(Boolean(p.query.dir)||"/user/wordpress"),api:[{command:m.xf,bind:"users"},{command:m.th,bind:"dbList"}],data(){const p=b.get(`wordpress-db-${this.$route.query.dir}`,{action:"select",name:"",pass:"",prefix:"wp_",user:""});return{admin:{name:"",pass:"",email:""},db:{...p},title:"",dbDataLoaded:!1,createdNew:b.has(`wordpress-db-${this.$route.query.dir}`)}},computed:{dir(){return this.$route.query.dir},databaseCount(){return this.$_session.usage.mySqlDatabases.usage},databaseLimit(){return this.$_session.usage.mySqlDatabases.limit},limitReached(){return this.databaseLimit<=this.databaseCount},directory(){return decodeURIComponent(this.dir)},requestData(){return{adminEmail:this.admin.email,adminName:this.admin.name,adminPass:this.admin.pass,dbName:this.db.name,dbPass:this.db.pass,dbPrefix:this.db.prefix,dbUser:this.db.user,filePath:decodeURIComponent(this.dir),title:this.title}},validInfo(){return Boolean(this.$valid("wordpress-info"))},validAdmin(){return Boolean(this.admin.email&&this.admin.pass&&this.admin.name&&this.$valid("wordpress-admin"))},validDatabase(){return Boolean(this.db.name&&this.db.pass&&this.db.prefix&&this.db.user&&this.$valid("wordpress-db"))},valid(){return this.validInfo&&this.validAdmin&&this.validDatabase},isRefreshedLayout(){return(0,I.oR)(PiniaStores.OPTIONS)["skin/layout"]==="standard2021"}},watch:{"db.action":{async handler(p){if(this.dbDataLoaded){p==="create"&&!this.createdNew&&(this.db.name="",this.db.pass="",this.db.user="");return}p==="select"&&(await Promise.all([(0,m.xf)(),(0,m.th)()]),this.dbDataLoaded=!0)},immediate:!0}},created(){this.admin.name=this.$_session.effectiveUsername,this.admin.email=this.$_session.email},methods:{async createDatabase(){const e=`wp${S(this.$data)}`,s=await(0,d.Z)();return await(0,m.ab)({name:e,user:e,passwd:s,passwd2:s,userlist:"..."})instanceof Error?!1:(this.createdNew=!0,await Promise.all([(0,m.xf)(),(0,m.th)()]),this.db.name=`${this.$_useStore("user").name}_${e}`,this.db.pass=s,this.db.user=this.db.name,this.db.prefix="wp_",b.set(`wordpress-db-${this.dir}`,this.db),!0)},beforeInstallWordpress(){this.$dialog("OVERWRITE_CONFIRMATION_DIALOG").open()},async installWordpress(){const{error:p}=await(0,_.FO)(this.requestData);if(p){v(p);return}b.has(`wordpress-db-${this.dir}`)&&b.remove(`wordpress-db-${this.dir}`),this.$router.push("/user/wordpress"),this.$notifications.success({title:D("Wordpress Manager"),content:D("Installation successful")})},async getBack(){this.$router.push({name:"user/wordpress"})}}},r=w,o=c("../node_modules/vue-loader/lib/runtime/componentNormalizer.js"),n=(0,o.Z)(r,t,l,!1,null,null,null),i=n.exports}}]);
