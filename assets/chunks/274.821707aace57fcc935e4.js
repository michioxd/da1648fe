"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[274],{"./js/api/commands/fm.js":function(g,f,r){r.d(f,{Dp:function(){return h},rx:function(){return u},yC:function(){return i}});var n=r("./js/api/command/index.js"),l=r("../node_modules/ramda/es/index.js");const p="/CMD_FILE_MANAGER",d=a=>{const t=o=>l.zGw(l.Zpf,l.UID(e=>({path:e[0],size:Number(e[1]),type:o})));return l.mNm(l.vgT("path"),[...t("file")(a.files),...t("directory")(a.files)])},c={type:String,required:!1,default:"/"},h=n.Z.get({url:p,id:"FOLDER_TREE",params:{action:"parent_tree"},schema:{path:c},after:a=>a.flow(t=>typeof t=="string"?JSON.parse(t.replace(`[
,`,`[
`)):t,a.mapArray(a.mapProps({path:t=>t.replace(/\/\//g,"/").replace(/\/$/g,""),dirs:a.convert.toAppNumber,files:a.convert.toAppNumber,files_size:a.convert.toAppNumber})))}),v=n.Z.get({url:p,id:"FOLDER_DIRS",params:{action:"json_dirs",ipp:1e5},schema:{path:c},after:a=>a.flow(t=>{if(t.error)throw new Error(a.convert.toAppHtml(t.error));return t},a.transformObject(t=>({[t.truepath]:{path:t.truepath,dirs:Number(t.sub_directories||0),files:Number(t.files||0)}})))}),u=n.Z.get({url:p,id:"FILE_EXISTS",response:!1,params:{action:"exists"},schema:{path:n.Z.REQUIRED_STRING},after:a=>a.flow(a.getProp("exists"),a.isEqual("1"))}),i=n.Z.get({id:"FM_SEARCH",url:"/CMD_FILE_MANAGER",params:{action:"recursive_search"},schema:{path:n.Z.REQUIRED_STRING,search:n.Z.REQUIRED_STRING,type:n.Z.OPTIONAL_STRING},response:[],mapResponse:d})},"./js/api/commands/user/ftp.js":function(g,f,r){r.d(f,{$j:function(){return i},D0:function(){return l},Gw:function(){return a},T8:function(){return p},Ti:function(){return v},UH:function(){return u},VP:function(){return t},o1:function(){return d},sG:function(){return c}});var n=r("./js/api/command/index.js");const l=n.Z.get({id:"FTP_ACCOUNT",url:"/CMD_FTP_SHOW",domain:!0,schema:{user:n.Z.REQUIRED_STRING}}),p=n.Z.get({id:"FTP_ACCOUNTS",url:"/CMD_FTP",response:[],params:{full_json:!0},domain:!0,after:e=>e.flow(e.project({accounts:"users",anonLogin:"ANONLOGIN"}),e.mapProp("accounts",e.flow(e.mapValues((s,m)=>({login:m,...s})),e.toArray,e.mapArrayProps({suspended:e.convert.toAppBoolean}))))}),d=n.Z.post({url:"/CMD_FTP",params:{action:"create"},domain:!0,schema:{user:n.Z.REQUIRED_STRING,passwd:n.Z.REQUIRED_STRING,passwd2:n.Z.REQUIRED_STRING,type:n.Z.REQUIRED_STRING,custom_val:n.Z.OPTIONAL_STRING},notifySuccess:!1}),c=d.extend({params:{action:"modify"},schema:{passwd:n.Z.OPTIONAL_STRING,passwd2:n.Z.OPTIONAL_STRING}}),h=n.Z.select({url:"/CMD_FTP",domain:!0,params:{action:"delete"},notifySuccess:!1,notifyError:!1}),v=h.extend({params:{suspend:!0}}),u=h.extend({params:{unsuspend:!0}}),i=h.extend({params:{delete:!0}}),a=n.Z.get({id:"FTP_SETTINGS",url:"/CMD_FTP_SETTINGS",domain:!0,after:e=>s=>({access:e.convert.toAppBoolean(s.Anonymous),upload:e.convert.toAppBoolean(s.AnonymousUpload),message:e.flow(e.convert.toAppString,e.convert.toAppText)(s.message)})}),t=n.Z.post({url:"/CMD_FTP_SETTINGS",params:{action:"modify"},domain:!0,schema:{anon:n.Z.REQUIRED_BOOL,anonup:n.Z.REQUIRED_BOOL,message:n.Z.REQUIRED_STRING}}),o=n.Z.post({url:"/CMD_CHANGE_FTP_PASSWORD",schema:{ftp:n.Z.REQUIRED_STRING,password1:n.Z.REQUIRED_STRING,password2:n.Z.REQUIRED_STRING}})},"./js/api/commands/validation/index.js":function(g,f,r){r.d(f,{i9:function(){return s},ty:function(){return o},l7:function(){return a},OE:function(){return e},ub:function(){return D},oH:function(){return v},U5:function(){return u},k_:function(){return h},PR:function(){return t},uo:function(){return _},Jj:function(){return y},rV:function(){return m}});var n=r("./js/api/command/index.js"),l=r("../node_modules/punycode/punycode.es6.js"),p=r("./js/api/commands/converters/index.ts"),d={isValid(E){return typeof E.error=="undefined"},getMessage(E){return(0,p.S8)(E.error||"")}};const c=n.Z.get({url:"/CMD_JSON_VALIDATE",schema:{value:n.Z.REQUIRED_STRING},response:{valid:!0,message:""},mapResponse:{valid:d.isValid,message:d.getMessage}}),h=c.extend({id:"VALIDATE_FORWARDER",params:{type:"forwarder",ignore_system_default:!0}}),v=c.extend({id:"VALIDATE_EMAIL",params:{type:"email",check_mailing_list:!0},schema:{check_exists:{type:Boolean,required:!1,default:!0}}}),u=c.extend({id:"VALIDATE_FTP",params:{type:"ftp"},domain:!0}),i=c.extend({params:{type:"dns"},domain:!0,schema:{record:n.Z.REQUIRED_STRING}}),a=i.extend({id:"VALIDATE_DNS_VALUE",params:{check:"value",name:!0},domain:!0,schema:{value:n.Z.REQUIRED_STRING}}),t=a.extend({id:"VALIDATE_MX_VALUE",params:{record:"MX"},before:({value:E})=>({value:"10",mx_value:E})}),o=i.extend({id:"VALIDATE_DNS_NAME",params:{check:"name",value:!0,mx_value:!0},schema:{name:n.Z.REQUIRED_STRING,value:null}}),e=c.extend({id:"VALIDATE_DATABASE",params:{type:"dbname"}}),s=c.extend({id:"VALIDATE_DATABASE_USER",params:{type:"dbusername"}}),m=c.extend({id:"VALIDATE_USERNAME",params:{type:"username"}}),y=c.extend({id:"VALIDATE_SUBDOMAIN",domain:!0,params:{type:"subdomain"}}),_=c.extend({id:"VALIDATE_PASSWORD",params:{type:"password"}}),D=c.extend({id:"VALIDATE_DOMAIN",params:{type:"domain"},before:({value:E})=>({value:l.ZP.toASCII(E)})}),A=c.extend({id:"VALIDATE_IP_RANGE_LIST",params:{type:"ip_range_list"}})},"./js/api/commands/converters/customItems.ts":function(g,f,r){r.d(f,{CR:function(){return c}});var n=r("../node_modules/ramda/es/index.js"),l=r("./js/api/commands/converters/index.ts"),p=r("./js/api/commands/utils/transduce.ts"),d=r("./js/api/commands/converters/toSelectData.ts");const c=u=>{const i={name:u.name,type:u.type==="listbox"?"select":u.type,label:u.string,description:u.desc||"",value:u.type==="checkbox"?(0,l.sw)(u.checked||"no"):u.value||""};return i.type==="select"?n.BPw(i,(0,d.M1)(u.select||{})):i},h=u=>(0,p.vr)([(0,p.uD)(i=>/^item\d+val$/.test(i)),(0,p.r5)(i=>{const a=i,t=i.replace("val","txt"),o=u[a],e=u[t];return{[o]:e}})],Object.keys(u)),v=(u,i)=>n.qCK(t=>{const o={name:t.name,type:t.type==="listbox"?"select":t.type,description:t.desc||"",value:t.value||"",label:t.string};return t.type==="listbox"?(o.value=t.default,o.options=h(t)):t.type==="checkbox"&&(o.value=t.checked==="yes"),o},n.BPw({name:u}),(0,p.vr)([(0,p.r5)(t=>{const[o,e]=n.Vl2("=",t);return{[o]:e}})]),n.Vl2("&"))(i);f.ZP={fromObject:c,fromString:v}},"./js/api/commands/converters/index.ts":function(g,f,r){r.d(f,{l$:function(){return a.ZP},t0:function(){return n.t0},S8:function(){return n.S8},ql:function(){return n.ql},sw:function(){return n.sw},Qu:function(){return n.Qu},He:function(){return n.He},M1:function(){return i.M1},sf:function(){return o},cc:function(){return u}});var n=r("./js/api/commands/converters/primitive.ts"),l=r("../node_modules/monet/dist/monet.js"),p=r("./js/api/commands/types.ts");const d=e=>typeof e=="object"?l.Either.Right(e):l.Either.Left(new Error("Passed param is not an object")),c=e=>typeof e.usage=="string"?l.Either.Right(e):l.Either.Left(new Error("usage property is required")),h=e=>({usage:(0,n.He)(e.usage),limit:(0,n.Qu)(e.limit)}),v=({usage:e,limit:s})=>{let m=p.H.Normal;const y=Math.floor(e/s*100);return y>=100?m=p.H.OverUsed:y>80&&(m=p.H.AlmostUsed),{usage:e,limit:s,status:m}},u=e=>{const s=l.Either.Right(e).flatMap(d).flatMap(c).map(h).map(v);if(s.isLeft())throw s.left();return s.right()};var i=r("./js/api/commands/converters/toSelectData.ts"),a=r("./js/api/commands/converters/customItems.ts"),t=r("../node_modules/ramda/es/index.js");const o=e=>s=>{const{info:m}=s,y=t.CEd(["info"],s);return{columns:m.columns,rowsCount:Number(m.rows),rows:t.UID(e,t.VO0(y))}}},"./js/api/commands/converters/toSelectData.ts":function(g,f,r){r.d(f,{M1:function(){return v}});var n=r("../node_modules/monet/dist/monet.js"),l=r.n(n),p=r("./js/api/commands/utils/transduce.ts"),d=r("../node_modules/ramda/es/index.js");const c=u=>n.Maybe.Some(u).flatMap(i=>{const a=i.find(t=>t.selected==="yes");return a?n.Maybe.Some(a):n.Maybe.None()}).flatMap(i=>n.Maybe.fromNull(i.value)).orSome(""),h=(0,p.vr)([(0,p.r5)(u=>({[u.value]:u.text}))]),v=u=>{const i=(0,d.VO0)(u);return{value:c(i),options:h(i)}}},"./js/api/commands/types.ts":function(g,f,r){r.d(f,{H:function(){return n}});var n;(function(l){l.Normal="normal",l.AlmostUsed="almost_used",l.OverUsed="overused"})(n||(n={}))},"./js/api/commands/utils/transduce.ts":function(g,f,r){r.d(f,{Re:function(){return d},r5:function(){return l},uD:function(){return p},vr:function(){return i},zh:function(){return v}});var n=r("../node_modules/ramda/es/index.js");const l=a=>t=>(o,e)=>{const s=a(e);return t(o,s)},p=a=>t=>(o,e)=>a(e)?t(o,e):o,d=(a,t)=>(a.push(t),a),c=(a,t)=>n.BPw(a,t),h=(a,t,o,e)=>{const s=n.qCK(...o);return e.reduce(s(t),a)},v=n.WAo(h),u=v([],d),i=v({},c)},"./js/pages/user/ftp-accounts/_components/path-suggest.vue":function(g,f,r){r.d(f,{Z:function(){return a}});var n=function(){var o=this,e=o._self._c;return e("ui-input-group",{scopedSlots:o._u([{key:"additions:left",fn:function(){return[e("ui-button",{attrs:{disabled:"disabled"}},[o._v(`
            `+o._s(o.$_session.homeDir)+`
        `)])]},proxy:!0},{key:"input",fn:function(){return[e("input-autocomplete",{attrs:{value:o.path,values:o.folders,"suggest-after":0,focused:o.selected,"force-all-values":"","focus-on-mouse-over":!1},on:{input:o.onInput,"update:focused":function(s){o.selected=s}},nativeOn:{keydown:[function(s){return!s.type.indexOf("key")&&o._k(s.keyCode,"tab",9,s.key,"Tab")?null:(s.stopPropagation(),s.preventDefault(),o.autocomplete.apply(null,arguments))},function(s){return!s.type.indexOf("key")&&o._k(s.keyCode,"right",39,s.key,["Right","ArrowRight"])||"button"in s&&s.button!==2?null:(s.stopPropagation(),s.preventDefault(),o.autocomplete.apply(null,arguments))},function(s){return!s.type.indexOf("key")&&o._k(s.keyCode,"backspace",void 0,s.key,void 0)||!s.ctrlKey?null:(s.preventDefault(),o.smartBackspace.apply(null,arguments))}]}})]},proxy:!0}])})},l=[],p=r("./js/api/commands/fm.js"),d=r("../node_modules/ramda/es/index.js");const c=p.Dp.extend({notifyError:!1,params:{filemanager_du:0,action:"parent_tree"}});var h={name:"PathSuggest",model:{prop:"value",event:"update:value"},props:{value:{type:String,required:!0}},data(){return{path:this.value,selected:null,loaded:[],loading:!1,state:[]}},computed:{folders(){const t=this.getParent(this.path),o=d.hXT(d.sv4([e=>this.getParent(e)===t,e=>e.startsWith(this.path),e=>e!==this.path]));return d.zGw(o,d.HCG([d.zU3(d.kE),d.zU3(e=>e)]))(this.state)}},watch:{value(t){t!==this.path&&this.setModel(t)}},methods:{getParent(t){return`/${t.slice(1).split("/").slice(0,-1).join("/")}`},async treeRequest(t){const o=await c({path:t});return o instanceof Error?[]:o.map(d.vgT("path"))},async loadDir(t){if(this.loaded.includes(t))return;this.loaded.push(t),this.loading=!0;const o=await this.treeRequest(t);this.state=d.hXT(Boolean,d.jj$(d.zoF(this.state,o))),this.loading=!1},onInput(t){if(t===""){this.setModel(t);return}t[0]!=="/"&&(t=`/${t}`),this.$refs.dropdown,this.setModel(t)},setModel(t){if(this.folders.includes(t))this.loadDir(t);else{const o=this.getParent(t);this.loadDir(o)}this.path=t,this.$emit("update:value",t)},autocomplete(){const t=this.folders;if(t.length===0)return;if(this.selected!==null){this.setModel(this.folders[this.selected]);return}if(t.length===1){this.setModel(t[0]);return}let o=this.path;t.shift().replace(o,"").split("").forEach(s=>{const m=o+s;t.every(y=>y.startsWith(m))&&(o=m)}),this.setModel(o)},smartBackspace(){const t=this.getParent(this.path);this.setModel(t)}}},v=h,u=r("../node_modules/vue-loader/lib/runtime/componentNormalizer.js"),i=(0,u.Z)(v,n,l,!1,null,null,null),a=i.exports},"./js/pages/user/ftp-accounts/edit.vue":function(g,f,r){r.r(f),r.d(f,{default:function(){return o}});var n=function(){var s=this,m=s._self._c;return m("app-page",{scopedSlots:s._u([{key:"footer:buttons",fn:function(){return[m("ui-button",{attrs:{theme:"safe","validate-group":"editFtpAccount"},on:{click:s.modifyFtpAccount}},[m("span",{domProps:{textContent:s._s(s.$gettext("Modify"))}})])]},proxy:!0},{key:"default",fn:function(){return[m("app-page-section",[m("ui-form-element",{attrs:{vertical:s.clientStore.isPhone},scopedSlots:s._u([{key:"title",fn:function(){return[m("span",{domProps:{textContent:s._s(s.$gettext("FTP Username:"))}})]},proxy:!0},{key:"content",fn:function(){return[m("input-text",{attrs:{value:s.$api.account.fulluser,disabled:""}})]},proxy:!0}])}),s._v(" "),m("ui-form-element",{attrs:{group:"editFtpAccount",validators:{api:s.$commands.validatePassword},vertical:s.clientStore.isPhone},scopedSlots:s._u([{key:"title",fn:function(){return[m("span",{domProps:{textContent:s._s(s.$gettext("Enter Password"))}})]},proxy:!0},{key:"content",fn:function(){return[m("input-password",{directives:[{name:"flex-item",rawName:"v-flex-item",value:{grow:!0},expression:"{ grow: true }"}],ref:"password",attrs:{"show-generator":""},model:{value:s.password,callback:function(y){s.password=y},expression:"password"}})]},proxy:!0}])}),s._v(" "),m("ui-tabs",{attrs:{radio:"",tabs:s.ftpOptions,selected:s.type},on:{"update:selected":function(y){s.type=y}},scopedSlots:s._u([{key:"tab:custom",fn:function(){return[m("ui-form-element",{attrs:{underline:!s.clientStore.isPhone},scopedSlots:s._u([s.clientStore.isPhone?null:{key:"title",fn:function(){return[m("span",{domProps:{textContent:s._s(s.$gettext("Directory"))}})]},proxy:!0},{key:"content",fn:function(){return[m("path-suggest",{model:{value:s.customDir,callback:function(y){s.customDir=y},expression:"customDir"}})]},proxy:!0}],null,!0)})]},proxy:!0}])})],1)]},proxy:!0}])})},l=[],p=r("./js/stores/index.ts"),d=r("./js/api/commands/validation/index.js"),c=r("./js/api/commands/user/ftp.js"),h=r("./js/pages/user/ftp-accounts/_components/path-suggest.vue"),v=r("./js/composables/index.ts"),u={components:{PathSuggest:h.Z},preload:c.D0,api:[{command:c.D0,bind:"account"}],commands:{validatePassword:d.uo},props:{user:{type:String,required:!0}},data(){return{password:"",type:"domain",customDir:""}},computed:{ftpOptions(){return[{id:"domain",label:this.$gettext("Domain"),desc:this.$gettext("FTP account with the root directory in the domains home directory (one up from the public_html)")},{id:"ftp",label:this.$gettext("FTP"),desc:this.$gettext("FTP account with the root directory in the domains public_ftp directory")},{id:"user",label:this.$gettext("User"),desc:this.$gettext("FTP account with the root directory as the users name in the public_html directory")},{id:"custom",label:this.$gettext("Custom"),desc:this.$gettext("Please provide custom directory in the field below")}]},customDirPrefix(){return this.$_session.homeDir},...(0,p.Kc)(["client"])},created(){this.type=this.$api.account.type,this.customDir=this.$api.account.path.replace(this.customDirPrefix,"")},methods:{async modifyFtpAccount(){const e=await(0,c.sG)({user:this.user,passwd:this.password,passwd2:this.password,type:this.type,custom_val:`${this.customDirPrefix}${this.customDir}`});e&&e.error==="0"&&((0,v.d$)().success({title:this.$gettext("FTP Accounts"),content:this.$gettext("Account modified")}),this.$router.push({name:"user/ftp-accounts"}))},copyPassword(){const e=document.createElement("textarea");e.style.position="fixed",e.style.bottom=0,e.style.right=0,e.style.width="2em",e.style.height="2em",e.style.padding=0,e.style.border="none",e.style.outline="none",e.style.boxShadow="none",e.style.background="transparent",e.value=this.password,document.body.appendChild(e),e.focus(),e.select(),document.execCommand("copy")&&this.$nextTick(()=>{this.$notifications.success({title:"Password copied!"}),document.body.removeChild(e)})}}},i=u,a=r("../node_modules/vue-loader/lib/runtime/componentNormalizer.js"),t=(0,a.Z)(i,n,l,!1,null,null,null),o=t.exports}}]);
