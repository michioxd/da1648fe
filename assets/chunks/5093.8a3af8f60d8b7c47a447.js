"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[5093],{"./js/api/commands/user/ftp.js":function(A,r,c){c.d(r,{$j:function(){return f},D0:function(){return i},Gw:function(){return g},T8:function(){return l},Ti:function(){return p},UH:function(){return m},VP:function(){return n},o1:function(){return a},sG:function(){return d}});var s=c("./js/api/command/index.js");const i=s.Z.get({id:"FTP_ACCOUNT",url:"/CMD_FTP_SHOW",domain:!0,schema:{user:s.Z.REQUIRED_STRING}}),l=s.Z.get({id:"FTP_ACCOUNTS",url:"/CMD_FTP",response:[],params:{full_json:!0},domain:!0,after:e=>e.flow(e.project({accounts:"users",anonLogin:"ANONLOGIN"}),e.mapProp("accounts",e.flow(e.mapValues((o,h)=>({login:h,...o})),e.toArray,e.mapArrayProps({suspended:e.convert.toAppBoolean}))))}),a=s.Z.post({url:"/CMD_FTP",params:{action:"create"},domain:!0,schema:{user:s.Z.REQUIRED_STRING,passwd:s.Z.REQUIRED_STRING,passwd2:s.Z.REQUIRED_STRING,type:s.Z.REQUIRED_STRING,custom_val:s.Z.OPTIONAL_STRING},notifySuccess:!1}),d=a.extend({params:{action:"modify"},schema:{passwd:s.Z.OPTIONAL_STRING,passwd2:s.Z.OPTIONAL_STRING}}),u=s.Z.select({url:"/CMD_FTP",domain:!0,params:{action:"delete"},notifySuccess:!1,notifyError:!1}),p=u.extend({params:{suspend:!0}}),m=u.extend({params:{unsuspend:!0}}),f=u.extend({params:{delete:!0}}),g=s.Z.get({id:"FTP_SETTINGS",url:"/CMD_FTP_SETTINGS",domain:!0,after:e=>o=>({access:e.convert.toAppBoolean(o.Anonymous),upload:e.convert.toAppBoolean(o.AnonymousUpload),message:e.flow(e.convert.toAppString,e.convert.toAppText)(o.message)})}),n=s.Z.post({url:"/CMD_FTP_SETTINGS",params:{action:"modify"},domain:!0,schema:{anon:s.Z.REQUIRED_BOOL,anonup:s.Z.REQUIRED_BOOL,message:s.Z.REQUIRED_STRING}}),t=s.Z.post({url:"/CMD_CHANGE_FTP_PASSWORD",schema:{ftp:s.Z.REQUIRED_STRING,password1:s.Z.REQUIRED_STRING,password2:s.Z.REQUIRED_STRING}})},"./js/pages/user/ftp-accounts/index.vue":function(A,r,c){c.r(r),c.d(r,{default:function(){return g}});var s=function(){var t=this,e=t._self._c;return e("app-page",{attrs:{actions:t.rows.length<t.limit||t.aFTP?[{name:"user/ftp-accounts/create",label:t.$gettext("Create FTP Account"),visible:t.rows.length<t.limit,icon:"#plus-fill"},{name:"user/ftp-settings",label:t.$gettext("Anonymous FTP Settings"),visible:t.aFTP,icon:"#settings"}]:[]},scopedSlots:t._u([{key:"details",fn:function(){return[e("ui-infobar-item",{attrs:{title:t.$gettext("Details")}},[e("ui-infobar-stats",{attrs:{usage:t.rows.length,limit:t.limit,title:t.$gettext("FTP Accounts")}})],1)]},proxy:!0},{key:"page:title",fn:function(){return[t._v(`
        `+t._s(t.$gettextInterpolate(t.$gettext("FTP Accounts for %{ domain }"),{domain:t.$domainUnicode}))+`
    `)]},proxy:!0},{key:"default",fn:function(){return[t.clientStore.isPhone?e("app-page-section",[e("ui-stats-summary",{attrs:{badges:[{label:t.$gettext("FTP accounts"),value:t.rows.length}]}})],1):t._e(),t._v(" "),e("app-page-section",[e("ui-r-table",t._b({attrs:{"checked-rows":t.checkedRows},on:{"update:checkedRows":function(o){t.checkedRows=o}},scopedSlots:t._u([{key:"buttons:before",fn:function(){return[t.$_layout!=="standard2021"?e("ui-stats-summary",{attrs:{badges:[{label:t.$gettext("FTP accounts"),value:t.rows.length}]}}):t._e()]},proxy:!0},{key:"table:actions",fn:function(){return[e("ui-table-action",{attrs:{disabled:!t.suspendActionAvailable},on:{click:t.suspendAccounts}},[e("span",{domProps:{textContent:t._s(t.$gettext("Suspend"))}})]),t._v(" "),e("ui-table-action",{attrs:{disabled:!t.unsuspendActionAvailable},on:{click:t.unsuspendAccounts}},[e("span",{domProps:{textContent:t._s(t.$gettext("Unsuspend"))}})]),t._v(" "),e("ui-table-action",{on:{click:function(o){t.$dialog("DELETE_ITEMS_DIALOG").open()}}},[e("span",{domProps:{textContent:t._s(t.$gettext("Delete"))}})])]},proxy:!0},{key:"col:user",fn:function({user:o,login:h,route:_,suspended:T}){return[e("ui-link",{attrs:{name:_,params:{user:o}}},[e("ui-icon",{directives:[{name:"margin",rawName:"v-margin:right",value:"4px",expression:"'4px'",arg:"right"}],attrs:{id:"pencil",size:"small"}}),t._v(`
                        `+t._s(h)+`
                    `)],1),t._v(" "),T?e("ui-tooltip",{attrs:{theme:"danger",icon:"warning"}},[e("span",{domProps:{textContent:t._s(t.$gettext("Suspended"))}})]):t._e()]}}])},"ui-r-table",{rows:t.rows,columns:[{id:"user",label:t.$gettext("Account"),editable:!1},{id:"path",label:t.$gettext("Server Path"),grow:!0}],isSortable:!0,notCheckable:[t.currentUser],disablePagination:!0,rowsCount:t.rows.length,verticalLayout:t.clientStore.isPhone},!1))],1),t._v(" "),e("ui-dialog-delete-items",{attrs:{subject:t.$ngettext("account","accounts",t.checkedRows.length)},on:{"click:confirm":t.deleteAccounts}})]},proxy:!0}])})},i=[],l=c("./js/stores/index.ts"),a=c("./js/api/commands/user/ftp.js"),d=c("./js/composables/index.ts"),u={name:"FtpAccounts",preload:a.T8,api:[{command:a.T8,bind:"ftp"}],data:()=>({checkedRows:[],currentUsername:""}),computed:{aFTP(){return this.$_flags.user.aftp},accounts(){return this.$api.ftp.accounts},limit(){return this.$_session.usage.ftpAccounts.limit},anonLogin(){return this.$api.ftp.anonLogin},rows(){const n=this.$_useStore("user").name;return this.accounts.map(t=>({...t,route:n===t.user?"user/password":"user/ftp-accounts/edit"}))},currentUser(){return this.rows.find(n=>this.$_useStore("user").name===n.user)},checkedAccounts(){return this.checkedRows.map(n=>n.user)},suspendActionAvailable(){return!!this.checkedRows.find(n=>!n.suspended)},unsuspendActionAvailable(){return!!this.checkedRows.find(n=>n.suspended)},...(0,l.Kc)(["client"])},watch:{$domain(){this.loadAccounts()}},methods:{async doAction(n,t){const e=await n({select:this.checkedAccounts});e&&e.error==="0"&&((0,d.d$)().success({title:this.$gettext("FTP Accounts"),content:t}),this.checkedRows=[],this.loadAccounts())},suspendAccounts(){this.doAction(a.Ti,this.$ngettext("Account was successfully suspended","Accounts was successfully suspended",this.checkedAccounts.length))},async unsuspendAccounts(){this.doAction(a.UH,this.$ngettext("Account was successfully unsuspended","Accounts was successfully unsuspended",this.checkedAccounts.length))},async deleteAccounts(){this.doAction(a.$j,this.$ngettext("Account was successfully deleted","Accounts was successfully deleted",this.checkedAccounts.length))},loadAccounts(){(0,a.T8)()}}},p=u,m=c("../node_modules/vue-loader/lib/runtime/componentNormalizer.js"),f=(0,m.Z)(p,s,i,!1,null,null,null),g=f.exports}}]);
