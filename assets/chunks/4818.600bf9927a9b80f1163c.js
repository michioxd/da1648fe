"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[4818],{"./js/api/commands/admin/users/actions.js":function(L,g,i){i.d(g,{Ss:function(){return m},Vt:function(){return p},XB:function(){return E},f1:function(){return c},uV:function(){return R},vk:function(){return O}});var s=i("./js/api/command/index.js");const d=s.Z.post({url:"/CMD_SELECT_USERS",notifySuccess:!0,notifyError:!0,params:{location:"CMD_ALL_USER_SHOW"},schema:{select:s.Z.ROWS},blocking:!0}),c=d.extend({params:{dosuspend:!0},schema:{reason:s.Z.REQUIRED_STRING},blocking:!0}),m=d.extend({params:{dounsuspend:!0},blocking:!0}),p=d.extend({params:{delete:!0,confirmed:!0},schema:{leave_dns:s.Z.OPTIONAL_BOOL},blocking:!0}),R=s.Z.post({url:"/CMD_ACCOUNT_ADMIN",params:{action:"create"},schema:{username:s.Z.REQUIRED_STRING,email:s.Z.REQUIRED_STRING,passwd:s.Z.REQUIRED_STRING,passwd2:s.Z.REQUIRED_STRING,notify:s.Z.REQUIRED_BOOL}}),O=s.Z.post({url:"/CMD_COMMENTS",params:{location:"CMD_SHOW_RESELLER"},schema:{user:s.Z.REQUIRED_STRING,comments:s.Z.REQUIRED_STRING}}),E=s.Z.post({url:"/CMD_MOVE_USERS",id:"USERS_COUNT_PER_RESELLER",response:{},after:_=>_.flow(_.getProp("data_list"),_.mapValues(I=>I.length))})},"./js/api/commands/admin/users/resellers.js":function(L,g,i){i.d(g,{Rf:function(){return R},Rh:function(){return O},UH:function(){return m},YY:function(){return I},Zg:function(){return _},fy:function(){return p},pw:function(){return E},tr:function(){return c},xn:function(){return d}});var s=i("./js/api/command/index.js");const d=s.Z.post({id:"RESELLER_OPTIONS",url:"/CMD_ACCOUNT_RESELLER",notifySuccess:!1,blocking:!1,after:t=>t.flow(t.moveProp("free_ips","freeIPs"),t.mapProp("freeIPs",t.convert.toAppNumber),t.mapProp("ip_select",t.toSelect))}),c=s.Z.post({url:"/CMD_ACCOUNT_RESELLER",params:{action:"create",add:!0},schema:{username:s.Z.REQUIRED_STRING,email:s.Z.REQUIRED_STRING,passwd:s.Z.REQUIRED_STRING,passwd2:s.Z.REQUIRED_STRING,domain:s.Z.REQUIRED_STRING,package:s.Z.OPTIONAL_STRING,notify:s.Z.REQUIRED_BOOL,ip:s.Z.REQUIRED_STRING}}),m=s.Z.get({id:"RESELLERS",url:"/CMD_RESELLER_SHOW",pagination:!0,params:{bytes:!0},after:t=>t.flow(t.wrap("resellers"),t.moveProp({"resellers.reasons":"reasons"}),t.mapProp("resellers",t.toTable(t.mapArray(n=>{if(typeof n.bandwidth=="string")return{username:n.username,valid:!1};const[r,e]=n.nusers.split("/");return{username:n.username,nusers:r,nuserslimit:t.convert.toAppLimit(e),suspended:n.suspended.value!=="no:",reason:n.suspended.reason||"none",vdomains:t.toLimitedUsage()(n.vdomains),bandwidth:t.toLimitedUsage()(n.bandwidth),quota:t.toLimitedUsage()(n.quota),valid:!0}}))),t.mapProp("reasons",t.toSelect))}),p=s.Z.get({id:"RESELLER_STATS",url:"/CMD_SHOW_RESELLER",params:{bytes:!0},schema:{user:s.Z.REQUIRED_STRING},after:t=>t.flow(t.project({comments:"comments",info:"stats",usage:"stats",stats:"stats",users:"users",deleted_user_bandwidth:"stats",additional_bandwidth:"stats"}),t.mapProps({usage:t.flow(t.deleteProp("info"),t.filter(t.getProp("max_usage")),t.transformObject(({setting:n,usage:r,allocated:e,max_usage:a})=>({[n]:{usage:r,allocated:e,limit:a}})),t.mapValues(t.mapProps({usage:t.convert.toAppNumber,limit:t.convert.toAppLimit,allocated:t.convert.toAppLimit}))),stats:t.flow(t.deleteProp("info"),t.filter(t.flow(t.getProp("usage"),n=>["ON","OFF"].includes(n))),t.transformObject(({setting:n,usage:r})=>({[n]:r})),t.mapValues(t.convert.toAppBoolean)),info:t.flow(t.deleteProp("info"),t.filter(n=>!n.max_usage&&!["ON","OFF"].includes(n.usage)),t.transformObject(({setting:n,usage:r})=>({[n]:r}))),comments:t.flow(t.convert.toAppString,t.convert.toAppText),users:t.toTable(t.mapArrayProps({bandwidth:t.toLimitedUsage(),quota:t.toLimitedUsage(),vdomains:t.toLimitedUsage(),suspended:t.flow(t.isEqual("No"),t.not)})),skinInfo:t.feedWith(1,t.flow(t.project({custom:"is_reseller_skin",path:"reseller_skin",owner:"reseller_skin_owner"}),t.mapProp("custom",t.isEqual("1")))),deleted_user_bandwidth:t.flow(t.deleteProp("info"),Object.values,n=>n.find(({setting:r})=>r==="deleted_user_bandwidth"),n=>typeof n!="undefined"?t.mapProps({usage:t.convert.toAppNumber,limit:t.convert.toAppLimit,allocated:t.convert.toAppLimit})(n):!1),additional_bandwidth:t.flow(t.deleteProp("info"),Object.values,n=>n.find(({setting:r})=>r==="additional_bandwidth")||{usage:!1},n=>n.usage)}))}),R=s.Z.get({id:"RESELLER_USERS",url:"/CMD_SHOW_RESELLER",params:{bytes:!0},pagination:!0,schema:{user:s.Z.REQUIRED_STRING},after:t=>t.flow(t.getProp("users"),t.toTable(t.mapArrayProps({bandwidth:t.toLimitedUsage(),quota:t.toLimitedUsage(),vdomains:t.toLimitedUsage(),suspended:t.flow(t.isEqual("No"),t.not)})))}),O=s.Z.get({id:"RESELLER_DATA",url:"/CMD_MODIFY_RESELLER",params:{bytes:!0},schema:{user:s.Z.REQUIRED_STRING},after:t=>t.flow(n=>({packageData:n,packages:n.packages,package:n.packages,custom:n.custom_items,haveInode:n.have_inode,cgroup:n.cgroup}),t.mapProps({haveInode:t.isEqual("yes"),package:t.flow(t.find(t.getProp("selected")),t.getProp("value")),packages:t.flow(t.transformObject(({value:n,text:r})=>({[n]:r})),t.filter((n,r)=>!!r)),custom:t.flow(t.toArray,t.mapArray(n=>{const r={type:n.type,description:n.desc,label:n.string,name:n.name};switch(n.type){case"checkbox":return Object.assign(r,{value:t.isEqual("yes")(n.checked)});case"text":return Object.assign(r,{value:n.value});case"listbox":return Object.assign(r,{value:t.flow(t.find(t.getProp("selected")),t.getProp("value"))(n.select),options:t.transformObject(({value:e,text:a})=>({[e]:a}))(n.select)});default:return!1}}),t.filter(t.notEmpty)),packageData:t.flow(t.deleteProps(["packages","have_inode","custom_items"]),t.transformObject((n,r)=>{if(n.type==="unlimited"){const e=t.convert.toAppLimit(n.value)===1/0,a=e?"":n.value;return{limits:{[r]:{value:a,unlimited:e}}}}return n.type==="checkbox"?{features:{[r]:n.checked==="yes"}}:{[r]:n}})),cgroup:n=>n?Object.values({...n.options||{},...n.saved||{}}):[]}))}),E=s.Z.post({url:"/CMD_MODIFY_RESELLER",params:{action:"package"},schema:{user:s.Z.REQUIRED_STRING,package:s.Z.REQUIRED_STRING}}),_=s.Z.post({url:"/CMD_MODIFY_RESELLER",params:{action:"customize",bytes:!0},schema:{user:s.Z.REQUIRED_STRING,bandwidth:s.Z.OPTIONAL_STRING,ubandwidth:s.Z.OPTIONAL_BOOL,quota:s.Z.OPTIONAL_STRING,uquota:s.Z.OPTIONAL_BOOL,inode:s.Z.OPTIONAL_STRING,uinode:s.Z.OPTIONAL_BOOL,vdomains:s.Z.OPTIONAL_STRING,uvdomains:s.Z.OPTIONAL_BOOL,nsubdomains:s.Z.OPTIONAL_STRING,unsubdomains:s.Z.OPTIONAL_BOOL,nemails:s.Z.OPTIONAL_STRING,unemails:s.Z.OPTIONAL_BOOL,nemailf:s.Z.OPTIONAL_STRING,unemailf:s.Z.OPTIONAL_BOOL,nemailml:s.Z.OPTIONAL_STRING,unemailml:s.Z.OPTIONAL_BOOL,nemailr:s.Z.OPTIONAL_STRING,unemailr:s.Z.OPTIONAL_BOOL,mysql:s.Z.OPTIONAL_STRING,umysql:s.Z.OPTIONAL_BOOL,domainptr:s.Z.OPTIONAL_STRING,udomainptr:s.Z.OPTIONAL_BOOL,ftp:s.Z.OPTIONAL_STRING,uftp:s.Z.OPTIONAL_BOOL,aftp:s.Z.OPTIONAL_STRING,cgi:s.Z.OPTIONAL_STRING,git:s.Z.OPTIONAL_STRING,php:s.Z.OPTIONAL_STRING,spam:s.Z.OPTIONAL_STRING,catchall:s.Z.OPTIONAL_STRING,ssl:s.Z.OPTIONAL_STRING,ssh:s.Z.OPTIONAL_STRING,userssh:s.Z.OPTIONAL_STRING,oversell:s.Z.OPTIONAL_STRING,cron:s.Z.OPTIONAL_STRING,sysinfo:s.Z.OPTIONAL_STRING,login_keys:s.Z.OPTIONAL_STRING,dnscontrol:s.Z.OPTIONAL_STRING}}),I=s.Z.post({url:"/CMD_MODIFY_RESELLER",params:{additional_bw:!0,action:"single",json:null},schema:{user:s.Z.REQUIRED_STRING,additional_bandwidth:s.Z.REQUIRED_STRING}})},"./js/pages/admin/users/resellers/index.vue":function(L,g,i){i.r(g),i.d(g,{default:function(){return n}});var s=function(){var e=this,a=e._self._c;return a("app-page",{attrs:{actions:[{handler:()=>e.$router.push("/admin/users/resellers/create"),label:e.$gettext("Create Reseller"),icon:"create-reseller"},{handler:()=>e.$router.push("/admin/users/admins/create"),label:e.$gettext("Create Administrator"),icon:"create-administrator"},{handler:()=>e.$router.push("/reseller/create-user"),label:e.$gettext("Add New User"),icon:"add-new-user"}]},scopedSlots:e._u([{key:"details",fn:function(){return[a("ui-infobar-item",{attrs:{title:e.$gettext("Stats")}},[a("ui-infobar-stats",{attrs:{usage:e.count,limit:1/0,title:e.$gettext("Resellers Count")}})],1)]},proxy:!0},{key:"default",fn:function(){return[a("app-page-section",[a("ui-api-table",e._b({on:{"action:message":function(o){e.$dialog("CREATE_MESSAGE_DIALOG").open()},"action:suspend":function(o){e.$dialog("SUSPEND_USER_DIALOG").open()},"action:unsuspend":e.unsuspendResellers,"action:remove":e.showDeleteDialog},scopedSlots:e._u([{key:"col:username",fn:function({username:o,suspended:l,reason:u,valid:S}){return[S?a("ui-link",{attrs:{name:"admin/users/resellers/view",params:{user:o}}},[e._v(`
                        `+e._s(o)+`
                    `)]):a("span",{domProps:{textContent:e._s(o)}}),e._v(" "),l?a("ui-tooltip",{attrs:{theme:"danger",icon:"warning"}},[a("span",{domProps:{textContent:e._s(e.$gettextInterpolate(e.$gettext("Suspended: %{ reason }"),{reason:e.reasons[u]}))}})]):e._e(),e._v(" "),S?e._e():a("ui-tooltip",{key:"corrupted",attrs:{theme:"danger",icon:"warning"}},[a("span",{domProps:{textContent:e._s(e.$gettext("Error reading file"))}})])]}},{key:"col:bandwidth",fn:function({bandwidth:o,valid:l}){return[l?a("ui-limited-usage",e._b({},"ui-limited-usage",o,!1)):e._e()]}},{key:"col:quota",fn:function({quota:o,valid:l}){return[l?a("ui-limited-usage",e._b({},"ui-limited-usage",o,!1)):e._e()]}},{key:"col:vdomains",fn:function({vdomains:o,valid:l}){return[l?a("ui-limited-usage",e._b({attrs:{plain:""}},"ui-limited-usage",o,!1)):e._e()]}},{key:"col:nusers",fn:function({nusers:o,nuserslimit:l,valid:u}){return[u?a("ui-limited-usage",{attrs:{plain:"",usage:o,limit:l}}):e._e()]}},{key:"row:actions",fn:function({username:o,suspended:l}){return[a("ui-actions",[a("ui-link",{on:{click:function(u){e.select=[o],e.$dialog("CREATE_MESSAGE_DIALOG").open()}}},[a("span",{domProps:{textContent:e._s(e.$gettext("Send a Message"))}})]),e._v(" "),l?e._e():a("ui-link",{on:{click:function(u){e.select=[o],e.$dialog("SUSPEND_USER_DIALOG").open()}}},[a("span",{domProps:{textContent:e._s(e.$gettext("Suspend"))}})]),e._v(" "),l?a("ui-link",{on:{click:function(u){e.select=[o],e.unsuspendResellers()}}},[a("span",{domProps:{textContent:e._s(e.$gettext("Unsuspend"))}})]):e._e(),e._v(" "),a("ui-link",{on:{click:function(u){return e.loginAs(o)}}},[a("span",{domProps:{textContent:e._s(e.$gettextInterpolate(e.$gettext("Login as %{ username }"),{username:o}))}})]),e._v(" "),a("ui-link",{on:{click:function(u){return e.changePassword(o)}}},[a("span",{domProps:{textContent:e._s(e.$gettextInterpolate(e.$gettext("Change %{ username }'s password"),{username:o}))}})]),e._v(" "),a("ui-link",{on:{click:function(u){return e.deleteReseller(o)}}},[a("span",{domProps:{textContent:e._s(e.$gettext("Remove"))}})])],1)]}}]),model:{value:e.select,callback:function(o){e.select=o},expression:"select"}},"ui-api-table",{command:e.$commands.getResellers,property:"resellers",rowID:"username",columns:{username:{label:e.$gettext("Name"),grow:!0,searchable:!0},bandwidth:{label:e.$gettext("Bandwidth"),getClass:o=>o.valid&&o.bandwidth.status?`--usage:${o.bandwidth.status}`:"",width:"20%"},quota:{label:e.$gettext("Disk Usage"),getClass:o=>o.valid&&o.bandwidth.status?`--usage:${o.quota.status}`:"",width:"20%"},nusers:e.$gettext("# of Users"),vdomains:e.$gettext("# of domains"),suspended:{label:e.$gettext("Suspended"),hide:!0,searchable:{type:"select",comparison:"contains",options:{"yes:":e.$gettext("Yes"),"no:":e.$gettext("No")}}}},actions:{message:e.$gettext("Send a Message"),suspend:e.$gettext("Suspend"),unsuspend:e.$gettext("Unsuspend"),remove:e.$gettext("Delete")}},!1))],1),e._v(" "),a("create-message-dialog",{attrs:{users:e.select}}),e._v(" "),a("ui-dialog",{attrs:{id:"DELETE_RESELLERS_DIALOG",theme:"danger",size:"normal",title:e.$ngettext("Delete Reseller","Delete Resellers",e.select.length)},scopedSlots:e._u([{key:"content",fn:function(){return[a("span",{domProps:{textContent:e._s(e.$gettext("Please confirm your request"))}}),e._v(" "),a("input-select-multiple",{attrs:{options:e.select,"hide-header":""},scopedSlots:e._u([e._l(e.selectedResellers,function(o){return{key:`option:${o.username}`,fn:function(){return[a("span",{key:o.username},[Number(o.nusers)?[a("span",{domProps:{textContent:e._s(e.$gettextInterpolate(e.$ngettext("Reseller: %{ username } and %{ nusers } user","Reseller: %{ username } and %{ nusers } users",Number(o.nusers)),{username:o.username,nusers:o.nusers}))}}),e._v(" "),a("ui-tooltip",{attrs:{theme:"danger"}},[a("span",{domProps:{textContent:e._s(e.$gettext("You are deleting reseller that have users under control. If you proceed, these user accounts, along with ALL the associated website and email contents, which are not listed here, will also be removed."))}})])]:a("span",{domProps:{textContent:e._s(e.$gettextInterpolate(e.$gettext("Reseller: %{ username }"),{username:o.username}))}})],2)]},proxy:!0}})],null,!0),model:{value:e.remove,callback:function(o){e.remove=o},expression:"remove"}})]},proxy:!0},{key:"buttons",fn:function(){return[a("ui-button",{attrs:{theme:"danger",disabled:e.remove.length===0},on:{click:e.deleteResellers}},[a("span",{domProps:{textContent:e._s(e.$gettext("Confirm"))}})])]},proxy:!0}])}),e._v(" "),a("suspend-user-dialog",{attrs:{"api-reasons":e.$api.reasons.options},on:{suspend:e.suspendResellers}}),e._v(" "),a("change-password-dialog",{ref:"cpd"})]},proxy:!0}])})},d=[],c=i("./js/api/commands/admin/users/resellers.js"),m=i("./js/api/commands/admin/users/actions.js"),p=i("./js/components/local/create-message-dialog.vue"),R=i("./js/components/local/suspend-user-dialog.vue"),O=i("./js/components/local/change-user-password-dialog.vue"),E={preload:c.UH,commands:{getResellers:c.UH},components:{CreateMessageDialog:p.Z,SuspendUserDialog:R.Z,ChangePasswordDialog:O.Z},api:c.UH,data:()=>({select:[],remove:[]}),computed:{reasons(){return R.Z.$exports.reasons.call(this,this.$api.reasons.options)},selectedResellers(){return this.select.map(r=>this.$api.resellers.rows.find(e=>e.username===r))},count(){return this.$api.resellers.rowsCount}},methods:{deleteReseller(r){this.select=[r],this.showDeleteDialog()},deleteResellers(){(0,m.Vt)({select:this.remove,location:"CMD_RESELLER_SHOW"}).then(this.$reloadApiTable)},suspendResellers(r){(0,m.f1)({select:this.select,...r,location:"CMD_RESELLER_SHOW"}).then(this.$reloadApiTable)},unsuspendResellers(){(0,m.Ss)({select:this.select,location:"CMD_RESELLER_SHOW"}).then(this.$reloadApiTable)},loginAs(r){this.$_ctx.session.impersonateUser(r)},changePassword(r){this.$refs.cpd.show(r)},showDeleteDialog(){this.remove=this.select,this.$dialog("DELETE_RESELLERS_DIALOG").open()}}},_=E,I=i("../node_modules/vue-loader/lib/runtime/componentNormalizer.js"),t=(0,I.Z)(_,s,d,!1,null,null,null),n=t.exports}}]);
