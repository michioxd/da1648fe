(self.webpackChunk=self.webpackChunk||[]).push([[7388],{"../node_modules/mini-css-extract-plugin/dist/loader.js??clonedRuleSet-13.use[1]!../node_modules/css-loader/dist/cjs.js??clonedRuleSet-13.use[2]!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/postcss-loader/dist/cjs.js??clonedRuleSet-13.use[3]!../node_modules/sass-loader/dist/cjs.js??clonedRuleSet-13.use[4]!../node_modules/vue-loader/lib/index.js??vue-loader-options!../node_modules/unplugin/dist/webpack/loaders/transform.js?unpluginName=unplugin-vue-define-options!./js/pages/user/two-step-auth.vue?vue&type=style&index=0&id=2a0b2e86&prod&lang=scss&":function(){},"./js/composables/dateFilter.ts":function(S,f,n){"use strict";n.d(f,{W:function(){return u},f:function(){return _.f}});var d=n("../node_modules/ramda/es/index.js"),p=n("../node_modules/date-fns/esm/format/index.js"),_=n("./js/modules/date-formats.ts"),i=n("./js/modules/customizations/date-formats/default.ts");const u=d.WAo((l,m)=>{if(m)try{return(0,p.Z)(m,_.f.value[l])}catch(x){return console.warn(`Given ${l} format is incorrect:
${x.message}`),(0,p.Z)(m,i.d[l])}return""})},"./js/composables/filters.ts":function(S,f,n){"use strict";n.d(f,{Q0:function(){return C},aS:function(){return j},d5:function(){return E},eB:function(){return $},hT:function(){return y},kC:function(){return x},n9:function(){return h},zM:function(){return b}});var d=n("../node_modules/date-fns/esm/formatDistance/index.js"),p=n("../node_modules/punycode/punycode.es6.js"),_=n("./js/composables/dateFilter.ts"),i=n("./js/composables/gettext.ts");const{$gettext:u,$ngettext:l,$gettextInterpolate:m}=(0,i.Z)(),x=o=>{var a;return o?((a=o.at(0))===null||a===void 0?void 0:a.toUpperCase())+o.slice(1):""},y=(o,a="datetime")=>(0,_.W)(a,o),b=o=>(0,d.Z)(o,new Date),$=(o,a=1024)=>{const c=Number(o);if(!c)return"0 B";const g=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],v=Math.floor(Math.log(c)/Math.log(a));return`${parseFloat((c/a**v).toFixed(2))} ${g[v]}`},R=o=>{try{return(0,p.xX)(o)}catch(a){return o}},h=o=>(0,p.xX)(o),C=o=>{if(!o||!o.includes("@"))return o;const[a,c]=o.split("@");return[a,R(c)].join("@")},E=o=>{if(o<60)return u("less than a minute");const a=Math.floor(o/60)%60,c=Math.floor(o/3600)%24,g=Math.floor(o/(3600*24)),v=[g?l("%{days} day","%{days} days",g):null,c?l("%{hours} hour","%{hours} hours",c):null,a?l("%{minutes} minute","%{minutes} minutes",a):null].filter(Boolean).join(", ");return m(v,{days:g,hours:c,minutes:a})},j=(o,a)=>o.length<=a?o:`${o.substring(0,a)}...`,A=()=>({capitalize:x,date:y,distanceFromNow:b,humanReadableSize:$,p6eUnicode:h,p6eUnicodeEmail:C,formatUptime:E,truncateString:j})},"./js/pages/user/two-step-auth.vue":function(S,f,n){"use strict";n.r(f),n.d(f,{default:function(){return w}});var d=function(){var e=this,t=e._self._c;return t("app-page",{attrs:{id:"two-step-auth",actions:[{label:e.$gettext("Generate Secret"),icon:"#dices",handler:e.generateSecret,visible:e.$api.values.requireGeneration},{label:e.$gettext("Add Codes"),icon:"#plus-fill",handler:e.$dialog("ADD_CODES_DIALOG").open,visible:!e.$api.values.requireGeneration&&e.tab==="codes"},{label:e.$gettext("Print"),handler:e.printCodes,icon:"#console",visible:!e.$api.values.requireGeneration&&e.tab==="codes",theme:"safe"}]},scopedSlots:e._u([{key:"page:title",fn:function(){return[t("div",{directives:[{name:"flex",rawName:"v-flex",value:{cross:"center"},expression:"{ cross: 'center' }"}]},[t("span",{domProps:{textContent:e._s(e.$gettext("Two-Step Authentication"))}}),e._v(" "),t("ui-tooltip",{directives:[{name:"margin",rawName:"v-margin",value:[,,,1],expression:"[, , , 1]"}],attrs:{placement:"bottom"}},[t("div",{domProps:{textContent:e._s(e.$gettext("To use this feature, download the Google Authenticator App for your phone (or equivalent), and scan in the QR code."))}}),e._v(" "),t("div",{domProps:{textContent:e._s(e.$gettext("The App will show you a code, which you'll use to Login to DirectAdmin."))}}),e._v(" "),t("div",{domProps:{textContent:e._s(e.$gettext("Scratch Codes are one-time use codes in case you don't have your phone, so keep them safe."))}})])],1)]},proxy:!0},{key:"default",fn:function(){return[e.$api.values.requireGeneration&&!e.$api.secretGenerated?t("app-page-section",[t("strong",{domProps:{textContent:e._s(e.$gettext("This feature is not turned on."))}}),e._v(" "),t("p",{domProps:{textContent:e._s(e.$gettext("Create a new secret to begin."))}})]):t("ui-tabs",{attrs:{tabs:[{id:"general",label:e.$gettext("Settings")},{id:"codes",label:e.$gettext("Scratch Codes")}],"hide-single-tab":"",selected:e.tab},on:{"update:selected":function(r){e.tab=r}},scopedSlots:e._u([{key:"tab:general",fn:function(){return[e.$api.values.requireGeneration?e._e():[t("ui-form-element",{attrs:{underline:!1},scopedSlots:e._u([{key:"title",fn:function(){return[t("span",{domProps:{textContent:e._s(e.$gettext("Secret"))}})]},proxy:!0},{key:"content",fn:function(){return[t("ui-input-group",{scopedSlots:e._u([{key:"additions:left",fn:function(){return[t("ui-button",{attrs:{title:e.$gettext("Generate Secret")},on:{click:e.generateSecret},scopedSlots:e._u([{key:"icon",fn:function(){return[t("ui-icon",{attrs:{id:"dices",theme:"primary"}})]},proxy:!0}],null,!1,2774584267)},[e._v(" "),e.clientStore.isPhone?e._e():t("span",{domProps:{textContent:e._s(e.$gettext("Generate Secret"))}})])]},proxy:!0},{key:"input",fn:function(){return[t("input-text",{attrs:{value:e.$api.secret.value,disabled:""}})]},proxy:!0},{key:"additions:right",fn:function(){return[t("ui-tooltip",{scopedSlots:e._u([{key:"trigger",fn:function(){return[t("ui-button",{attrs:{theme:"light"}},[t("ui-icon",{attrs:{id:"question",size:"medium",theme:"primary"}})],1)]},proxy:!0}],null,!1,4167410350)},[e._v(" "),t("div",{directives:[{name:"flex",rawName:"v-flex",value:{dir:"column",cross:"center"},expression:`{
                                                dir: 'column',
                                                cross: 'center',
                                            }`}],staticClass:"qr-code-tooltip"},[t("vue-qrcode",{directives:[{name:"margin",rawName:"v-margin",value:1,expression:"1"}],attrs:{value:e.getUrl,options:{width:e.clientStore.isPhone?"100":"200"}}}),e._v(" "),t("span",{domProps:{textContent:e._s(e.$gettext("Be sure to re-scan the QR code, as all old codes become invalid."))}})],1)])]},proxy:!0}],null,!1,20436621)})]},proxy:!0}],null,!1,85510012)}),e._v(" "),t("ui-form-element",{scopedSlots:e._u([{key:"title",fn:function(){return[t("span",{domProps:{textContent:e._s(e.$gettext("QR Code"))}})]},proxy:!0},{key:"content",fn:function(){return[t("ui-input-group",{scopedSlots:e._u([{key:"input",fn:function(){return[t("input-text",{attrs:{number:"",placeholder:e.$gettext("Test your phone's code")},model:{value:e.code,callback:function(r){e.code=r},expression:"code"}})]},proxy:!0},{key:"additions:right",fn:function(){return[t("ui-button",{attrs:{disabled:!e.code},on:{click:e.testAuthCode}},[t("span",{domProps:{textContent:e._s(e.$gettext("Test Code"))}})])]},proxy:!0}],null,!1,1827505841)})]},proxy:!0}],null,!1,3648476703)})],e._v(" "),t("ui-form-element",{scopedSlots:e._u([{key:"title",fn:function(){return[t("span",{domProps:{textContent:e._s(e.$gettext("Description"))}})]},proxy:!0},{key:"content",fn:function(){return[t("input-text",{model:{value:e.settings.description,callback:function(r){e.$set(e.settings,"description",r)},expression:"settings.description"}})]},proxy:!0}])}),e._v(" "),t("ui-form-element",{attrs:{underline:!1},scopedSlots:e._u([{key:"title",fn:function(){},proxy:!0},{key:"content",fn:function(){return[t("input-checkbox",{model:{value:e.settings.enabled,callback:function(r){e.$set(e.settings,"enabled",r)},expression:"settings.enabled"}},[t("span",{domProps:{textContent:e._s(e.$gettext("Require valid Two-Step Authentication Code to login to this account."))}})])]},proxy:!0}])}),e._v(" "),t("ui-form-element",{attrs:{underline:!1},scopedSlots:e._u([{key:"title",fn:function(){},proxy:!0},{key:"content",fn:function(){return[t("input-checkbox",{model:{value:e.settings.allowApiLogins,callback:function(r){e.$set(e.settings,"allowApiLogins",r)},expression:"settings.allowApiLogins"}},[t("span",{domProps:{textContent:e._s(e.$gettext("Allow API logins with the current User/password. Login Keys and Session Keys are always allowed."))}})])]},proxy:!0}])}),e._v(" "),t("ui-form-element",{attrs:{underline:!1},scopedSlots:e._u([{key:"title",fn:function(){},proxy:!0},{key:"content",fn:function(){return[t("input-checkbox",{model:{value:e.settings.notify,callback:function(r){e.$set(e.settings,"notify",r)},expression:"settings.notify"}},[t("span",{domProps:{textContent:e._s(e.$gettext("Notify me on all incorrect codes entries. Disabling this option will still notify you after 5 failed attempts."))}})])]},proxy:!0}])}),e._v(" "),t("ui-dialog",{attrs:{id:"NEW_SECRET_DIALOG",theme:"safe",size:"normal","no-close-btn":"",title:e.title},scopedSlots:e._u([{key:"content",fn:function(){return[t("div",[t("span",{domProps:{textContent:e._s(e.$gettext("New Secret Set:"))}}),e._v(" "),t("span",{staticClass:"code_edit"},[e._v(`
                                `+e._s(e.$api.secret.value)+`
                            `)]),e._v(" "),t("span",{staticClass:"disp:block",domProps:{textContent:e._s(e.$gettext("Be sure to re-scan the QR code, as all old codes become invalid."))}}),e._v(" "),t("vue-qrcode",{attrs:{value:e.getUrl,options:{width:200}}})],1)]},proxy:!0}])})]},proxy:!0},{key:"tab:codes",fn:function(){return[t("div",{attrs:{id:"scratch-codes"}},[t("ui-r-table",{attrs:{rows:e.$api.codes,columns:[{id:"code",label:e.$gettext("Scratch Code"),editable:!1},{id:"created",label:e.$gettext("Date Created")},{id:"expiry",label:e.$gettext("Expires")}],"rows-count":e.$api.codes.length,"checked-rows":e.checkedRows,"vertical-layout":e.clientStore.isPhone,"sort-by":e.sorter,"is-sortable":"","disable-pagination":"","equal-width-layout":""},on:{"update:checkedRows":function(r){e.checkedRows=r}},scopedSlots:e._u([{key:"table:actions",fn:function(){return[t("ui-table-action",{on:{click:e.deleteCodes}},[t("span",{domProps:{textContent:e._s(e.$gettext("Delete"))}})])]},proxy:!0},{key:"col:created",fn:function({created:r}){return[e._v(`
                            `+e._s(e.date(r,"datetime"))+`
                        `)]}},{key:"col:expiry",fn:function({expiry:r}){return[r?[e._v(`
                                `+e._s(e.date(r,"datetime"))+`
                            `)]:t("span",{domProps:{textContent:e._s(e.$gettext("Never"))}})]}}])})],1)]},proxy:!0}])}),e._v(" "),t("ui-dialog",{attrs:{id:"ADD_CODES_DIALOG",title:e.$gettext("Add Scratch Codes")},scopedSlots:e._u([{key:"content",fn:function(){return[t("div",[t("span",{domProps:{textContent:e._s(e.$gettext("Scratch Codes are one-time use codes in case you don't have your phone, so keep them safe."))}}),e._v(" "),t("ui-form-element",{scopedSlots:e._u([{key:"title",fn:function(){return[t("span",{domProps:{textContent:e._s(e.$gettext("Expiry"))}})]},proxy:!0},{key:"content",fn:function(){return[t("input-select",{attrs:{options:e.expiryOptions},model:{value:e.expiry,callback:function(r){e.expiry=r},expression:"expiry"}})]},proxy:!0}])})],1)]},proxy:!0},{key:"buttons",fn:function(){return[t("ui-button",{attrs:{theme:"primary"},on:{click:e.addCodes}},[t("span",{domProps:{textContent:e._s(e.$gettext("Add Codes"))}})])]},proxy:!0}])})]},proxy:!0},{key:"footer:buttons",fn:function(){return[e.tab==="general"&&!e.$api.values.requireGeneration?t("ui-button",{attrs:{theme:"primary"},on:{click:e.saveSettings}},[t("span",{domProps:{textContent:e._s(e.$gettext("Save"))}})]):e._e()]},proxy:!0}])})},p=[],_=n("./js/stores/index.ts"),i=n("./js/api/command/index.js");const u="/CMD_TWOSTEP_AUTH",l=i.Z.get({id:"TSA_SETTINGS",url:u,after:s=>s.flow(s.project({maxAttempts:"MAX_ATTEMPTS",description:"KEY_NAME",enabled:"TWOSTEP_AUTH_CHECKED",requireGeneration:"TWOSTEP_AUTH_DISABLED",notify:"NOTIFY_ON_ALL_FAILURES_CHECKED",allowApiLogins:"SECURITY_QUESTIONS_ON_API_CHECKED"}),s.mapProps({notify:s.isEqual("checked"),allowApiLogins:s.isEqual("checked"),enabled:s.convert.toAppBoolean,requireGeneration:s.convert.toAppBoolean}))}),m=i.Z.post({url:u,id:"GENERATE_TSA_SECRET",params:{action:"new_secret"},notifySuccess:!1}),x=i.Z.post({url:u,params:{action:"test"},schema:{code:i.Z.REQUIRED_STRING}}),y=i.Z.get({id:"TSA_SECRET",url:u,after:s=>s.project({value:"SPACED_SECRET",qr:"QR_URL"})}),b=i.Z.post({url:u,params:{action:"settings"},schema:{twostep_auth_description:i.Z.REQUIRED_STRING,twostep_auth:i.Z.REQUIRED_BOOL,api_with_password:i.Z.REQUIRED_BOOL,notify_on_all_twostep_auth_failures:i.Z.REQUIRED_BOOL}}),$=i.Z.post({url:"/CMD_ASK_TWOSTEP_AUTH",params:{action:"submit",json:!0},schema:{code:i.Z.REQUIRED_STRING,trust_device:i.Z.REQUIRED_BOOL,referrer:{...i.Z.OPTIONAL_STRING,default:"/"}}}),R=i.Z.post({url:u,params:{add:!0,action:"select"},schema:{expiry:i.Z.REQUIRED_STRING}}),h=i.Z.get({id:"TSA_CODES",url:u,response:[],after:s=>s.flow(s.getProp("scratch_codes"),s.mapValues((e,t)=>({code:t,...e})),s.toArray,s.mapArrayProps({created:s.convert.toAppDate,expiry:e=>e==="0"?!1:s.convert.toAppDate(e)}))}),C=i.Z.select({url:u,params:{delete:!0}});var E=n("./js/composables/filters.ts"),j=n("./js/api/converters.js"),A=n("../node_modules/date-fns/esm/fp/addDays/index.js"),o=n("../node_modules/date-fns/esm/fp/addWeeks/index.js"),a=n("../node_modules/date-fns/esm/fp/addMonths/index.js"),c=n("../node_modules/@chenfengyuan/vue-qrcode/dist/vue-qrcode.js"),g=n.n(c),v={preload:[l,y,h],api:[{command:l,bind:"values"},{command:m,bind:{isDone:"secretGenerated"}},{command:y,bind:"secret"},{command:h,bind:"codes"}],components:{VueQrcode:g()},data(){return{code:"",expiry:"0",checkedRows:[],tab:"general",settings:{description:"",enabled:!1,notify:!1,allowApiLogins:!1},title:""}},computed:{expiryOptions(){const s=r=>(0,j.toApiDate)(r(new Date)),e=[{label:this.$gettext("1 Day"),key:s((0,A.Z)(1))},{label:this.$gettext("2 Days"),key:s((0,A.Z)(2))},{label:this.$gettext("1 Week"),key:s((0,o.Z)(1))},{label:this.$gettext("2 Weeks"),key:s((0,o.Z)(2))},{label:this.$gettext("1 Month"),key:s((0,a.Z)(1))},{label:this.$gettext("6 Months"),key:s((0,a.Z)(6))},{label:this.$gettext("12 Months"),key:s((0,a.Z)(12))}],t=(r,{key:T,label:O})=>({...r,[T]:O});return e.reduce(t,{0:this.$gettext("Never")})},checkedCodes(){return this.checkedRows.map(s=>s.code)},getUrl(){const s=this.$_session.effectiveUsername,e=this.$_session.servername,t=this.$api.secret.value.replace(/\s+/g,"");return`otpauth://totp/${s}@${e}?secret=${t}&issuer=DirectAdmin`},...(0,_.Kc)(["client"])},created(){this.settings={...this.$api.values}},methods:{date:E.hT,async generateSecret(){const s=await m();s&&s.success&&(y(),l(),this.reloadScratchCodes(),this.title=s.success,this.$dialog("NEW_SECRET_DIALOG").open())},testAuthCode(){x({code:this.code})},async saveSettings(){await b({twostep_auth_description:this.settings.description,twostep_auth:this.settings.enabled,api_with_password:this.settings.allowApiLogins,notify_on_all_twostep_auth_failures:this.settings.notify})},async addCodes(){await R({expiry:this.expiry})&&this.reloadScratchCodes()},reloadScratchCodes(){h(),this.checkedRows=[]},printCodes(){document.querySelector("html").classList.add("print-scratch-codes"),window.print()},async deleteCodes(){await C({select:this.checkedCodes})&&this.reloadScratchCodes()},sorter(s){switch(s){case"expiry":return e=>e.expiry||1/0;case"created":return e=>e.created;default:return e=>Number(e.code)}}}},k=v,I=n("../node_modules/vue-style-loader/index.js!../node_modules/mini-css-extract-plugin/dist/loader.js??clonedRuleSet-13.use[1]!../node_modules/css-loader/dist/cjs.js??clonedRuleSet-13.use[2]!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/postcss-loader/dist/cjs.js??clonedRuleSet-13.use[3]!../node_modules/sass-loader/dist/cjs.js??clonedRuleSet-13.use[4]!../node_modules/vue-loader/lib/index.js??vue-loader-options!../node_modules/unplugin/dist/webpack/loaders/transform.js?unpluginName=unplugin-vue-define-options!./js/pages/user/two-step-auth.vue?vue&type=style&index=0&id=2a0b2e86&prod&lang=scss&"),D=n("../node_modules/vue-loader/lib/runtime/componentNormalizer.js"),P=(0,D.Z)(k,d,p,!1,null,null,null),w=P.exports},"../node_modules/vue-style-loader/index.js!../node_modules/mini-css-extract-plugin/dist/loader.js??clonedRuleSet-13.use[1]!../node_modules/css-loader/dist/cjs.js??clonedRuleSet-13.use[2]!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/postcss-loader/dist/cjs.js??clonedRuleSet-13.use[3]!../node_modules/sass-loader/dist/cjs.js??clonedRuleSet-13.use[4]!../node_modules/vue-loader/lib/index.js??vue-loader-options!../node_modules/unplugin/dist/webpack/loaders/transform.js?unpluginName=unplugin-vue-define-options!./js/pages/user/two-step-auth.vue?vue&type=style&index=0&id=2a0b2e86&prod&lang=scss&":function(S,f,n){var d=n("../node_modules/mini-css-extract-plugin/dist/loader.js??clonedRuleSet-13.use[1]!../node_modules/css-loader/dist/cjs.js??clonedRuleSet-13.use[2]!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/postcss-loader/dist/cjs.js??clonedRuleSet-13.use[3]!../node_modules/sass-loader/dist/cjs.js??clonedRuleSet-13.use[4]!../node_modules/vue-loader/lib/index.js??vue-loader-options!../node_modules/unplugin/dist/webpack/loaders/transform.js?unpluginName=unplugin-vue-define-options!./js/pages/user/two-step-auth.vue?vue&type=style&index=0&id=2a0b2e86&prod&lang=scss&");d.__esModule&&(d=d.default),typeof d=="string"&&(d=[[S.id,d,""]]),d.locals&&(S.exports=d.locals);var p=n("../node_modules/vue-style-loader/lib/addStylesClient.js").Z,_=p("00abf3f2",d,!0,{})}}]);
