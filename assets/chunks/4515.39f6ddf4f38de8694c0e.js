(self.webpackChunk=self.webpackChunk||[]).push([[4515],{"./js/api/commands/user/unit/index.js":function(R,g,s){"use strict";s.d(g,{ri:function(){return x},lJ:function(){return n},Hg:function(){return E},Af:function(){return a},sh:function(){return f},Bv:function(){return v},rY:function(){return m},dt:function(){return l},pV:function(){return t}});var o=s("./js/api/commands/converters/index.ts"),i=s("../node_modules/ramda/es/index.js");const r=i.zGw(i.Vl2(" "),i.YMb);function y(h,c){const T=c.processes?c.processes.toString():"",d=c.limits?c.limits.timeout.toString():"",e=c.limits?c.limits.requests.toString():"",u=c.root||c.working_directory||"";return{name:h,type:c.type||"php",typeid:r(c.type||"php"),owner:{user:c.user||"",group:c.group||""},processes:T,timeout:d,requests:e,options:{root:u,working_directory:u,arguments:c.arguments||[],environment:c.environment||{},executable:c.executable||"",targets:c.targets||{}}}}var j={getApps:i.zGw(i.vgT("applications"),i.Zpf,i.UID(([h,c])=>({name:h,app:c,type:r(c.type)}))),getAppModify({application:h,settings:c}){const{options:T}=(0,o.M1)(c.TYPE_SELECT),d=r(h.type);return{app:i.CEd(["type"],h),type:d,version:h.type,types:T,templates:{},cwd:c.ROOT||c.WORKING_DIRECTORY||""}},getAppCreate({application:h,settings:c,templates:T}){const{value:d,options:e}=(0,o.M1)(c.TYPE_SELECT),u=y(c.NAME,{type:d,...h}),_=S=>Array.isArray(S)?{route:S}:i.rO9({customTokens:i.zGw(i.Zpf,i.UID(([D,O])=>({key:D,...O})))},S);return{app:u,types:e,templates:i.rO9({unit_routes:i.UID(_)},T),cwd:c.ROOT||c.WORKING_DIRECTORY||""}}},p=s("./js/api/command/index.js");const x=p.Z.post({url:"/CMD_UNIT",domain:!0,params:{action:"create"},schema:{name:p.Z.REQUIRED_STRING,json:p.Z.REQUIRED_STRING}}),l=p.Z.post({url:"/CMD_UNIT",domain:!0,params:{action:"modify"},schema:{name:p.Z.REQUIRED_STRING,json:p.Z.REQUIRED_STRING}}),m=p.Z.get({id:"UNITS",url:"/CMD_UNIT",domain:!0,mapResponse:{apps:j.getApps,routes:h=>h.routes}}),f=p.Z.get({id:"UNIT_MODIFY",url:"/CMD_UNIT",domain:!0,params:{action:"modify"},schema:{name:p.Z.REQUIRED_STRING},mapResponse:j.getAppModify}),a=p.Z.get({id:"UNIT_CREATE",url:"/CMD_UNIT",domain:!0,params:{action:"create"},mapResponse:j.getAppCreate}),n=p.Z.select({url:"/CMD_UNIT",domain:!0,params:{delete:!0}}),t=p.Z.post({url:"/CMD_UNIT",domain:!0,params:{action:"set_route"},schema:{location:p.Z.REQUIRED_STRING,routes:p.Z.OPTIONAL_STRING}}),v=p.Z.get({url:"/CMD_UNIT",domain:!0,params:{action:"route_edit"},schema:{name:p.Z.REQUIRED_STRING}}),E=p.Z.select({url:"/CMD_UNIT",domain:!0,params:{action:"select_routes",delete:"true"}})},"../node_modules/mini-css-extract-plugin/dist/loader.js??clonedRuleSet-13.use[1]!../node_modules/css-loader/dist/cjs.js??clonedRuleSet-13.use[2]!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/postcss-loader/dist/cjs.js??clonedRuleSet-13.use[3]!../node_modules/sass-loader/dist/cjs.js??clonedRuleSet-13.use[4]!../node_modules/vue-loader/lib/index.js??vue-loader-options!../node_modules/unplugin/dist/webpack/loaders/transform.js?unpluginName=unplugin-vue-define-options!./js/pages/user/unit/_components/route-editor.vue?vue&type=style&index=0&id=74d4e888&prod&lang=scss&":function(){},"./js/api/commands/converters/customItems.ts":function(R,g,s){"use strict";s.d(g,{CR:function(){return j}});var o=s("../node_modules/ramda/es/index.js"),i=s("./js/api/commands/converters/index.ts"),r=s("./js/api/commands/utils/transduce.ts"),y=s("./js/api/commands/converters/toSelectData.ts");const j=l=>{const m={name:l.name,type:l.type==="listbox"?"select":l.type,label:l.string,description:l.desc||"",value:l.type==="checkbox"?(0,i.sw)(l.checked||"no"):l.value||""};return m.type==="select"?o.BPw(m,(0,y.M1)(l.select||{})):m},p=l=>(0,r.vr)([(0,r.uD)(m=>/^item\d+val$/.test(m)),(0,r.r5)(m=>{const f=m,a=m.replace("val","txt"),n=l[f],t=l[a];return{[n]:t}})],Object.keys(l)),x=(l,m)=>o.qCK(a=>{const n={name:a.name,type:a.type==="listbox"?"select":a.type,description:a.desc||"",value:a.value||"",label:a.string};return a.type==="listbox"?(n.value=a.default,n.options=p(a)):a.type==="checkbox"&&(n.value=a.checked==="yes"),n},o.BPw({name:l}),(0,r.vr)([(0,r.r5)(a=>{const[n,t]=o.Vl2("=",a);return{[n]:t}})]),o.Vl2("&"))(m);g.ZP={fromObject:j,fromString:x}},"./js/api/commands/converters/index.ts":function(R,g,s){"use strict";s.d(g,{l$:function(){return f.ZP},t0:function(){return o.t0},S8:function(){return o.S8},ql:function(){return o.ql},sw:function(){return o.sw},Qu:function(){return o.Qu},He:function(){return o.He},M1:function(){return m.M1},sf:function(){return n},cc:function(){return l}});var o=s("./js/api/commands/converters/primitive.ts"),i=s("../node_modules/monet/dist/monet.js"),r=s("./js/api/commands/types.ts");const y=t=>typeof t=="object"?i.Either.Right(t):i.Either.Left(new Error("Passed param is not an object")),j=t=>typeof t.usage=="string"?i.Either.Right(t):i.Either.Left(new Error("usage property is required")),p=t=>({usage:(0,o.He)(t.usage),limit:(0,o.Qu)(t.limit)}),x=({usage:t,limit:v})=>{let E=r.H.Normal;const h=Math.floor(t/v*100);return h>=100?E=r.H.OverUsed:h>80&&(E=r.H.AlmostUsed),{usage:t,limit:v,status:E}},l=t=>{const v=i.Either.Right(t).flatMap(y).flatMap(j).map(p).map(x);if(v.isLeft())throw v.left();return v.right()};var m=s("./js/api/commands/converters/toSelectData.ts"),f=s("./js/api/commands/converters/customItems.ts"),a=s("../node_modules/ramda/es/index.js");const n=t=>v=>{const{info:E}=v,h=a.CEd(["info"],v);return{columns:E.columns,rowsCount:Number(E.rows),rows:a.UID(t,a.VO0(h))}}},"./js/api/commands/converters/toSelectData.ts":function(R,g,s){"use strict";s.d(g,{M1:function(){return x}});var o=s("../node_modules/monet/dist/monet.js"),i=s.n(o),r=s("./js/api/commands/utils/transduce.ts"),y=s("../node_modules/ramda/es/index.js");const j=l=>o.Maybe.Some(l).flatMap(m=>{const f=m.find(a=>a.selected==="yes");return f?o.Maybe.Some(f):o.Maybe.None()}).flatMap(m=>o.Maybe.fromNull(m.value)).orSome(""),p=(0,r.vr)([(0,r.r5)(l=>({[l.value]:l.text}))]),x=l=>{const m=(0,y.VO0)(l);return{value:j(m),options:p(m)}}},"./js/api/commands/types.ts":function(R,g,s){"use strict";s.d(g,{H:function(){return o}});var o;(function(i){i.Normal="normal",i.AlmostUsed="almost_used",i.OverUsed="overused"})(o||(o={}))},"./js/api/commands/utils/transduce.ts":function(R,g,s){"use strict";s.d(g,{Re:function(){return y},r5:function(){return i},uD:function(){return r},vr:function(){return m},zh:function(){return x}});var o=s("../node_modules/ramda/es/index.js");const i=f=>a=>(n,t)=>{const v=f(t);return a(n,v)},r=f=>a=>(n,t)=>f(t)?a(n,t):n,y=(f,a)=>(f.push(a),f),j=(f,a)=>o.BPw(f,a),p=(f,a,n,t)=>{const v=o.qCK(...n);return t.reduce(v(a),f)},x=o.WAo(p),l=x([],y),m=x({},j)},"./js/pages/user/unit/_components/create-route.vue":function(R,g,s){"use strict";s.d(g,{Z:function(){return T}});var o=function(){var e=this,u=e._self._c;return u("ui-dialog",e._g({attrs:{id:"CREATE_ROUTE_DIALOG",size:"normal",title:e.$gettext("Create Route")},on:{"dialog:open":e.onOpen},scopedSlots:e._u([{key:"content",fn:function(){return[u("ui-tabs",{attrs:{tabs:[{id:"options",label:e.$gettext("Options")},e.customTokens.length?{id:"tokens",label:e.$gettext("Template Tokens")}:!1,{id:"json",label:e.$gettext("JSON")}].filter(Boolean)},scopedSlots:e._u([{key:"tab:options",fn:function(){return[u("ui-form-element",{attrs:{vertical:""},scopedSlots:e._u([{key:"title",fn:function(){return[u("span",{domProps:{textContent:e._s(e.$gettext("Template"))}})]},proxy:!0},{key:"content",fn:function(){return[u("input-select",{attrs:{options:e.ids},model:{value:e.id,callback:function(_){e.id=_},expression:"id"}})]},proxy:!0}])}),e._v(" "),u("ui-form-element",{attrs:{vertical:""},scopedSlots:e._u([{key:"title",fn:function(){return[u("span",{domProps:{textContent:e._s(e.$gettext("Location"))}})]},proxy:!0},{key:"content",fn:function(){return[u("location-editor",{model:{value:e.location,callback:function(_){e.location=_},expression:"location"}})]},proxy:!0}])}),e._v(" "),u("ui-form-element",{attrs:{vertical:"",validators:{required:!0}},scopedSlots:e._u([{key:"title",fn:function(){return[u("span",{domProps:{textContent:e._s(e.$gettext("App"))}})]},proxy:!0},{key:"content",fn:function(){return[u("input-autocomplete",{attrs:{values:e.apps,disabled:e.forceAppName},model:{value:e.name,callback:function(_){e.name=_},expression:"name"}})]},proxy:!0}])}),e._v(" "),u("ui-form-element",{attrs:{vertical:""},scopedSlots:e._u([{key:"title",fn:function(){return[u("span",{domProps:{textContent:e._s(e.$gettext("Static Content Path"))}})]},proxy:!0},{key:"content",fn:function(){return[u("input-text",{model:{value:e.wd,callback:function(_){e.wd=_},expression:"wd"}})]},proxy:!0}])})]},proxy:!0},{key:"tab:tokens",fn:function(){return e._l(e.customTokens,function(_){return u("ui-form-element",{key:_.key,scopedSlots:e._u([{key:"title",fn:function(){return[u("span",{domProps:{textContent:e._s(_.displayName)}})]},proxy:!0},{key:"content",fn:function(){return[u("input-text",{model:{value:e.customTokenVars[_.key],callback:function(S){e.$set(e.customTokenVars,_.key,S)},expression:"customTokenVars[token.key]"}})]},proxy:!0}],null,!0)})})},proxy:!0},{key:"tab:json",fn:function(){return[u("ui-form-element",{key:"json",attrs:{vertical:""},scopedSlots:e._u([{key:"title",fn:function(){return[u("span",{domProps:{textContent:e._s(e.$gettext("Route"))}})]},proxy:!0},{key:"content",fn:function(){return[u("route-editor",{ref:"editor",on:{"update:valid":function(_){e.isValid=_}},model:{value:e.route,callback:function(_){e.route=_},expression:"route"}})]},proxy:!0}])})]},proxy:!0}])})]},proxy:!0},{key:"buttons",fn:function(){return[u("ui-button",{attrs:{theme:"safe",size:"big",disabled:!e.valid},on:{click:e.saveRoute}},[u("span",{domProps:{textContent:e._s(e.$gettext("Create"))}})])]},proxy:!0}])},e.$listeners))},i=[],r=s("../node_modules/ramda/es/index.js"),y=s("./js/pages/user/unit/_components/route-editor.vue"),j=function(){var e=this,u=e._self._c;return u("input",e._b({attrs:{type:"text"},domProps:{value:e.value},on:{input:e.setValue,blur:e.onBlur}},"input",e.$attrs,!1))},p=[],x={model:{prop:"value",event:"update:value"},props:{value:{type:String,required:!0}},watch:{value:{handler(d,e){r.YMb(d)!=="/"&&this.$emit("update:value",e||"/")},immediate:!0}},methods:{setValue(d){this.$emit("update:value",d.target.value)},onBlur(d){r.Z$Q(d.target.value)!=="/"&&this.$emit("update:value",r.zoF(d.target.value,"/"))}}},l=x,m=s("../node_modules/vue-loader/lib/runtime/componentNormalizer.js"),f=(0,m.Z)(l,j,p,!1,null,null,null),a=f.exports,n=s("./js/api/commands/user/unit/index.js");const t=[{action:{pass:"applications/|APP_NAME|"}}],v=[{action:{share:"|FULL_PATH|$uri",fallback:{pass:"applications/|APP_NAME|"}}}];var E={components:{RouteEditor:y.Z,LocationEditor:a},api:[{command:n.rY,bind:"units"},{command:n.Af,bind:"appCreate"},{command:n.sh,bind:"appModify"}],props:{appName:{type:String,required:!0},forceAppName:{type:Boolean,required:!1,default:!1},path:{type:String,required:!1,default:""}},data(){return{name:this.appName,id:"",route:`[
	
]`,isValid:!0,loading:!1,location:"",wd:"",defaultRoute:!0,customTokenVars:{}}},computed:{ids(){return r.XPQ(this.templates)},tokens(){const d=r.zGw(r.Zpf,r.UID(([e,u])=>[`|${e}|`,u]),r.Pen);return r.BPw({"|LOCATION|":this.location,"|APP_NAME|":[this.$domain,this.name].join("_"),"|FULL_PATH|":this.wd,"|DOMAIN|":this.$domain},d(this.customTokenVars))},homeDir(){return this.$_session.homeDir},template(){return this.id&&this.templates[this.id]?this.tokenize(this.updateShare(this.templates[this.id].route)):`[	
	]`},customTokens(){return this.id&&this.templates[this.id]?this.templates[this.id].customTokens||[]:[]},valid(){return this.name&&this.route&&this.isValid},templatesLoaded(){return r.xbD(this.$api.appCreate)===!1},templates(){return this.templatesLoaded?this.$api.appCreate.templates.unit_routes:{}},appsLoaded(){return r.xbD(this.$api.units)===!1},apps(){return this.appsLoaded?this.$api.units.apps.map(d=>d.name):[]},cwdLoaded(){return r.xbD(this.$api.appModify)===!1},cwd(){return this.cwdLoaded?this.$api.appModify.cwd:""}},watch:{template:{handler(d){this.route=d,this.defaultRoute=!1}},name:{handler(d){d&&this.apps.includes(d)&&(0,n.sh)({name:d}),d&&this.defaultRoute&&this.applyDefaultRoute()},immediate:!0},wd(){this.name&&this.defaultRoute&&this.applyDefaultRoute()},id(d){this.$set(this,"customTokenVars",{}),this.templates[d]&&this.templates[d].customTokens&&this.templates[d].customTokens.forEach(e=>{this.$set(this.customTokenVars,e.key,"")})}},methods:{setWD(){this.wd=this.path||`${this.homeDir}/domains/${this.$domain}`},tokenize(d){return JSON.stringify(d,null,2).replace(/(\|[^|]*\|)/g,u=>this.tokens[u]||u)},updateShare(d){if(this.cwd){const e=r.QMA(["action","share"]),u=r.gxm(_=>_!=="/dev/null",r.Bxt(this.cwd));return r.UID(r.xc(e,u),d)}return d},async onOpen(){Object.assign(this.$data,this.$options.data.apply(this)),this.name=this.appName,this.loading=!0,await Promise.all([this.templatesLoaded?null:(0,n.Af)(),this.appsLoaded?null:(0,n.rY)()]),this.loading=!1,this.setWD()},applyDefaultRoute(){this.route=this.tokenize(this.wd?v:t),this.defaultRoute=!0},async saveRoute(){await(0,n.pV)({location:this.location,routes:this.route})instanceof Error||(this.$emit("done",{}),this.$dialog("CREATE_ROUTE").close())}}},h=E,c=(0,m.Z)(h,o,i,!1,null,null,null),T=c.exports},"./js/pages/user/unit/_components/route-editor.vue":function(R,g,s){"use strict";s.d(g,{Z:function(){return a}});var o=function(){var t=this,v=t._self._c;return v("div",{staticClass:"route-editor"},[t.invalidJSON&&t.$refs.editor?v("ui-tooltip-popup",{attrs:{anchor:t.$refs.editor.$el,visible:"",theme:"danger"}},[v("span",{domProps:{textContent:t._s(t.$gettext("Invalid JSON"))}})]):t._e(),t._v(" "),v("codemirror",{ref:"editor",attrs:{value:t.value,options:{lineNumbers:!0,mode:{name:"javascript",json:!0},theme:t.theme}},on:{input:t.emit}})],1)},i=[],r=s("./js/vue-globals/helpers.js"),y=s("../node_modules/vue-codemirror/dist/vue-codemirror.js"),j=s("../node_modules/codemirror/mode/javascript/javascript.js");y.codemirror.beforeDestroy=void 0;var p={components:{codemirror:y.codemirror},model:{prop:"value",event:"update:value"},props:{value:{type:String,required:!0}},data:()=>({invalidJSON:!1,widgets:[],editor:null}),computed:{theme:(0,r.YM)("code-editor/theme")},watch:{value:{handler:"emit",immediate:!0}},mounted(){this.editor=this.$refs.editor.cminstance,this.validate(this.value)},methods:{emit(n){const t=this.validate(n);this.$emit("update:valid",t),t&&this.$emit("update:value",n)},parseJSON(n){try{return JSON.parse(n)}catch(t){return!1}},validate(n){const t=this.parseJSON(n);return this.invalidJSON=!t,t},appendWidget(n,t){const v=this.editor.addLineWidget(n-1,this.getWidget(t),{coverGutter:!1,noHScroll:!0});this.widgets.push(v)},clearWidgets(){this.widgets.forEach(n=>n.clear()),this.widgets=[]},getWidget(n){const t=document.createElement("div");return t.appendChild(document.createTextNode(n)),t.className="ajv-error",t}}},x=p,l=s("../node_modules/vue-style-loader/index.js!../node_modules/mini-css-extract-plugin/dist/loader.js??clonedRuleSet-13.use[1]!../node_modules/css-loader/dist/cjs.js??clonedRuleSet-13.use[2]!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/postcss-loader/dist/cjs.js??clonedRuleSet-13.use[3]!../node_modules/sass-loader/dist/cjs.js??clonedRuleSet-13.use[4]!../node_modules/vue-loader/lib/index.js??vue-loader-options!../node_modules/unplugin/dist/webpack/loaders/transform.js?unpluginName=unplugin-vue-define-options!./js/pages/user/unit/_components/route-editor.vue?vue&type=style&index=0&id=74d4e888&prod&lang=scss&"),m=s("../node_modules/vue-loader/lib/runtime/componentNormalizer.js"),f=(0,m.Z)(x,o,i,!1,null,null,null),a=f.exports},"../node_modules/vue-style-loader/index.js!../node_modules/mini-css-extract-plugin/dist/loader.js??clonedRuleSet-13.use[1]!../node_modules/css-loader/dist/cjs.js??clonedRuleSet-13.use[2]!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/postcss-loader/dist/cjs.js??clonedRuleSet-13.use[3]!../node_modules/sass-loader/dist/cjs.js??clonedRuleSet-13.use[4]!../node_modules/vue-loader/lib/index.js??vue-loader-options!../node_modules/unplugin/dist/webpack/loaders/transform.js?unpluginName=unplugin-vue-define-options!./js/pages/user/unit/_components/route-editor.vue?vue&type=style&index=0&id=74d4e888&prod&lang=scss&":function(R,g,s){var o=s("../node_modules/mini-css-extract-plugin/dist/loader.js??clonedRuleSet-13.use[1]!../node_modules/css-loader/dist/cjs.js??clonedRuleSet-13.use[2]!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/postcss-loader/dist/cjs.js??clonedRuleSet-13.use[3]!../node_modules/sass-loader/dist/cjs.js??clonedRuleSet-13.use[4]!../node_modules/vue-loader/lib/index.js??vue-loader-options!../node_modules/unplugin/dist/webpack/loaders/transform.js?unpluginName=unplugin-vue-define-options!./js/pages/user/unit/_components/route-editor.vue?vue&type=style&index=0&id=74d4e888&prod&lang=scss&");o.__esModule&&(o=o.default),typeof o=="string"&&(o=[[R.id,o,""]]),o.locals&&(R.exports=o.locals);var i=s("../node_modules/vue-style-loader/lib/addStylesClient.js").Z,r=i("0ccc5696",o,!0,{})}}]);
