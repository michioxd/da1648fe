"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[2526],{"./js/api/commands/converters/customItems.ts":function(x,E,e){e.d(E,{CR:function(){return p}});var o=e("../node_modules/ramda/es/index.js"),f=e("./js/api/commands/converters/index.ts"),h=e("./js/api/commands/utils/transduce.ts"),y=e("./js/api/commands/converters/toSelectData.ts");const p=r=>{const l={name:r.name,type:r.type==="listbox"?"select":r.type,label:r.string,description:r.desc||"",value:r.type==="checkbox"?(0,f.sw)(r.checked||"no"):r.value||""};return l.type==="select"?o.BPw(l,(0,y.M1)(r.select||{})):l},m=r=>(0,h.vr)([(0,h.uD)(l=>/^item\d+val$/.test(l)),(0,h.r5)(l=>{const a=l,s=l.replace("val","txt"),c=r[a],i=r[s];return{[c]:i}})],Object.keys(r)),k=(r,l)=>o.qCK(s=>{const c={name:s.name,type:s.type==="listbox"?"select":s.type,description:s.desc||"",value:s.value||"",label:s.string};return s.type==="listbox"?(c.value=s.default,c.options=m(s)):s.type==="checkbox"&&(c.value=s.checked==="yes"),c},o.BPw({name:r}),(0,h.vr)([(0,h.r5)(s=>{const[c,i]=o.Vl2("=",s);return{[c]:i}})]),o.Vl2("&"))(l);E.ZP={fromObject:p,fromString:k}},"./js/api/commands/converters/index.ts":function(x,E,e){e.d(E,{l$:function(){return a.ZP},t0:function(){return o.t0},S8:function(){return o.S8},ql:function(){return o.ql},sw:function(){return o.sw},Qu:function(){return o.Qu},He:function(){return o.He},M1:function(){return l.M1},sf:function(){return c},cc:function(){return r}});var o=e("./js/api/commands/converters/primitive.ts"),f=e("../node_modules/monet/dist/monet.js"),h=e("./js/api/commands/types.ts");const y=i=>typeof i=="object"?f.Either.Right(i):f.Either.Left(new Error("Passed param is not an object")),p=i=>typeof i.usage=="string"?f.Either.Right(i):f.Either.Left(new Error("usage property is required")),m=i=>({usage:(0,o.He)(i.usage),limit:(0,o.Qu)(i.limit)}),k=({usage:i,limit:v})=>{let R=h.H.Normal;const u=Math.floor(i/v*100);return u>=100?R=h.H.OverUsed:u>80&&(R=h.H.AlmostUsed),{usage:i,limit:v,status:R}},r=i=>{const v=f.Either.Right(i).flatMap(y).flatMap(p).map(m).map(k);if(v.isLeft())throw v.left();return v.right()};var l=e("./js/api/commands/converters/toSelectData.ts"),a=e("./js/api/commands/converters/customItems.ts"),s=e("../node_modules/ramda/es/index.js");const c=i=>v=>{const{info:R}=v,u=s.CEd(["info"],v);return{columns:R.columns,rowsCount:Number(R.rows),rows:s.UID(i,s.VO0(u))}}},"./js/api/commands/converters/toSelectData.ts":function(x,E,e){e.d(E,{M1:function(){return k}});var o=e("../node_modules/monet/dist/monet.js"),f=e.n(o),h=e("./js/api/commands/utils/transduce.ts"),y=e("../node_modules/ramda/es/index.js");const p=r=>o.Maybe.Some(r).flatMap(l=>{const a=l.find(s=>s.selected==="yes");return a?o.Maybe.Some(a):o.Maybe.None()}).flatMap(l=>o.Maybe.fromNull(l.value)).orSome(""),m=(0,h.vr)([(0,h.r5)(r=>({[r.value]:r.text}))]),k=r=>{const l=(0,y.VO0)(r);return{value:p(l),options:m(l)}}},"./js/api/commands/types.ts":function(x,E,e){e.d(E,{H:function(){return o}});var o;(function(f){f.Normal="normal",f.AlmostUsed="almost_used",f.OverUsed="overused"})(o||(o={}))},"./js/api/commands/utils/transduce.ts":function(x,E,e){e.d(E,{Re:function(){return y},r5:function(){return f},uD:function(){return h},vr:function(){return l},zh:function(){return k}});var o=e("../node_modules/ramda/es/index.js");const f=a=>s=>(c,i)=>{const v=a(i);return s(c,v)},h=a=>s=>(c,i)=>a(i)?s(c,i):c,y=(a,s)=>(a.push(s),a),p=(a,s)=>o.BPw(a,s),m=(a,s,c,i)=>{const v=o.qCK(...c);return i.reduce(v(s),a)},k=o.WAo(m),r=k([],y),l=k({},p)},"./js/pages/user/hotlinks/index.vue":function(x,E,e){e.r(E),e.d(E,{default:function(){return R}});var o={};e.r(o),e.d(o,{deleteHotlinkUrls:function(){return l},getHotlinkOptions:function(){return r},saveOptions:function(){return a}});var f=function(){var t=this,n=t._self._c;return n("app-page",{attrs:{actions:[{label:t.$gettext("Enable Hotlinks Protection"),handler:t.toggleHotlinks,icon:"#settings",visible:!t.$api.options.hotlinksEnabled,theme:"safe"},{label:t.$gettext("Disable Hotlinks Protection"),handler:t.toggleHotlinks,icon:"#settings",visible:t.$api.options.hotlinksEnabled,theme:"danger"},{label:t.$gettext("Add My Domains"),handler:t.addMyDomains,icon:"#plus-fill",visible:t.$api.options.hotlinksEnabled}]},scopedSlots:t._u([{key:"default",fn:function(){return[n("app-page-section",{scopedSlots:t._u([{key:"footer:buttons",fn:function(){return[n("ui-button",{attrs:{theme:"safe","validate-group":"hotlinkOptions"},on:{click:t.saveOptions}},[n("span",{domProps:{textContent:t._s(t.$gettext("Save"))}})])]},proxy:!0}])},[n("ui-r-table",{attrs:{rows:t.urls,columns:[{id:"url",label:t.$gettext("URL")}],"is-sortable":"","is-checkable":"","disable-pagination":"","checked-rows":t.checkedRows,"vertical-layout":t.clientStore.isPhone},on:{"update:checkedRows":function(d){t.checkedRows=d}},scopedSlots:t._u([{key:"table:actions",fn:function(){return[n("ui-table-action",{on:{click:t.deleteUrls}},[n("span",{domProps:{textContent:t._s(t.$gettext("Delete"))}})])]},proxy:!0}])}),t._v(" "),n("ui-input-group",{staticClass:"width:100%",scopedSlots:t._u([{key:"input",fn:function(){return[n("input-text",{on:{keyup:function(d){return!d.type.indexOf("key")&&t._k(d.keyCode,"enter",13,d.key,"Enter")?null:t.addUrl.apply(null,arguments)}},model:{value:t.newUrl,callback:function(d){t.newUrl=d},expression:"newUrl"}})]},proxy:!0},{key:"additions:right",fn:function(){return[n("ui-button",{attrs:{size:"normal",theme:"safe",disabled:!t.newUrl||t.redirectTo==="url"&&!t.url},on:{click:t.addUrl}},[n("span",{domProps:{textContent:t._s(t.$gettext("Add"))}})])]},proxy:!0}])}),t._v(" "),n("ui-form-element",{attrs:{group:"hotlinkOptions",validators:{required:!0}},scopedSlots:t._u([{key:"title",fn:function(){return[n("span",{domProps:{textContent:t._s(t.$gettext("Protected file types"))}})]},proxy:!0},{key:"content",fn:function(){return[n("input-text",{model:{value:t.files,callback:function(d){t.files=d},expression:"files"}})]},proxy:!0}])}),t._v(" "),n("ui-form-element",{scopedSlots:t._u([{key:"title",fn:function(){},proxy:!0},{key:"content",fn:function(){return[n("input-checkbox",{model:{value:t.allowBlankReferer,callback:function(d){t.allowBlankReferer=d},expression:"allowBlankReferer"}},[n("span",{domProps:{textContent:t._s(t.$gettext("Allow Blank Referrer"))}})])]},proxy:!0}])}),t._v(" "),n("ui-form-element",{scopedSlots:t._u([{key:"title",fn:function(){return[n("span",{domProps:{textContent:t._s(t.$gettext("Redirect to"))}})]},proxy:!0},{key:"content",fn:function(){return[n("div",{directives:[{name:"flex",rawName:"v-flex",value:{cross:"center"},expression:`{
                            cross: 'center',
                        }`}]},[n("input-radio",{attrs:{value:"forbidden"},model:{value:t.redirectTo,callback:function(d){t.redirectTo=d},expression:"redirectTo"}},[n("span",{domProps:{textContent:t._s(t.$gettext("403 Forbidden"))}})]),t._v(" "),n("input-radio",{directives:[{name:"margin",rawName:"v-margin",value:[,,,1],expression:"[, , , 1]"}],attrs:{value:"url"},model:{value:t.redirectTo,callback:function(d){t.redirectTo=d},expression:"redirectTo"}},[n("span",{domProps:{textContent:t._s(t.$gettext("URL"))}})])],1)]},proxy:!0}])}),t._v(" "),n("transition",{attrs:{name:"fade"}},[t.redirectTo==="url"?n("ui-form-element",{attrs:{group:"hotlinkOptions",validators:{required:!0}},scopedSlots:t._u([{key:"title",fn:function(){return[n("span",{domProps:{textContent:t._s(t.$gettext("Redirect URL"))}})]},proxy:!0},{key:"content",fn:function(){return[n("input-text",{model:{value:t.url,callback:function(d){t.url=d},expression:"url"}})]},proxy:!0}],null,!1,3377022313)}):t._e()],1)],1)]},proxy:!0}])})},h=[],y=e("./js/stores/index.ts"),p=e("./js/api/command/index.js"),m=e("../node_modules/ramda/es/index.js"),k=e("./js/api/commands/converters/index.ts");const r=p.Z.get({id:"HOTLINK_OPTIONS",url:"/CMD_HOTLINK",params:{ipp:99999,page:1},domain:!0,mapResponse:{urls:m.zGw(m.vgT("data"),m.CEd("info"),m.VO0,m.hXT(m.zGw(m.vgT("url"),Boolean))),options:u=>{const t=u.options,n=d=>t[d]==="checked";return{domains:u.options.MY_DOMAINS_LIST.split("\\n").filter(Boolean),hotlinkAllowBlankReferer:n("HOTLINK_ALLOW_BLANK_REFERER_CHECKED"),hotlinksEnabled:n("HOTLINK_ENALBED_CHECKED"),files:t.HOTLINK_PROTECT_FILES.split(","),redirectToForbidden:n("REDIRECT_TO_FORBIDDEN"),redirectToUrl:n("REDIRECT_TO_URL_CHECKED"),redirectTo:n("REDIRECT_TO_FORBIDDEN_CHECKED")?"forbidden":"url",url:t.REDIRECT_URL}}}}),l=p.Z.select({url:"/CMD_HOTLINK",params:{action:"multiple",delete:!0},domain:!0}),a=p.Z.post({url:"/CMD_HOTLINK",params:{action:"save"},domain:!0,schema:{enabled:{...p.Z.REQUIRED_STRING,validator:u=>["yes","no"].includes(u)},allow_blank_referer:{...p.Z.REQUIRED_STRING,validator:u=>["yes","no"].includes(u)},urls:p.Z.REQUIRED_STRING,files:p.Z.REQUIRED_STRING,redirect:{...p.Z.REQUIRED_STRING,validator:u=>["forbidden","url"].includes(u)},redirect_url:p.Z.OPTIONAL_STRING}});var s={name:"UserHotlinks",commands:o,preload:r,data:()=>({allowBlankReferer:!1,urls:[],files:"",redirectTo:"forbidden",url:"",checkedRows:[],newUrl:""}),api:[{command:r,bind:{"response.urls":"urls","response.options":"options"}}],computed:{select(){return this.checkedRows.map(u=>u.url)},urlString(){return this.urls.map(({url:u})=>u).join(`
`)},requestData(){return{enabled:this.$api.options.hotlinksEnabled?"yes":"no",allow_blank_referer:this.allowBlankReferer?"yes":"no",urls:this.urlString,files:this.files,redirect:this.redirectTo,redirect_url:this.url}},...(0,y.Kc)(["client"])},watch:{$domain:{async handler(){await r(),this.setHotlinkOptions()}}},created(){this.setHotlinkOptions()},methods:{async loadOptions(){await r(),this.urls=m.d9v(this.$api.urls)},async deleteUrls(){await l({select:this.select}).then(this.loadOptions),this.checkedRows=[]},toggleHotlinks(){a({...this.requestData,enabled:this.$api.options.hotlinksEnabled?"no":"yes"}).then(this.loadOptions)},saveOptions(){a(this.requestData).then(this.loadOptions)},setHotlinkOptions(){this.urls=m.d9v(this.$api.urls),this.files=this.$api.options.files.join(","),this.allowBlankReferer=this.$api.options.hotlinkAllowBlankReferer,this.url=this.$api.options.url,this.redirectTo=this.$api.options.redirectTo},addMyDomains(){const u=[...new Set([...this.urls.map(({url:t})=>t),...this.$api.options.domains])].join(`
`);a({...this.requestData,urls:u}).then(this.loadOptions)},addUrl(){this.urls.push({url:this.newUrl}),this.newUrl="",this.saveOptions()}}},c=s,i=e("../node_modules/vue-loader/lib/runtime/componentNormalizer.js"),v=(0,i.Z)(c,f,h,!1,null,null,null),R=v.exports}}]);
