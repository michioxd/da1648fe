"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[3943],{"./js/pages/user/protected-directories/_commands/index.js":function(h,u,o){o.d(u,{$z:function(){return p},Ee:function(){return t},Tp:function(){return d},Vt:function(){return i},cn:function(){return m},fE:function(){return e},m6:function(){return l},nb:function(){return _},wX:function(){return r}});var n=o("./js/api/command/index.js"),c=o("../node_modules/ramda/es/index.js");const s="/CMD_FILE_MANAGER",d=n.Z.post({url:s,params:{action:"protect",enabled:!0},schema:{path:n.Z.REQUIRED_STRING,user:n.Z.REQUIRED_STRING,passwd:n.Z.REQUIRED_STRING,passwd2:n.Z.REQUIRED_STRING}}),p=n.Z.get({id:"PROTECTED_DIRECTORIES",url:"/CMD_PROTECTED_DIRECTORIES",domain:!0,response:[]}),l=n.Z.get({id:"PROTECTED_DIRECTORY_STATUS",url:s,params:{action:"protect"},schema:{path:n.Z.REQUIRED_STRING},response:{protected:!1},after:()=>({ENABLED:a})=>({protected:!!a})}).extend({id:"PROTECTED_DIRECTORY_INFO",pagination:!0,response:{},after:a=>a.flow(a.deleteProp("ENABLED"),a.deleteProp("domain"),a.deleteProp("path"),a.processTableInfo("users"),a.moveProp({users:"rows",NAME:"name"}),a.mapProp("rows",a.toArray))}),m=n.Z.post({url:s,params:{action:"protect",enabled:!0},schema:{name:n.Z.REQUIRED_STRING,path:n.Z.REQUIRED_STRING,user:n.Z.REQUIRED_STRING,passwd:n.Z.REQUIRED_STRING,passwd2:n.Z.REQUIRED_STRING}}),i=n.Z.select({url:s,params:{action:"delete"},schema:{path:n.Z.REQUIRED_STRING}}),e=n.Z.post({url:s,params:{action:"protect"},schema:{name:n.Z.REQUIRED_STRING,path:n.Z.REQUIRED_STRING}}),t=n.Z.post({url:s,params:{action:"protect",enabled:!0},schema:{name:n.Z.REQUIRED_STRING,path:n.Z.REQUIRED_STRING}}),r=n.Z.get({url:"/CMD_FILE_MANAGER",params:{action:"json_all",ipp:1e5,comparison12:"equals",value12:"directory"}}),_=n.Z.get({id:"GET_PROTECTABLE_ROOTS",url:"/CMD_SUBDOMAIN",schema:{domain:n.Z.DOMAIN,ipp:9999},response:[],after:(a,E)=>R=>{const D=c.CEd(["info"],R.subdomains),g=`/domains/${E.domain}`,I=Object.values(D).map(x=>x.public_html);return[g,...I]}})},"./js/pages/user/protected-directories/view.vue":function(h,u,o){o.r(u),o.d(u,{default:function(){return m}});var n=function(){var e=this,t=e._self._c;return t("app-page",{attrs:{actions:[{label:e.$gettext("Remove Protection"),icon:"#delete",handler:e.$dialog("REMOVE_PROTECTION_DIALOG").open,theme:"danger"}]},scopedSlots:e._u([{key:"default",fn:function(){return[t("app-page-section",[t("ui-form-element",{scopedSlots:e._u([{key:"title",fn:function(){return[t("span",{domProps:{textContent:e._s(e.$gettext("Path:"))}})]},proxy:!0},{key:"content",fn:function(){return[t("input-text",{attrs:{disabled:"",value:e.path}})]},proxy:!0}])}),e._v(" "),t("ui-form-element",{attrs:{group:"dirName",validators:{required:!0},underline:!1},scopedSlots:e._u([{key:"title",fn:function(){return[t("span",{domProps:{textContent:e._s(e.$gettext("Name:"))}})]},proxy:!0},{key:"content",fn:function(){return[t("input-text",{attrs:{placeholder:e.$gettext("eg. Member's Area")},scopedSlots:e._u([{key:"additions:right",fn:function(){return[t("ui-button",{attrs:{theme:"safe","validate-group":"dirName"},on:{click:e.updateName}},[t("span",{domProps:{textContent:e._s(e.$gettext("Update"))}})])]},proxy:!0}]),model:{value:e.name,callback:function(r){e.name=r},expression:"name"}})]},proxy:!0}])}),e._v(" "),t("ui-api-table",e._b({attrs:{"hide-before-controls":""},on:{"action:del":function(r){e.$dialog("DELETE_ITEMS_DIALOG").open()}},scopedSlots:e._u([{key:"table:after",fn:function(){return[t("ui-grid",{attrs:{main:"end"}},[t("ui-button",{attrs:{icon:"plus-fill",size:"small",theme:"light"},on:{click:function(r){e.$dialog("ADD_USER_DIALOG").open()}}},[t("span",{domProps:{textContent:e._s(e.$gettext("Add User"))}})])],1)]},proxy:!0}]),model:{value:e.select,callback:function(r){e.select=r},expression:"select"}},"ui-api-table",{command:e.$commands.getDirectoryInfo,requestData:{path:e.path},rowID:"username",columns:{username:{label:e.$gettext("Users"),grow:!0}},actions:{del:{label:e.$gettext("Delete")}}},!1))],1),e._v(" "),t("ui-dialog-delete-items",{attrs:{subject:e.$ngettext("user","users",e.select.length)},on:{"click:confirm":e.deleteUsers}}),e._v(" "),t("ui-dialog",{attrs:{id:"ADD_USER_DIALOG",theme:"safe",title:e.$gettext("Add User")},scopedSlots:e._u([{key:"content",fn:function(){return[t("ui-form-element",{attrs:{vertical:"",group:"addProtectedDirUser",validators:{required:!0,validateUsername:e.validateUsername}},scopedSlots:e._u([{key:"title",fn:function(){return[t("span",{domProps:{textContent:e._s(e.$gettext("Username"))}})]},proxy:!0},{key:"content",fn:function(){return[t("input-text",{model:{value:e.user,callback:function(r){e.user=r},expression:"user"}})]},proxy:!0},{key:"error:validateUsername",fn:function(){return[t("span",{domProps:{textContent:e._s(e.$gettext("User already exists"))}})]},proxy:!0}])}),e._v(" "),t("ui-form-element",{attrs:{vertical:"",group:"addProtectedDirUser",validators:{required:!0}},scopedSlots:e._u([{key:"title",fn:function(){return[t("span",{domProps:{textContent:e._s(e.$gettext("Password"))}})]},proxy:!0},{key:"content",fn:function(){return[t("input-password",{attrs:{"show-generator":""},model:{value:e.passwd,callback:function(r){e.passwd=r},expression:"passwd"}})]},proxy:!0}])})]},proxy:!0},{key:"buttons",fn:function(){return[t("ui-button",{attrs:{theme:"safe","validate-group":"addProtectedDirUser"},on:{click:e.addUser}},[t("span",{domProps:{textContent:e._s(e.$gettext("Add"))}})])]},proxy:!0}])}),e._v(" "),t("ui-dialog-confirm",{attrs:{id:"REMOVE_PROTECTION_DIALOG"},on:{"click:confirm":e.disableProtection}},[t("span",{domProps:{textContent:e._s(e.$gettextInterpolate(e.$gettext("Are you sure you want to disable protection for %{path}?"),{path:e.path}))}})])]},proxy:!0}])})},c=[],s=o("./js/pages/user/protected-directories/_commands/index.js"),d={preload:s.m6,api:[{command:s.m6,bind:"info"}],commands:{getDirectoryInfo:s.m6},data:()=>({select:[],name:"",user:"",passwd:""}),computed:{path(){return this.$route.query.path},users(){return this.$api.info.rows.map(i=>i.username)}},created(){this.name=this.$api.info.name},methods:{async deleteUsers(){await(0,s.Vt)({select:this.select,path:this.path}),(0,s.m6)({path:this.path}),Object.assign(this.$data,this.$options.data.apply(this))},async addUser(){await(0,s.cn)({path:this.path,user:this.user,passwd:this.passwd,passwd2:this.passwd,name:this.name}),(0,s.m6)({path:this.path}),Object.assign(this.$data,this.$options.data.apply(this)),this.name=this.$api.info.name},async disableProtection(){await(0,s.fE)({name:this.name,path:this.path})&&this.$router.replace({name:"user/protected-directories"})},updateName(){(0,s.Ee)({name:this.name,path:this.path})},validateUsername(i){return!this.users.includes(i)}}},p=d,f=o("../node_modules/vue-loader/lib/runtime/componentNormalizer.js"),l=(0,f.Z)(p,n,c,!1,null,null,null),m=l.exports}}]);
