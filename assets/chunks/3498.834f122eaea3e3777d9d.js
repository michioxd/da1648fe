"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[3498,3526],{"./js/api/commands/user/email/accounts/index.js":function(R,g,c){c.r(g),c.d(g,{$processors:function(){return y},changeDKIMStatus:function(){return M},changePassword:function(){return u},createAccount:function(){return t},deleteAccounts:function(){return e},getAccounts:function(){return A},getLoginsList:function(){return T},modifyAccount:function(){return o},purgeAccounts:function(){return n},suspendAccounts:function(){return P},unsuspendAccounts:function(){return E},webmailSSO:function(){return O}});var r=c("./js/api/command/index.js"),p=c("../node_modules/monet/dist/monet.js"),I=c.n(p),d=c("./js/api/converters.js");const x=a=>p.Maybe.Some(a).map(Number).filter(Number.isFinite).orSome(1/0),y={sent:a=>p.Maybe.fromNull(a).filter(s=>typeof s=="object").flatMap(({sent:s,send_limit:i})=>{try{return p.Maybe.Some({usage:x(s),limit:x(i)})}catch(m){return p.Maybe.None()}}).orSome(!1),lastChange:a=>p.Maybe.fromNull(a).map(({ip:s,when:i})=>({ip:(0,p.Identity)(s).map(d.toAppString).map(d.toAppText).get(),when:(0,p.Identity)(i).map(d.toAppDate).get()})).orSome(!1)},A=r.Z.get({id:"EMAIL_ACCOUNTS",url:"/CMD_EMAIL_POP",domain:!0,pagination:!0,params:{bytes:!0},after:a=>a.flow(a.wrap("options"),a.moveProp({"options.emails":"emails","options.EMAIL_MESSAGE":"options.email_message"}),a.mapProps({emails:a.toTable(a.mapArray(a.flow(a.moveProp({"usage.last_login":"last_login","usage.last_password_change":"last_password_change"}),a.mapProps({login:s=>s.includes("@")?s.split("@")[0]:s,is_default:(s,{login:i})=>!i.includes("@"),sent:y.sent,usage:a.mapValues(x),last_login:y.lastChange,last_password_change:y.lastChange})))),options:a.mapProps({DKIM:a.isEqual("1"),DKIM_ENABLED:a.isEqual("1"),block_cracking_unblock:a.convert.toAppNumber,clean_forwarders_on_email_delete:a.isEqual("1"),count_pop_usage:a.isEqual("1"),pop_disk_usage_cache:a.isEqual("1"),pop_disk_usage_true_bytes:a.isEqual("1"),user_can_set_email_limit:a.isEqual("1"),purge_select:a.toSelect,when_select:a.toSelect,HAVE_ONE_CLICK_WEBMAIL_LOGIN:a.convert.toAppBoolean,system_user_to_virtual_passwd:a.isEqual("1")})}))}),v=r.Z.post({url:"/CMD_EMAIL_POP",params:{action:"delete"},domain:!0}),P=v.extend({params:{suspend:!0}}),E=v.extend({params:{unsuspend:!0}}),e=v.extend({params:{delete:!0},schema:{clean_forwarders:r.Z.REQUIRED_BOOL}}),n=v.extend({params:{purge:!0},body:{file:r.Z.REQUIRED_STRING,what:r.Z.REQUIRED_STRING}}),t=r.Z.post({url:"/CMD_EMAIL_POP",params:{action:"create"},domain:!0,schema:{user:r.Z.USER,passwd2:r.Z.PASSWORD,passwd:r.Z.PASSWORD,quota:r.Z.REQUIRED_STRING,limit:r.Z.OPTIONAL_STRING},after:a=>a.mapProp("result",s=>s.replace(/(\\n)+/g,`
`))}),o=r.Z.post({url:"/CMD_EMAIL_POP",params:{action:"modify"},domain:!0,schema:{user:r.Z.USER,newuser:r.Z.USER,passwd2:r.Z.OPTIONAL_STRING,passwd:r.Z.OPTIONAL_STRING,quota:r.Z.REQUIRED_STRING,limit:r.Z.OPTIONAL_STRING}}),u=r.Z.post({url:"/CMD_CHANGE_EMAIL_PASSWORD",schema:{email:r.Z.REQUIRED_STRING,oldpassword:r.Z.REQUIRED_STRING,password1:r.Z.REQUIRED_STRING,password2:r.Z.REQUIRED_STRING}}),M=r.Z.post({url:"/CMD_EMAIL_POP",domain:!0,schema:{action:r.Z.REQUIRED_STRING},before:({action:a})=>({action:"set_dkim",[a]:!0})}),O=r.Z.post({url:"/CMD_WEBMAIL_LOGIN",notifySuccess:!1,schema:{email:r.Z.REQUIRED_STRING}}),T=r.Z.get({id:"LOGINS_LIST",url:"/CMD_EMAIL_POP",domain:!0,response:[],params:{quick:!0},mapResponse:a=>a.emails})},"./js/api/endpoint/index.ts":function(R,g,c){c.d(g,{RA:function(){return a},yY:function(){return O},HT:function(){return t},a4:function(){return o},MA:function(){return e}});var r=c("./js/api/endpoint/request.ts"),p=c("../node_modules/vue/dist/vue.common.prod.js");const I=(s,i)=>{const m=(0,p.reactive)({data:s,params:i,state:{isLoading:!1,isOk:!0,isError:!1,error:null}});return{store:m,setData:l=>{m.data=l},setParams:l=>{m.params=l},setState:l=>{m.state=Object.assign({},{isLoading:!1,isOk:!1,isError:!1,error:null},l)}}};var d=c("../node_modules/ramda/es/index.js"),x=c("./js/context/index.ts");const y=(s,i)=>{if(s.includes(":")){const m=/:[a-z]*/g,f=[];return{url:s.replace(m,_=>{if(_===":domain"&&!i.domain)return x.T.session.domain;_=_.slice(1);const l=i[_].toString();if(typeof l=="undefined")throw new Error(`EndpointParamError: ${_} is not defined`);return f.push(_),l}),urlParams:f}}return{url:s,urlParams:[]}},A=(s,i,m={})=>{const{store:f,setData:S,setState:_,setParams:l}=I(m.data||{},{});return{store:f,setData:S,request:async N=>{const C={method:s,url:i,params:N||{},options:m};if(!(N instanceof FormData)){const w=d.D95(D=>typeof D=="string"||typeof D=="number",C.params),U=y(i,w);C.url=U.url,N&&(C.params=d.CEd(U.urlParams,C.params))}l(N||{}),_({isLoading:!0,isError:!1,error:null,isOk:!0});const k=await(0,r.W)(C);return k.state==="success"&&s==="get"&&S(k.data),_({isLoading:!1}),k.state==="error"&&_({error:k,isError:!0,isOk:!1}),k}}},v=(s,i,m={})=>{const{store:f,setData:S,request:_}=A(s,i,m);return Object.freeze({get data(){return d.d9v(f.data)},set data(l){S(l)},get params(){return d.d9v(f.params)},get state(){return d.d9v(f.state)},request:_,bindData(l){return function(){return l?l(f.data):f.data}}})},P=(s,i,m={})=>{const{store:f,request:S}=A(s,i,m);return Object.freeze({get params(){return d.d9v(f.params)},get state(){return d.d9v(f.state)},request:S})},E=(s,i)=>(s.notify(),i(!1)),e=(s,i=E)=>async(m,f,S)=>{const l=(await Promise.all(s.map(h=>h(m,f)))).find(h=>h.state==="error");if(typeof l!="undefined"){const{error:h}=l;return i(h,S)}S()};var n=c("./js/gettext.js");const t=(s,i)=>v("get",s,i),o=(s,i)=>P("post",s,i),u=(s,i)=>createMutation("put",s,i),M=(s,i)=>createMutation("patch",s,i),O=(s,i)=>P("delete",s,i),T=null,a=n.$gettext},"./js/endpoints/imapsync/index.ts":function(R,g,c){c.d(g,{Vv:function(){return I},gi:function(){return x},pv:function(){return d},uW:function(){return y}});var r=c("./js/api/endpoint/index.ts");const p={IMAPSYNC_AUTHENTICATION_FAILURE:(0,r.RA)("ImapSync authentication failure"),IMAPSYNC_CONNECTION_FAILURE:(0,r.RA)("ImapSync connection failure"),IMAPSYNC_CONNECTION_FAILURE_HOST_SRC:(0,r.RA)("ImapSync host source connection failure"),IMAPSYNC_CONNECTION_FAILURE_HOST_DST:(0,r.RA)("ImapSync host destination connection failure"),IMAPSYNC_AUTHENTICATION_FAILURE_USER_SRC:(0,r.RA)("ImapSync user source authentication failure"),IMAPSYNC_AUTHENTICATION_FAILURE_USER_DST:(0,r.RA)("ImapSync user destination authentication failure"),IMAPSYNC_MIGRATION_LIMIT_ERROR:(0,r.RA)("Destination email is currently being used for migration by another process")},I=(0,r.HT)("/imapsync/migrations"),d=(0,r.yY)("/imapsync/migrations/:id",{errorMessages:{IMAPSYNC_PROCESS_NOT_FOUND:(0,r.RA)("ImapSync process not found")}}),x=(0,r.a4)("/imapsync/import",{errorMessages:p}),y=(0,r.a4)("/imapsync/export",{errorMessages:p})},"./js/pages/user/imapsync/export.vue":function(R,g,c){c.r(g),c.d(g,{default:function(){return P}});var r=function(){var e=this,n=e._self._c;return n("app-page",{scopedSlots:e._u([{key:"default",fn:function(){return[n("app-page-section",{scopedSlots:e._u([{key:"section:title",fn:function(){return[n("span",{domProps:{textContent:e._s(e.$gettext("Source"))}})]},proxy:!0}])},[e._v(" "),n("ui-form-element",{attrs:{group:"imapsync",validators:{required:!0},disabled:e.loading},scopedSlots:e._u([{key:"title",fn:function(){return[n("span",{domProps:{textContent:e._s(e.$gettext("User"))}})]},proxy:!0},{key:"content",fn:function(){return[n("input-select",{attrs:{options:e.emailAccounts},scopedSlots:e._u([{key:"additions:right",fn:function(){return[n("ui-button",{attrs:{theme:"light",disabled:""}},[e.loading?n("ui-loader-icon",{attrs:{size:20}}):[e._v(`
                                    @`+e._s(e.$domainUnicode)+`
                                `)]],2)]},proxy:!0}]),model:{value:e.to.account,callback:function(t){e.$set(e.to,"account",t)},expression:"to.account"}})]},proxy:!0}])}),e._v(" "),e.hasSso?n("ui-form-element",{attrs:{underline:!1},scopedSlots:e._u([{key:"title",fn:function(){return[n("span",{domProps:{textContent:e._s(e.$gettext("Authentication"))}})]},proxy:!0},{key:"content",fn:function(){return[n("input-radio-group",{attrs:{options:[{id:"sso",value:!0,label:e.$gettext("Internal sign-in")},{id:"password",value:!1,label:e.$gettext("Password")}]},model:{value:e.to.sso,callback:function(t){e.$set(e.to,"sso",t)},expression:"to.sso"}})]},proxy:!0}],null,!1,2826576943)}):e._e(),e._v(" "),e.to.sso===!1||e.hasSso===!1?n("ui-form-element",{attrs:{underline:!1,group:"imapsync",validators:{validatePassword:e.validatePassword,response:e.validateSrcUser}},scopedSlots:e._u([{key:"title",fn:function(){return[e.hasSso?n("span"):n("span",{domProps:{textContent:e._s(e.$gettext("Password"))}})]},proxy:!0},{key:"content",fn:function(){return[n("input-password",{attrs:{disabled:e.to.sso},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.imapsync.apply(null,arguments)}},model:{value:e.to.password,callback:function(t){e.$set(e.to,"password",t)},expression:"to.password"}})]},proxy:!0},{key:"error:response",fn:function(){return[n("span",{domProps:{textContent:e._s(e.$gettext("User authentication failure"))}})]},proxy:!0},{key:"error:validatePassword",fn:function(){return[n("span",{domProps:{textContent:e._s(e.$gettext("Required field"))}})]},proxy:!0}],null,!1,509818590)}):e._e()],1),e._v(" "),n("app-page-section",{scopedSlots:e._u([{key:"section:title",fn:function(){return[n("span",{domProps:{textContent:e._s(e.$gettext("Destination"))}})]},proxy:!0}])},[e._v(" "),n("ui-form-element",{attrs:{group:"imapsync",validators:{required:!0,domain:!0,response:e.validateDstHost}},scopedSlots:e._u([{key:"title",fn:function(){return[n("span",{domProps:{textContent:e._s(e.$gettext("Host"))}})]},proxy:!0},{key:"content",fn:function(){return[n("input-text",{on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.imapsync.apply(null,arguments)}},model:{value:e.from.server,callback:function(t){e.$set(e.from,"server",t)},expression:"from.server"}})]},proxy:!0},{key:"error:response",fn:function(){return[n("span",{domProps:{textContent:e._s(e.$gettext("Host connection failure"))}})]},proxy:!0}])}),e._v(" "),n("ui-form-element",{attrs:{group:"imapsync",validators:{required:!0,response:e.validateDstUser}},scopedSlots:e._u([{key:"title",fn:function(){return[n("span",{domProps:{textContent:e._s(e.$gettext("User"))}})]},proxy:!0},{key:"content",fn:function(){return[n("input-text",{on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.imapsync.apply(null,arguments)}},model:{value:e.from.username,callback:function(t){e.$set(e.from,"username",t)},expression:"from.username"}})]},proxy:!0},{key:"error:response",fn:function(){return[n("span",{domProps:{textContent:e._s(e.$gettext("User authentication failure"))}})]},proxy:!0}])}),e._v(" "),n("ui-form-element",{attrs:{group:"imapsync",validators:{required:!0,response:e.validateDstUser},underline:!1},scopedSlots:e._u([{key:"title",fn:function(){return[n("span",{domProps:{textContent:e._s(e.$gettext("Password"))}})]},proxy:!0},{key:"content",fn:function(){return[n("input-password",{on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.imapsync.apply(null,arguments)}},model:{value:e.from.password,callback:function(t){e.$set(e.from,"password",t)},expression:"from.password"}})]},proxy:!0},{key:"error:response",fn:function(){return[n("span",{domProps:{textContent:e._s(e.$gettext("User authentication failure"))}})]},proxy:!0}])})],1)]},proxy:!0},{key:"footer:buttons",fn:function(){return[n("ui-button",{directives:[{name:"margin",rawName:"v-margin:left",value:1,expression:"1",arg:"left"}],attrs:{theme:"primary","validate-group":"imapsync"},on:{click:e.createMigration}},[n("span",{domProps:{textContent:e._s(e.$gettext("Start migration"))}})])]},proxy:!0}])})},p=[],I=c("./js/endpoints/imapsync/index.ts"),d=c("./js/pages/user/imapsync/import.vue"),x={name:"UserImapsyncExport",extends:d.default,methods:{async createMigration(){const{error:E}=await I.uW.request({to:{...this.from},from:{...this.to,domain:this.$domain}});E?(E.notify(),this.forceValidation(E.type)):(this.$notifications.success({title:this.$gettext("IMAPSync Manager"),content:this.$gettext("Migration started")}),this.$router.push("/user/imapsync"))}}},y=x,A=c("../node_modules/vue-loader/lib/runtime/componentNormalizer.js"),v=(0,A.Z)(y,r,p,!1,null,null,null),P=v.exports},"./js/pages/user/imapsync/import.vue":function(R,g,c){c.r(g),c.d(g,{default:function(){return e}});var r=function(){var t=this,o=t._self._c;return o("app-page",{scopedSlots:t._u([{key:"default",fn:function(){return[o("app-page-section",{scopedSlots:t._u([{key:"section:title",fn:function(){return[o("span",{domProps:{textContent:t._s(t.$gettext("Source"))}})]},proxy:!0}])},[t._v(" "),o("ui-form-element",{attrs:{group:"imapsync",validators:{required:!0,domain:!0,response:t.validateSrcHost}},scopedSlots:t._u([{key:"title",fn:function(){return[o("span",{domProps:{textContent:t._s(t.$gettext("Host"))}})]},proxy:!0},{key:"content",fn:function(){return[o("input-text",{on:{keyup:function(u){return!u.type.indexOf("key")&&t._k(u.keyCode,"enter",13,u.key,"Enter")?null:t.imapsync.apply(null,arguments)}},model:{value:t.from.server,callback:function(u){t.$set(t.from,"server",u)},expression:"from.server"}})]},proxy:!0},{key:"error:response",fn:function(){return[o("span",{domProps:{textContent:t._s(t.$gettext("Host connection failure"))}})]},proxy:!0}])}),t._v(" "),o("ui-form-element",{attrs:{group:"imapsync",validators:{required:!0,response:t.validateSrcUser}},scopedSlots:t._u([{key:"title",fn:function(){return[o("span",{domProps:{textContent:t._s(t.$gettext("User"))}})]},proxy:!0},{key:"content",fn:function(){return[o("input-text",{on:{keyup:function(u){return!u.type.indexOf("key")&&t._k(u.keyCode,"enter",13,u.key,"Enter")?null:t.imapsync.apply(null,arguments)}},model:{value:t.from.username,callback:function(u){t.$set(t.from,"username",u)},expression:"from.username"}})]},proxy:!0},{key:"error:response",fn:function(){return[o("span",{domProps:{textContent:t._s(t.$gettext("User authentication failure"))}})]},proxy:!0}])}),t._v(" "),o("ui-form-element",{attrs:{group:"imapsync",validators:{required:!0,response:t.validateSrcUser},underline:!1},scopedSlots:t._u([{key:"title",fn:function(){return[o("span",{domProps:{textContent:t._s(t.$gettext("Password"))}})]},proxy:!0},{key:"content",fn:function(){return[o("input-password",{on:{keyup:function(u){return!u.type.indexOf("key")&&t._k(u.keyCode,"enter",13,u.key,"Enter")?null:t.imapsync.apply(null,arguments)}},model:{value:t.from.password,callback:function(u){t.$set(t.from,"password",u)},expression:"from.password"}})]},proxy:!0},{key:"error:response",fn:function(){return[o("span",{domProps:{textContent:t._s(t.$gettext("User authentication failure"))}})]},proxy:!0}])})],1),t._v(" "),o("app-page-section",{scopedSlots:t._u([{key:"section:title",fn:function(){return[o("span",{domProps:{textContent:t._s(t.$gettext("Destination"))}})]},proxy:!0}])},[t._v(" "),o("ui-form-element",{attrs:{group:"imapsync",validators:{required:!0},disabled:t.loading},scopedSlots:t._u([{key:"title",fn:function(){return[o("span",{domProps:{textContent:t._s(t.$gettext("User"))}})]},proxy:!0},{key:"content",fn:function(){return[o("input-select",{attrs:{options:t.emailAccounts},scopedSlots:t._u([{key:"additions:right",fn:function(){return[o("ui-button",{attrs:{theme:"light",disabled:""}},[t.loading?o("ui-loader-icon",{attrs:{size:20}}):[t._v(`
                                    @`+t._s(t.$domainUnicode)+`
                                `)]],2)]},proxy:!0}]),model:{value:t.to.account,callback:function(u){t.$set(t.to,"account",u)},expression:"to.account"}})]},proxy:!0}])}),t._v(" "),t.hasSso?o("ui-form-element",{attrs:{underline:!1},scopedSlots:t._u([{key:"title",fn:function(){return[o("span",{domProps:{textContent:t._s(t.$gettext("Authentication"))}})]},proxy:!0},{key:"content",fn:function(){return[o("input-radio-group",{attrs:{options:[{id:"sso",value:!0,label:t.$gettext("Internal sign-in")},{id:"password",value:!1,label:t.$gettext("Password")}]},model:{value:t.to.sso,callback:function(u){t.$set(t.to,"sso",u)},expression:"to.sso"}})]},proxy:!0}],null,!1,2826576943)}):t._e(),t._v(" "),t.to.sso===!1||t.hasSso===!1?o("ui-form-element",{attrs:{underline:!1,group:"imapsync",validators:{validatePassword:t.validatePassword,userdst:t.validateDstUser}},scopedSlots:t._u([{key:"title",fn:function(){return[t.hasSso?o("span"):o("span",{domProps:{textContent:t._s(t.$gettext("Password"))}})]},proxy:!0},{key:"content",fn:function(){return[o("input-password",{attrs:{disabled:t.to.sso===!0&&t.hasSso},on:{keyup:function(u){return!u.type.indexOf("key")&&t._k(u.keyCode,"enter",13,u.key,"Enter")?null:t.imapsync.apply(null,arguments)}},model:{value:t.to.password,callback:function(u){t.$set(t.to,"password",u)},expression:"to.password"}})]},proxy:!0},{key:"error:validatePassword",fn:function(){return[o("span",{domProps:{textContent:t._s(t.$gettext("Required field"))}})]},proxy:!0},{key:"error:userdst",fn:function(){return[o("span",{domProps:{textContent:t._s(t.$gettext("User authentication failure"))}})]},proxy:!0}],null,!1,2903854065)}):t._e()],1)]},proxy:!0},{key:"footer:buttons",fn:function(){return[o("ui-button",{directives:[{name:"margin",rawName:"v-margin:left",value:1,expression:"1",arg:"left"}],attrs:{theme:"primary","validate-group":"imapsync"},on:{click:t.createMigration}},[o("span",{domProps:{textContent:t._s(t.$gettext("Start migration"))}})])]},proxy:!0}])})},p=[],I=c("./js/api/commands/user/email/accounts/index.js"),d=c("./js/endpoints/imapsync/index.ts"),x=c("./js/stores/index.ts");const y=n=>function(){return this.validationError!==n};var A={name:"UserImapsyncImport",api:[{command:I.getAccounts,bind:"getAccounts"}],data:()=>({loading:!1,from:{server:"",username:"",password:""},to:{sso:!1,password:"",account:""},validationError:""}),computed:{emailAccounts(){var n;return this.loading?[]:(((n=this.$api.getAccounts.emails)==null?void 0:n.rows)||[]).map(t=>t.login)},hasSso(){var n;return((n=this.$api.getAccounts.options)==null?void 0:n.HAVE_ONE_CLICK_WEBMAIL_LOGIN)||!1}},watch:{$domain:{handler:"loadAccounts",immediate:!0},to:{handler:"clearValidation",deep:!0},from:{handler:"clearValidation",deep:!0}},methods:{validateSrcHost:y("IMAPSYNC_CONNECTION_FAILURE_HOST_SRC"),validateDstHost:y("IMAPSYNC_CONNECTION_FAILURE_HOST_DST"),validateSrcUser:y("IMAPSYNC_AUTHENTICATION_FAILURE_USER_SRC"),validateDstUser:y("IMAPSYNC_AUTHENTICATION_FAILURE_USER_DST"),validatePassword(n){return this.to.sso?!0:n!==""},forceValidation(n){this.validationError=n,(0,x.oR)(PiniaStores.VALIDATION).revalidateGroup("imapsync")},clearValidation(){this.validationError="",(0,x.oR)(PiniaStores.VALIDATION).revalidateGroup("imapsync")},async loadAccounts(n){this.loading=!0,this.to.account="",await(0,I.getAccounts)({domain:n}),this.$nextTick(()=>{this.to.sso=this.hasSso,this.loading=!1})},async createMigration(){const{error:n}=await d.gi.request({from:{...this.from},to:{...this.to,domain:this.$domain}});n?(n.notify(),this.forceValidation(n.type)):(this.$notifications.success({title:this.$gettext("IMAPSync Manager"),content:this.$gettext("Migration started")}),this.$router.push("/user/imapsync"))}}},v=A,P=c("../node_modules/vue-loader/lib/runtime/componentNormalizer.js"),E=(0,P.Z)(v,r,p,!1,null,null,null),e=E.exports}}]);
