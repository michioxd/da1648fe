(self.webpackChunk=self.webpackChunk||[]).push([[7023],{"../node_modules/mini-css-extract-plugin/dist/loader.js??clonedRuleSet-13.use[1]!../node_modules/css-loader/dist/cjs.js??clonedRuleSet-13.use[2]!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/postcss-loader/dist/cjs.js??clonedRuleSet-13.use[3]!../node_modules/sass-loader/dist/cjs.js??clonedRuleSet-13.use[4]!../node_modules/vue-loader/lib/index.js??vue-loader-options!../node_modules/unplugin/dist/webpack/loaders/transform.js?unpluginName=unplugin-vue-define-options!./js/pages/user/plugins/_host/legacy-host.vue?vue&type=style&index=0&id=7e9938db&prod&lang=scss&":function(){},"./js/pages/user/plugins/index.vue":function(c,m,o){"use strict";o.r(m),o.d(m,{default:function(){return ge}});var i=function(){var e=this,n=e._self._c;return n("div",{staticClass:"plugin-host"},[n(e.host,{tag:"component",attrs:{"plugin-definition":e.pluginDefinition}})],1)},_=[],g=o("../node_modules/ramda/es/index.js"),h=o("./js/vue-globals/helpers.js"),r=o("./js/api/commands/plugins.js"),v=function(){var e=this,n=e._self._c;return n("div",{directives:[{name:"flex-item",rawName:"v-flex-item",value:{grow:!0},expression:"{ grow: true }"}],staticClass:"plugin-legacy-host",class:{maximized:e.maximized}},[n("div",{directives:[{name:"show",rawName:"v-show",value:!e.loading,expression:"!loading"}],attrs:{id:"plugin-host"}},[n("div",{attrs:{id:"plugin-host-header"}},[n("h1",{domProps:{textContent:e._s(e.name)}}),e._v(" "),n("ui-button",{attrs:{id:"maximizeToggle",size:"normal",theme:"safe",icon:e.maximized?"minimize":"maximize"},on:{click:function(s){e.maximized=!e.maximized}}},[n("span",{domProps:{textContent:e._s(e.maximized?e.$gettext("Minimize"):e.$gettext("Maximize"))}})])],1),e._v(" "),n("plugins-iframe",{directives:[{name:"show",rawName:"v-show",value:!e.loading,expression:"!loading"}],key:e.iframeKey,attrs:{src:e.path,domain:e.domainDependent},on:{loadEnd:function(s){e.loading=!1},"update:state":e.updateState}})],1),e._v(" "),e.loading?n("loading-component",{attrs:{name:e.name}}):e._e()],1)},y=[],x=function(){var e=this,n=e._self._c;return n("div",{attrs:{id:"iframe-container"}},[n("iframe",e._b({directives:[{name:"flex-item",rawName:"v-flex-item",value:{grow:!0},expression:"{ grow: true }"}],ref:"iframe",style:{minHeight:`${e.height}px`,minWidth:"100%"},on:{load:e.onLoad}},"iframe",{src:e.iframeSrc,width:e.width?`${e.width}px`:"100%",frameborder:"0"},!1)),e._v(" "),n("transition",{attrs:{name:"fade"}},[e.blocked?n("div",{staticClass:"iframe-overlay"}):e._e()])],1)},j=[],d=o("../node_modules/monet/dist/monet.js"),l=o("./js/modules/urlParser/index.ts");const S={display:"flex","justify-content":"center","align-items":"flex-start",margin:"0",padding:"0"},b={display:"inline-block","max-width":"100vw",overflow:"auto"};var $={props:{src:{type:String,required:!0,default:""},domain:{type:Boolean,required:!1,default:!1}},data:()=>({leaveUntouched:!1,blocked:!0,height:400,width:0}),computed:{iframeSrc(){const t=this.src.replace(/(\/|#)*$/g,"");return this.appendQuery(t)},iframe(){return this.$refs.iframe||null}},mounted(){this.height=window.document.querySelector(".route-container").offsetHeight;const t=e=>{if(e.contentDocument.readyState!=="complete")setTimeout(()=>t(e),200);else{const n=e.contentDocument.querySelector("iframe");n?t(n):setTimeout(this.updateDimensions.bind(this),200)}};t(this.iframe)},methods:{removeIframeParam:(0,l.tk)("iframe"),getDocument(){return d.Maybe.Some(this.$refs).flatMap(t=>d.Maybe.fromNull(t.iframe)).flatMap(t=>d.Maybe.fromNull(t.contentDocument))},getBody(){return this.getDocument().map(t=>t.body)},getClearSrc(){return this.getDocument().map(t=>t.location.href).map((0,l.tk)("iframe")).some()},getContainer(){return this.getDocument().map(t=>t.querySelector("#iframe-container"))},appendQuery(t){return t=(0,l.Us)(t,"iframe","yes"),this.domain&&(t=(0,l.Us)(t,"domain",this.$domain)),t},querySelectorAll(...t){return this.getDocument().map(e=>e.querySelectorAll(...t))},querySelector(...t){return this.getDocument().map(e=>e.querySelector(...t))},centerContent(){const t=(e,n)=>{const s=e.some();Object.entries(n).forEach(([p,fe])=>{s.style[p]=fe})};t(this.getBody(),S),t(this.getContainer(),b)},setTarget(t){const e=this.querySelector("base").orSome(null);e&&(e.target=t)},appendLinkHref(t){if(t){const e=t.getAttribute("href");if(e&&e.includes("PLUGINS")){const n=this.appendQuery(t.href);t.setAttribute("href",n)}}},appendScriptSrc(t){t&&t.src&&t.src.includes("PLUGINS")&&(t.src=this.appendQuery(t.src))},appendFormAction(t){if(!t)return;const e=t.getAttribute("action");e&&!e.includes("iframe=yes")&&t.setAttribute("action",this.appendQuery(e))},processTag(t,e){const n=this.querySelectorAll(t).orSome();g.Ed_(e,n)},appendLocationQuery(t){t.href=this.appendQuery(t.href)},checkDestination(){return this.getDocument().flatMap(t=>d.Maybe.fromNull(t.location)).filter(t=>!t.search.includes("iframe=yes")).cata(()=>({}),this.appendLocationQuery),!0},onUnload(){this.$emit("loadStart"),this.blocked=!0,this.leaveUntouched||setTimeout(this.checkDestination,0),this.leaveUntouched=!1},onLoad(){this.$emit("loadEnd"),this.blocked=!1,this.iframe&&(this.iframe.contentWindow.onunload=this.onUnload),this.setTarget("_self"),this.processTag("a",this.appendLinkHref),this.processTag("form",this.appendFormAction),this.getClearSrc!==window.location.href&&this.pushState(),this.centerContent(),this.updateDimensions(),this.setupObserver()},pushState(){const t=this.getClearSrc();this.$emit("update:state",t)},updateDimensions(){const t=e=>this.getBody().map(n=>n.querySelectorAll("*")).map(n=>[...n]).map(n=>n.map(s=>s[e])).map(n=>n.filter(s=>!!s)).map(n=>Math.max(...n)).orSome(0);this.height=t("offsetHeight"),this.width=t("offsetWidth")},setupObserver(){const t=this.getBody().some();this.observer=new MutationObserver(this.updateDimensions),this.observer.observe(t,{attributes:!0,childList:!0,characterData:!0,subtree:!0});const e=t.querySelector("iframe");if(e){const n=window.document.querySelector(".route-container").offsetHeight;e.style.minHeight=`${n}px`}}}},C=$,a=o("../node_modules/vue-loader/lib/runtime/componentNormalizer.js"),P=(0,a.Z)(C,x,j,!1,null,null,null),D=P.exports,L=function(){var e=this,n=e._self._c,s=e._self._setupProxy;return n("app-page",{scopedSlots:e._u([{key:"page:title",fn:function(){return[n("span",{domProps:{textContent:e._s(e.name)}})]},proxy:!0},{key:"default",fn:function(){return[n("app-page-section",[n("ui-center",{attrs:{height:"10rem"}},[n("ui-loader-icon")],1)],1)]},proxy:!0}])})},w=[],u=o("../node_modules/vue/dist/vue.common.prod.js"),I=(0,u.defineComponent)({__name:"loading",props:{name:null},setup(t){return{__sfc:!0}}}),R=I,N=(0,a.Z)(R,L,w,!1,null,null,null),f=N.exports,E={components:{PluginsIframe:D,LoadingComponent:f},props:{pluginDefinition:{type:Object,required:!1,default:()=>({})}},data:()=>({loading:!0,maximized:!1}),computed:{id(){return this.$route.params.id},level(){return this.$route.params.level},command(){return{user:"/CMD_PLUGINS",reseller:"/CMD_PLUGINS_RESELLER",admin:"/CMD_PLUGINS_ADMIN"}[this.level]},path(){let{path:t}=this.$route.query;return t&&t.startsWith("/")&&(t=t.slice(1)),t?`${this.command}/${this.id}/${t}`:`${this.command}/${this.id}`},iframeKey(){return this.domainDependent?`${this.id}-${this.$domain}`:this.id},domainDependent(){return Boolean(this.pluginDefinition&&this.pluginDefinition.href&&this.pluginDefinition.href.includes("|DOMAIN|"))},name(){return this.$gettext(this.pluginDefinition.name)}},methods:{updateState(t){let n=(0,l.Lk)(t).path.replace(`${window.location.protocol}//${window.location.host}${this.command}/${this.id}`,"");n.startsWith("/")&&(n=n.slice(1));const s=`/${this.level}/plugins/${this.id}`,p=n?`${s}?path=${n}`:s;window.history.pushState(p,"",p)}}},M=E,he=o("../node_modules/vue-style-loader/index.js!../node_modules/mini-css-extract-plugin/dist/loader.js??clonedRuleSet-13.use[1]!../node_modules/css-loader/dist/cjs.js??clonedRuleSet-13.use[2]!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/postcss-loader/dist/cjs.js??clonedRuleSet-13.use[3]!../node_modules/sass-loader/dist/cjs.js??clonedRuleSet-13.use[4]!../node_modules/vue-loader/lib/index.js??vue-loader-options!../node_modules/unplugin/dist/webpack/loaders/transform.js?unpluginName=unplugin-vue-define-options!./js/pages/user/plugins/_host/legacy-host.vue?vue&type=style&index=0&id=7e9938db&prod&lang=scss&"),U=(0,a.Z)(M,v,y,!1,null,null,null),k=U.exports,z=function(){var e=this,n=e._self._c;return n("div",[n(e.pluginComponent,e._b({key:`${e.id}-${e.lang}`,tag:"component",on:{click:e.reload}},"component",e.pluginDefinition,!1))],1)},A=[],B=o("../node_modules/axios/index.js"),T=o.n(B),F=function(){var e=this,n=e._self._c,s=e._self._setupProxy;return n("app-page",{scopedSlots:e._u([{key:"page:title",fn:function(){return[n("span",{domProps:{textContent:e._s(e.name)}})]},proxy:!0},{key:"default",fn:function(){return[n("app-page-section",[n("span",{staticClass:"txt:bold",domProps:{textContent:e._s(e.$gettextInterpolate(e.$gettext("Error loading %{ id } plugin."),{id:e.id}))}})])]},proxy:!0},{key:"footer:buttons",fn:function(){return[n("ui-button",e._g({attrs:{theme:"safe",icon:"circles-loader",size:"big"}},s.listeners),[n("span",{domProps:{textContent:e._s(e.$gettext("Try Again"))}})])]},proxy:!0}])})},H=[],G=(0,u.defineComponent)({__name:"ErrorLoading",props:{id:null,name:null},setup(t){return{__sfc:!0,listeners:(0,u.useListeners)()}}}),O=G,Z=(0,a.Z)(O,F,H,!1,null,null,null),Q=Z.exports,q=function(){var e=this,n=e._self._c,s=e._self._setupProxy;return n("app-page",{scopedSlots:e._u([{key:"page:title",fn:function(){return[n("span",{domProps:{textContent:e._s(e.name)}})]},proxy:!0},{key:"default",fn:function(){return[n("app-page-section",[n("span",{staticClass:"txt:bold",domProps:{textContent:e._s(e.$gettextInterpolate(e.$gettext("Error loading %{ id } plugin: loaded bundle does not export valid Vue component."),{id:e.id}))}})])]},proxy:!0}])})},W=[],Y=(0,u.defineComponent)({__name:"InvalidPluginComponent",props:{id:null,name:null},setup(t){return{__sfc:!0}}}),K=Y,V=(0,a.Z)(K,q,W,!1,null,null,null),J=V.exports,X=function(){var e=this,n=e._self._c,s=e._self._setupProxy;return n("app-page",{scopedSlots:e._u([{key:"page:title",fn:function(){return[n("span",{domProps:{textContent:e._s(e.name)}})]},proxy:!0},{key:"default",fn:function(){return[n("app-page-section",[n("span",{staticClass:"txt:bold",domProps:{textContent:e._s(e.$gettextInterpolate(e.$gettext("Error loading %{ id } plugin: loaded bundle is not ES6 Module."),{id:e.id}))}})])]},proxy:!0}])})},ee=[],te=(0,u.defineComponent)({__name:"InvalidPluginBundle",props:{id:null,name:null},setup(t){return{__sfc:!0}}}),ne=te,se=(0,a.Z)(ne,X,ee,!1,null,null,null),oe=se.exports;const ie=async t=>{try{const{data:e}=await T().get(t),n=new Function(`return ${e}`)();return n.__esModule?typeof n.default=="object"&&typeof n.default.render=="function"?n.default:J:oe}catch(e){return console.error(e),Q}};var re=o("./js/stores/index.ts"),ae={props:{pluginDefinition:{type:Object,required:!0,default:()=>({})}},data:()=>({pluginComponent:f,lang:""}),api:[{command:r.u,bind:"languages"}],computed:{id(){return this.$route.params.id},level(){return this.$route.params.level},componentUrl(){return this.pluginDefinition.type&&/\/vue\/(user|reseller|admin).js/.test(this.pluginDefinition.componentUrl)?[{user:"/CMD_PLUGINS",reseller:"/CMD_PLUGINS_RESELLER",admin:"/CMD_PLUGINS_ADMIN"}[this.level],`${this.pluginDefinition.dir}${this.pluginDefinition.componentUrl}`].join("/"):this.pluginDefinition.componentUrl||""}},watch:{componentUrl:{handler:"reload",immediate:!0},"$language.current":"loadLanguage"},methods:{async reload(){this.pluginComponent=await ie(this.componentUrl),await(0,r.u)({plugin:this.id}),this.loadLanguage(this.$language.current)},async loadLanguage(t){if(this.$api.languages.includes(t)){const e=await(0,r.dX)({plugin:this.id,lang:t});(0,re.oR)(PiniaStores.LANG).injectTranslation(t,e)}this.lang=t}}},le=ae,ue=(0,a.Z)(le,z,A,!1,null,null,null),de=ue.exports;const pe=t=>({admin:r.$M,reseller:r.s6,user:r.wz})[t]();var ce={components:{LegacyHost:k,VueHost:de},preload:async({level:t})=>{await pe(t)},props:{id:{type:String,required:!0},level:{type:String,required:!0}},data:()=>({lang:""}),api:[{command:r.u,bind:"languages"}],computed:{pluginDefinition(){const e={user:r.wz,reseller:r.s6,admin:r.$M}[this.level].data.response;return g.sEJ(({id:n,dir:s})=>[n.toLowerCase(),s.toLowerCase()].includes(this.id.toLowerCase()),e)},host(){return`${this.pluginDefinition.type}-host`}},mounted(){h.uY.on("navidation:update-notification-count",this.updateNotificationCount)},methods:{updateNotificationCount(){this.$_useStore("navigation").loadUpdate(this.level,this.id)}}},me=ce,_e=(0,a.Z)(me,i,_,!1,null,null,null),ge=_e.exports},"../node_modules/vue-style-loader/index.js!../node_modules/mini-css-extract-plugin/dist/loader.js??clonedRuleSet-13.use[1]!../node_modules/css-loader/dist/cjs.js??clonedRuleSet-13.use[2]!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/postcss-loader/dist/cjs.js??clonedRuleSet-13.use[3]!../node_modules/sass-loader/dist/cjs.js??clonedRuleSet-13.use[4]!../node_modules/vue-loader/lib/index.js??vue-loader-options!../node_modules/unplugin/dist/webpack/loaders/transform.js?unpluginName=unplugin-vue-define-options!./js/pages/user/plugins/_host/legacy-host.vue?vue&type=style&index=0&id=7e9938db&prod&lang=scss&":function(c,m,o){var i=o("../node_modules/mini-css-extract-plugin/dist/loader.js??clonedRuleSet-13.use[1]!../node_modules/css-loader/dist/cjs.js??clonedRuleSet-13.use[2]!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/postcss-loader/dist/cjs.js??clonedRuleSet-13.use[3]!../node_modules/sass-loader/dist/cjs.js??clonedRuleSet-13.use[4]!../node_modules/vue-loader/lib/index.js??vue-loader-options!../node_modules/unplugin/dist/webpack/loaders/transform.js?unpluginName=unplugin-vue-define-options!./js/pages/user/plugins/_host/legacy-host.vue?vue&type=style&index=0&id=7e9938db&prod&lang=scss&");i.__esModule&&(i=i.default),typeof i=="string"&&(i=[[c.id,i,""]]),i.locals&&(c.exports=i.locals);var _=o("../node_modules/vue-style-loader/lib/addStylesClient.js").Z,g=_("291b77da",i,!0,{})}}]);
