"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[8067],{"../node_modules/date-fns/esm/formatDistance/index.js":function(j,x,i){i.d(x,{Z:function(){return w}});var u=i("../node_modules/date-fns/esm/_lib/defaultOptions/index.js"),l=i("../node_modules/date-fns/esm/toDate/index.js"),m=i("../node_modules/date-fns/esm/_lib/requiredArgs/index.js");function g(o,s){(0,m.Z)(2,arguments);var n=(0,l.Z)(o),_=(0,l.Z)(s),M=n.getTime()-_.getTime();return M<0?-1:M>0?1:M}function E(o,s){(0,m.Z)(2,arguments);var n=(0,l.Z)(o),_=(0,l.Z)(s),M=n.getFullYear()-_.getFullYear(),y=n.getMonth()-_.getMonth();return M*12+y}function h(o){(0,m.Z)(1,arguments);var s=(0,l.Z)(o);return s.setHours(23,59,59,999),s}function I(o){(0,m.Z)(1,arguments);var s=(0,l.Z)(o),n=s.getMonth();return s.setFullYear(s.getFullYear(),n+1,0),s.setHours(23,59,59,999),s}function D(o){(0,m.Z)(1,arguments);var s=(0,l.Z)(o);return h(s).getTime()===I(s).getTime()}function R(o,s){(0,m.Z)(2,arguments);var n=(0,l.Z)(o),_=(0,l.Z)(s),M=g(n,_),y=Math.abs(E(n,_)),c;if(y<1)c=0;else{n.getMonth()===1&&n.getDate()>27&&n.setDate(30),n.setMonth(n.getMonth()-M*y);var Z=g(n,_)===-M;D((0,l.Z)(o))&&y===1&&g(o,_)===1&&(Z=!1),c=M*(y-Number(Z))}return c===0?0:c}function T(o,s){return(0,m.Z)(2,arguments),(0,l.Z)(o).getTime()-(0,l.Z)(s).getTime()}var p={ceil:Math.ceil,round:Math.round,floor:Math.floor,trunc:function(s){return s<0?Math.ceil(s):Math.floor(s)}},e="trunc";function t(o){return o?p[o]:p[e]}function a(o,s,n){(0,m.Z)(2,arguments);var _=T(o,s)/1e3;return t(n==null?void 0:n.roundingMethod)(_)}var S=i("../node_modules/date-fns/esm/_lib/defaultLocale/index.js");function P(o,s){if(o==null)throw new TypeError("assign requires that input parameter not be null or undefined");for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(o[n]=s[n]);return o}function k(o){return P({},o)}var r=i("../node_modules/date-fns/esm/_lib/getTimezoneOffsetInMilliseconds/index.js"),d=1440,b=2520,L=43200,A=86400;function w(o,s,n){var _,M;(0,m.Z)(2,arguments);var y=(0,u.j)(),c=(_=(M=n==null?void 0:n.locale)!==null&&M!==void 0?M:y.locale)!==null&&_!==void 0?_:S.Z;if(!c.formatDistance)throw new RangeError("locale must contain formatDistance property");var Z=g(o,s);if(isNaN(Z))throw new RangeError("Invalid time value");var f=P(k(n),{addSuffix:Boolean(n==null?void 0:n.addSuffix),comparison:Z}),C,N;Z>0?(C=(0,l.Z)(s),N=(0,l.Z)(o)):(C=(0,l.Z)(o),N=(0,l.Z)(s));var $=a(N,C),G=((0,r.Z)(N)-(0,r.Z)(C))/1e3,v=Math.round(($-G)/60),O;if(v<2)return n!=null&&n.includeSeconds?$<5?c.formatDistance("lessThanXSeconds",5,f):$<10?c.formatDistance("lessThanXSeconds",10,f):$<20?c.formatDistance("lessThanXSeconds",20,f):$<40?c.formatDistance("halfAMinute",0,f):$<60?c.formatDistance("lessThanXMinutes",1,f):c.formatDistance("xMinutes",1,f):v===0?c.formatDistance("lessThanXMinutes",1,f):c.formatDistance("xMinutes",v,f);if(v<45)return c.formatDistance("xMinutes",v,f);if(v<90)return c.formatDistance("aboutXHours",1,f);if(v<d){var z=Math.round(v/60);return c.formatDistance("aboutXHours",z,f)}else{if(v<b)return c.formatDistance("xDays",1,f);if(v<L){var F=Math.round(v/d);return c.formatDistance("xDays",F,f)}else if(v<A)return O=Math.round(v/L),c.formatDistance("aboutXMonths",O,f)}if(O=R(N,C),O<12){var W=Math.round(v/L);return c.formatDistance("xMonths",W,f)}else{var B=O%12,U=Math.floor(O/12);return B<3?c.formatDistance("aboutXYears",U,f):B<9?c.formatDistance("overXYears",U,f):c.formatDistance("almostXYears",U+1,f)}}},"./js/api/commands/user/email/lists.js":function(j,x,i){i.d(x,{$l:function(){return m},FC:function(){return I},Mo:function(){return D},Px:function(){return p},Wk:function(){return e},X6:function(){return g},kJ:function(){return E},lF:function(){return R},wq:function(){return h},yr:function(){return l}});var u=i("./js/api/command/index.js");const l=u.Z.get({id:"MAILING_LISTS",url:"/CMD_EMAIL_LIST",response:[],domain:!0,after:t=>t.flow(t.mapValues((a,S)=>({list:S,...a})),t.toArray,t.mapArrayProps({archive_size:t.convert.toAppNumber,digest_subscribers:t.convert.toAppNumber,subscribers:t.convert.toAppNumber}))}),m=u.Z.post({url:"/CMD_EMAIL_LIST",params:{action:"create"},domain:!0,schema:{name:u.Z.REQUIRED_STRING}}),g=u.Z.select({url:"/CMD_EMAIL_LIST",params:{purge_archives:!0,action:"delete"},domain:!0,schema:{purge_days:u.Z.REQUIRED_STRING}}),E=u.Z.select({url:"/CMD_EMAIL_LIST",params:{delete:!0,action:"delete"},domain:!0}),h=u.Z.get({id:"LIST_SUBSCRIBERS",url:"/CMD_EMAIL_LIST",params:{action:"view"},domain:!0,pagination:!0,schema:{name:u.Z.REQUIRED_STRING},after:t=>t.flow(t.deleteProp("digest_subscribers"),t.processTableInfo("subscribers"),t.moveProp("subscribers","rows"),t.mapProp("rows",t.toArray))}),I=h.extend({id:"DIGEST_LIST_SUBSCRIBERS",after:t=>t.flow(t.deleteProp("subscribers"),t.processTableInfo("digest_subscribers"),t.moveProp("digest_subscribers","rows"),t.mapProp("rows",t.toArray))}),D=u.Z.post({url:"/CMD_EMAIL_LIST",params:{action:"add"},domain:!0,schema:{name:u.Z.REQUIRED_STRING,email:u.Z.REQUIRED_STRING,type:u.Z.REQUIRED_STRING}}),R=u.Z.select({url:"/CMD_EMAIL_LIST",params:{action:"delete_subscriber",delete:!0},domain:!0,schema:{name:u.Z.REQUIRED_STRING,digest:{type:Boolean,default:!1,required:!1}},before:({digest:t})=>({action:t?"delete_subscriber_digest":"delete_subscriber"})}),T=t=>{const a=Object.values(t).find(S=>S.selected);return a?a.value:""},p=u.Z.get({id:"LIST_INFO",url:"/CMD_EMAIL_LIST",params:{action:"modify"},domain:!0,schema:{name:u.Z.REQUIRED_STRING},after:t=>t.flow(t.mapValues(a=>["yes","no"].includes(a)?t.convert.toAppBoolean(a):typeof a=="object"?T(a):a),t.mapProps({message_fronter:t.convert.toAppText,info:t.convert.toAppText,taboo_body:t.convert.toAppText,taboo_headers:t.convert.toAppText,message_footer:t.convert.toAppText,message_headers:t.convert.toAppText}))}),e=u.Z.post({url:"/CMD_EMAIL_LIST",method:"POST",params:{action:"save"},domain:!0,schema:{name:u.Z.REQUIRED_STRING}})},"./js/composables/dateFilter.ts":function(j,x,i){i.d(x,{W:function(){return E},f:function(){return m.f}});var u=i("../node_modules/ramda/es/index.js"),l=i("../node_modules/date-fns/esm/format/index.js"),m=i("./js/modules/date-formats.ts"),g=i("./js/modules/customizations/date-formats/default.ts");const E=u.WAo((h,I)=>{if(I)try{return(0,l.Z)(I,m.f.value[h])}catch(D){return console.warn(`Given ${h} format is incorrect:
${D.message}`),(0,l.Z)(I,g.d[h])}return""})},"./js/composables/filters.ts":function(j,x,i){i.d(x,{Q0:function(){return a},aS:function(){return P},d5:function(){return S},eB:function(){return p},hT:function(){return R},kC:function(){return D},n9:function(){return t},zM:function(){return T}});var u=i("../node_modules/date-fns/esm/formatDistance/index.js"),l=i("../node_modules/punycode/punycode.es6.js"),m=i("./js/composables/dateFilter.ts"),g=i("./js/composables/gettext.ts");const{$gettext:E,$ngettext:h,$gettextInterpolate:I}=(0,g.Z)(),D=r=>{var d;return r?((d=r.at(0))===null||d===void 0?void 0:d.toUpperCase())+r.slice(1):""},R=(r,d="datetime")=>(0,m.W)(d,r),T=r=>(0,u.Z)(r,new Date),p=(r,d=1024)=>{const b=Number(r);if(!b)return"0 B";const L=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],A=Math.floor(Math.log(b)/Math.log(d));return`${parseFloat((b/d**A).toFixed(2))} ${L[A]}`},e=r=>{try{return(0,l.xX)(r)}catch(d){return r}},t=r=>(0,l.xX)(r),a=r=>{if(!r||!r.includes("@"))return r;const[d,b]=r.split("@");return[d,e(b)].join("@")},S=r=>{if(r<60)return E("less than a minute");const d=Math.floor(r/60)%60,b=Math.floor(r/3600)%24,L=Math.floor(r/(3600*24)),A=[L?h("%{days} day","%{days} days",L):null,b?h("%{hours} hour","%{hours} hours",b):null,d?h("%{minutes} minute","%{minutes} minutes",d):null].filter(Boolean).join(", ");return I(A,{days:L,hours:b,minutes:d})},P=(r,d)=>r.length<=d?r:`${r.substring(0,d)}...`,k=()=>({capitalize:D,date:R,distanceFromNow:T,humanReadableSize:p,p6eUnicode:t,p6eUnicodeEmail:a,formatUptime:S,truncateString:P})},"./js/pages/user/email/lists/index.vue":function(j,x,i){i.r(x),i.d(x,{default:function(){return T}});var u=function(){var e=this,t=e._self._c;return t("app-page",{attrs:{actions:[{label:e.$gettext("Create Mailing List"),handler:e.$dialog("CREATE_LIST_DIALOG").open,icon:"#plus-fill",visible:e.$api.lists.length<e.limit}]},scopedSlots:e._u([{key:"details",fn:function(){return[t("ui-infobar-item",{attrs:{title:e.$gettext("Details")}},[t("ui-infobar-stats",{attrs:{title:e.$gettext("Mailing Lists"),usage:e.$api.lists.length,limit:e.limit}})],1)]},proxy:!0},{key:"default",fn:function(){return[t("app-page-section",[t("ui-r-table",e._b({attrs:{"disable-pagination":""},on:{"update:checkedRows":function(a){e.checkedRows=a}},scopedSlots:e._u([{key:"table:actions",fn:function(){return[t("ui-table-action",{on:{click:function(a){e.$dialog("PURGE_ARCHIVES_DIALOG").open()}}},[t("span",{domProps:{textContent:e._s(e.$gettext("Purge Archives"))}})]),e._v(" "),t("ui-table-action",{on:{click:function(a){e.$dialog("DELETE_ITEMS_DIALOG").open()}}},[t("span",{domProps:{textContent:e._s(e.$gettext("Delete"))}})])]},proxy:!0},{key:"col:list",fn:function({list:a}){return[t("ui-link",{attrs:{name:"user/email/lists/view",params:{name:a}}},[e._v(`
                        `+e._s(a)+"@"+e._s(e.$domainUnicode)+`
                    `)])]}},{key:"col:archive_size",fn:function({archive_size:a}){return[e._v(`
                    `+e._s(e.humanReadableSize(a))+`
                `)]}},{key:"row:actions",fn:function({item:a}){return[t("ui-button-link",{attrs:{icon:"pencil",title:e.$gettext("Edit"),name:"user/email/lists/modify",params:{name:a.list}}})]}}])},"ui-r-table",{rows:e.$api.lists,columns:[{id:"list",label:e.$gettext("Mailing List"),editable:!1},{id:"subscribers",label:e.$gettext("Subscribers")},{id:"digest_subscribers",label:e.$gettext("Digest Subscribers")},{id:"archive_size",label:e.$gettext("Archive Size")}],checkedRows:e.checkedRows,verticalLayout:e.clientStore.isPhone},!1))],1),e._v(" "),t("ui-dialog",{attrs:{id:"CREATE_LIST_DIALOG",title:e.$gettext("Create Mailing List")},scopedSlots:e._u([{key:"content",fn:function(){return[t("ui-form-element",{attrs:{vertical:"",group:"mailingList",validators:{required:!0,maxLength:64}},scopedSlots:e._u([{key:"title",fn:function(){return[t("span",{domProps:{textContent:e._s(e.$gettext("List Name:"))}})]},proxy:!0},{key:"content",fn:function(){return[t("input-text",{attrs:{suffix:`@${e.$domainUnicode}`},model:{value:e.listName,callback:function(a){e.listName=a},expression:"listName"}})]},proxy:!0}])})]},proxy:!0},{key:"buttons",fn:function(){return[t("ui-button",{attrs:{theme:"primary","validate-group":"mailingList"},on:{click:e.createList}},[t("span",{domProps:{textContent:e._s(e.$gettext("Create"))}})])]},proxy:!0}])}),e._v(" "),t("ui-dialog",{attrs:{id:"PURGE_ARCHIVES_DIALOG",title:e.$gettext("Purge Archives")},scopedSlots:e._u([{key:"content",fn:function(){return[t("ui-form-element",{attrs:{vertical:""},scopedSlots:e._u([{key:"content",fn:function(){return[t("input-text",{attrs:{number:"",suffix:e.$gettext("Days.")},model:{value:e.purgeDays,callback:function(a){e.purgeDays=a},expression:"purgeDays"}})]},proxy:!0},{key:"title",fn:function(){return[t("span",{domProps:{textContent:e._s(e.$gettext("Purge Archives older than"))}})]},proxy:!0}])})]},proxy:!0},{key:"buttons",fn:function(){return[t("ui-button",{attrs:{theme:"danger"},on:{click:e.purgeArchives}},[t("span",{domProps:{textContent:e._s(e.$gettext("Purge"))}})])]},proxy:!0}])}),e._v(" "),t("ui-dialog-delete-items",{attrs:{subject:e.$ngettext("mailing list","mailing lists",e.checkedRows.length)},on:{"click:confirm":e.deleteLists}})]},proxy:!0}])})},l=[],m=i("./js/stores/index.ts"),g=i("./js/api/commands/user/email/lists.js"),E=i("./js/composables/filters.ts"),h={name:"MailingLists",preload:g.yr,api:[{command:g.yr,bind:"lists"}],data(){return{listName:"",purgeDays:"90",checkedRows:[]}},computed:{checkedLists(){return this.checkedRows.map(p=>p.list)},limit(){return this.$_session.usage.mailingLists.limit},...(0,m.Kc)(["client"])},watch:{$domain(){this.reloadRows()}},methods:{humanReadableSize:E.eB,reloadRows(){g.yr()},async createList(){await g.$l({name:this.listName})&&(Object.assign(this.$data,this.$options.data.apply(this)),this.checkedRows=[],this.reloadRows())},async purgeArchives(){await g.X6({select:this.checkedLists,purge_days:this.purgeDays})&&(this.checkedRows=[],this.reloadRows())},async deleteLists(){await g.kJ({select:this.checkedLists})&&(this.checkedRows=[],this.reloadRows())}}},I=h,D=i("../node_modules/vue-loader/lib/runtime/componentNormalizer.js"),R=(0,D.Z)(I,u,l,!1,null,null,null),T=R.exports}}]);
