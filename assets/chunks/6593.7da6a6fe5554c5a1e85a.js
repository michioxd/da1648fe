"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[6593],{"../node_modules/date-fns/esm/formatDistance/index.js":function(U,I,c){c.d(I,{Z:function(){return w}});var M=c("../node_modules/date-fns/esm/_lib/defaultOptions/index.js"),u=c("../node_modules/date-fns/esm/toDate/index.js"),d=c("../node_modules/date-fns/esm/_lib/requiredArgs/index.js");function g(i,r){(0,d.Z)(2,arguments);var a=(0,u.Z)(i),s=(0,u.Z)(r),e=a.getTime()-s.getTime();return e<0?-1:e>0?1:e}function p(i,r){(0,d.Z)(2,arguments);var a=(0,u.Z)(i),s=(0,u.Z)(r),e=a.getFullYear()-s.getFullYear(),t=a.getMonth()-s.getMonth();return e*12+t}function k(i){(0,d.Z)(1,arguments);var r=(0,u.Z)(i);return r.setHours(23,59,59,999),r}function P(i){(0,d.Z)(1,arguments);var r=(0,u.Z)(i),a=r.getMonth();return r.setFullYear(r.getFullYear(),a+1,0),r.setHours(23,59,59,999),r}function R(i){(0,d.Z)(1,arguments);var r=(0,u.Z)(i);return k(r).getTime()===P(r).getTime()}function S(i,r){(0,d.Z)(2,arguments);var a=(0,u.Z)(i),s=(0,u.Z)(r),e=g(a,s),t=Math.abs(p(a,s)),n;if(t<1)n=0;else{a.getMonth()===1&&a.getDate()>27&&a.setDate(30),a.setMonth(a.getMonth()-e*t);var l=g(a,s)===-e;R((0,u.Z)(i))&&t===1&&g(i,s)===1&&(l=!1),n=e*(t-Number(l))}return n===0?0:n}function T(i,r){return(0,d.Z)(2,arguments),(0,u.Z)(i).getTime()-(0,u.Z)(r).getTime()}var h={ceil:Math.ceil,round:Math.round,floor:Math.floor,trunc:function(r){return r<0?Math.ceil(r):Math.floor(r)}},A="trunc";function Z(i){return i?h[i]:h[A]}function N(i,r,a){(0,d.Z)(2,arguments);var s=T(i,r)/1e3;return Z(a==null?void 0:a.roundingMethod)(s)}var E=c("../node_modules/date-fns/esm/_lib/defaultLocale/index.js");function D(i,r){if(i==null)throw new TypeError("assign requires that input parameter not be null or undefined");for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(i[a]=r[a]);return i}function j(i){return D({},i)}var $=c("../node_modules/date-fns/esm/_lib/getTimezoneOffsetInMilliseconds/index.js"),y=1440,C=2520,x=43200,O=86400;function w(i,r,a){var s,e;(0,d.Z)(2,arguments);var t=(0,M.j)(),n=(s=(e=a==null?void 0:a.locale)!==null&&e!==void 0?e:t.locale)!==null&&s!==void 0?s:E.Z;if(!n.formatDistance)throw new RangeError("locale must contain formatDistance property");var l=g(i,r);if(isNaN(l))throw new RangeError("Invalid time value");var o=D(j(a),{addSuffix:Boolean(a==null?void 0:a.addSuffix),comparison:l}),v,_;l>0?(v=(0,u.Z)(r),_=(0,u.Z)(i)):(v=(0,u.Z)(i),_=(0,u.Z)(r));var m=N(_,v),G=((0,$.Z)(_)-(0,$.Z)(v))/1e3,f=Math.round((m-G)/60),b;if(f<2)return a!=null&&a.includeSeconds?m<5?n.formatDistance("lessThanXSeconds",5,o):m<10?n.formatDistance("lessThanXSeconds",10,o):m<20?n.formatDistance("lessThanXSeconds",20,o):m<40?n.formatDistance("halfAMinute",0,o):m<60?n.formatDistance("lessThanXMinutes",1,o):n.formatDistance("xMinutes",1,o):f===0?n.formatDistance("lessThanXMinutes",1,o):n.formatDistance("xMinutes",f,o);if(f<45)return n.formatDistance("xMinutes",f,o);if(f<90)return n.formatDistance("aboutXHours",1,o);if(f<y){var X=Math.round(f/60);return n.formatDistance("aboutXHours",X,o)}else{if(f<C)return n.formatDistance("xDays",1,o);if(f<x){var Y=Math.round(f/y);return n.formatDistance("xDays",Y,o)}else if(f<O)return b=Math.round(f/x),n.formatDistance("aboutXMonths",b,o)}if(b=S(_,v),b<12){var z=Math.round(f/x);return n.formatDistance("xMonths",z,o)}else{var L=b%12,F=Math.floor(b/12);return L<3?n.formatDistance("aboutXYears",F,o):L<9?n.formatDistance("overXYears",F,o):n.formatDistance("almostXYears",F+1,o)}}},"./js/pages/admin/ip-manager/index.vue":function(U,I,c){c.r(I),c.d(I,{default:function(){return a}});var M=function(){var e=this,t=e._self._c;return t("app-page",{attrs:{actions:[{handler:e.$dialog("ADD_IP_DIALOG").open,label:e.$gettext("Add IP"),icon:"#plus-fill"}]},scopedSlots:e._u([{key:"default",fn:function(){return[t("app-page-section",[t("ui-tabs",{attrs:{tabs:[{id:"ips",label:e.$gettext("IPs")},{id:"pool",label:e.$gettext("Devices")}]},scopedSlots:e._u([{key:"tab:ips",fn:function(){return[t("ui-api-table",e._b({attrs:{"equal-width-layout":""},on:{"action:assign":function(n){e.$dialog("ASSIGN_IP_DIALOG").open()},"action:remove":function(n){e.$dialog("DELETE_IP_FROM_RESELLER").open()},"action:clear":e.clearIpNamespace,"action:global":e.setGlobal,"action:share":e.share,"action:free":e.free,"action:del":function(n){e.$dialog("DELETE_ITEMS_DIALOG").open()}},scopedSlots:e._u([{key:"col:nameserver",fn:function({nameserver:n}){return[e._v(`
                            `+e._s(e.p6eUnicode(n))+`
                        `)]}},{key:"col:ip",fn:function({ip:n,global:l,flags:o}){return[t("ui-link",{attrs:{name:"admin/ip-manager/details",params:{ip:n}}},[e._v(`
                                `+e._s(n)+`
                                `),o.length>0?t("ui-tooltip",[t("ul",e._l(o,function(v){return t("li",{key:v,domProps:{textContent:e._s(v)}})}),0)]):e._e()],1),e._v(" "),l?t("ui-badge",{directives:[{name:"margin",rawName:"v-margin:left",value:1,expression:"1",arg:"left"}],attrs:{theme:"safe",icon:!1}},[t("span",{domProps:{textContent:e._s(e.$gettext("Global"))}})]):e._e()]}},{key:"col:device",fn:function(n){return[n.device?t("ui-link",{on:{click:function(l){return e.openDeviceModal(n.device)}}},[e._v(`
                                `+e._s(n.device)+`
                            `)]):e._e()]}},{key:"col:resellers",fn:function({resellers:n,status:l,reseller:o}){return[l==="server"?t("span"):[e._v(`
                                `+e._s(n?n.join(", "):o)+`
                            `)]]}}]),model:{value:e.select,callback:function(n){e.select=n},expression:"select"}},"ui-api-table",{command:e.$commands.getIps,endpoint:"GET_IPS",rowID:"ip",columns:{ip:e.$gettext("IP"),status:e.$gettext("Status"),device:e.$gettext("Device"),resellers:e.$gettext("Reseller(s)"),users:e.$gettext("Users"),nameserver:e.$gettext("Name Server"),netmask:e.$gettext("Netmask")},actions:{assign:{label:e.$gettext("Assign"),disabled:!e.enableAssign},remove:{label:e.$gettext("Remove from reseller"),disabled:!e.enableRemove},clear:e.$gettext("Clear NS"),global:{label:e.enableGlobal.set?e.$gettext("Set Global"):e.$gettext("Un-Set Global"),disabled:e.enableGlobal.disabled},share:{label:e.$gettext("Share"),disabled:e.enableRemove===!1},free:{label:e.$gettext("Free"),disabled:e.enableRemove===!1},del:{label:e.$gettext("Delete"),disabled:!e.enableDelete}},rowsMapper:e.rowsMapper},!1))]},proxy:!0},{key:"tab:pool",fn:function(){return[t("ui-r-table",{attrs:{rows:e.ipPool,columns:[{id:"device",label:e.$gettext("Device")},{id:"ip",label:e.$gettext("IP")},{id:"netmask",label:e.$gettext("Netmask")},{id:"active",label:e.$gettext("Active")}],"hide-before-controls":"","is-checkable":!1},scopedSlots:e._u([{key:"col:device",fn:function({item:n}){return[n.first?t("span",{staticClass:"txt:bold"},[e._v(`
                                `+e._s(n.device)+`
                                `),n.flags.length>0?t("ui-tooltip",[t("ul",e._l(n.flags,function(l){return t("li",{key:l,domProps:{textContent:e._s(l)}})}),0)]):e._e()],1):t("span")]}},{key:"col:active",fn:function({item:n}){return[t("ui-badge",{attrs:{theme:n.active?"safe":"danger"}},[t("span",{domProps:{textContent:e._s(n.active?e.$gettext("Yes"):e.$gettext("No"))}})])]}},{key:"row:actions",fn:function({item:n}){return[n.loopback===!1?t("ui-actions",[n.active===!1?t("ui-link",{on:{click:function(l){return e.addIpFromDevice(n)}}},[t("span",{domProps:{textContent:e._s(e.$gettext("Add IP"))}})]):t("ui-link",{on:{click:function(l){return e.removeIpFromDevice(n)}}},[t("span",{domProps:{textContent:e._s(e.$gettext("Remove IP"))}})])],1):e._e()]}}])})]},proxy:!0}])})],1),e._v(" "),t("assign-ip-dialog",{attrs:{"ip-count":e.select.length},on:{assign:e.assignIp}}),e._v(" "),t("add-ip-dialog",{on:{submit:e.addIp}}),e._v(" "),t("ui-dialog-delete-items",{attrs:{subject:e.$ngettext("IP Address","IP Addresses",e.select.length)},on:{"click:confirm":e.deleteIps}}),e._v(" "),t("ui-dialog",{attrs:{id:"DELETE_IP_FROM_RESELLER",title:e.$gettext("Delete IP from Reseller")},scopedSlots:e._u([{key:"content",fn:function(){return[t("ui-form-element",{attrs:{vertical:""},scopedSlots:e._u([{key:"title",fn:function(){return[t("span",{domProps:{textContent:e._s(e.$gettext("Select Reseller"))}})]},proxy:!0},{key:"content",fn:function(){return[t("input-select",{attrs:{options:e.selectedRowsResellers},model:{value:e.remove,callback:function(n){e.remove=n},expression:"remove"}})]},proxy:!0}])})]},proxy:!0},{key:"buttons",fn:function(){return[t("ui-button",{attrs:{theme:"danger"},on:{click:e.removeIpReseller}},[t("span",{domProps:{textContent:e._s(e.$gettext("Remove IP"))}})])]},proxy:!0}])}),e._v(" "),t("device-ips-dialog",{attrs:{device:e.device,ips:e.devices[e.device]},on:{"ip:add":e.addIpFromDevice,"ip:remove":e.removeIpFromDevice}})]},proxy:!0}])})},u=[],d=c("./js/api/commands/admin/ip-manager/index.js"),g=c("./js/api/commands/reseller/ip-config.js"),p=c("../node_modules/ramda/es/index.js"),k=c("./js/pages/admin/ip-manager/_dialogs/add-ip-dialog.vue"),P=function(){var e=this,t=e._self._c;return t("ui-dialog",{attrs:{id:"ASSIGN_IP_DIALOG",theme:"safe",title:e.$ngettext("Assign IP","Assign IPs",e.ipCount)},scopedSlots:e._u([{key:"content",fn:function(){return[t("ui-form-element",{attrs:{group:"assignIp",validators:{required:!0}},scopedSlots:e._u([{key:"title",fn:function(){return[t("span",{domProps:{textContent:e._s(e.$ngettext("Assign IP to:","Assign IPs to:",e.ipCount))}})]},proxy:!0},{key:"content",fn:function(){return[t("input-select",{attrs:{options:e.$api.creators},model:{value:e.reseller,callback:function(n){e.reseller=n},expression:"reseller"}})]},proxy:!0}])})]},proxy:!0},{key:"buttons",fn:function(){return[t("ui-button",{attrs:{"validate-group":"assignIp",theme:"safe"},on:{click:e.submit}},[t("span",{domProps:{textContent:e._s(e.$gettext("Assign"))}})])]},proxy:!0}])})},R=[],S={api:[{command:d.getIps,bind:{"response.creators":"creators"}}],props:{ipCount:{type:Number,required:!0}},data:()=>({reseller:""}),methods:{submit(){this.$emit("assign",this.reseller)}}},T=S,h=c("../node_modules/vue-loader/lib/runtime/componentNormalizer.js"),A=(0,h.Z)(T,P,R,!1,null,null,null),Z=A.exports,N=function(){var e=this,t=e._self._c;return t("ui-dialog",{attrs:{id:"DEVICE_IPS_DIALOG",size:"normal","no-close-btn":""},scopedSlots:e._u([{key:"title",fn:function(){return[t("span",{domProps:{textContent:e._s(e.$gettextInterpolate(e.$gettext("Device: %{ device }"),{device:e.device}))}})]},proxy:!0},{key:"content",fn:function(){return[t("ui-r-table",{attrs:{columns:[{id:"ip",label:e.$gettext("IP")},{id:"netmask",label:e.$gettext("Netmask")},{id:"active",label:e.$gettext("Active")}],rows:e.ips,"disable-pagination":"","is-checkable":!1,"hide-before-controls":""},scopedSlots:e._u([{key:"col:active",fn:function({item:n}){return[t("ui-badge",{attrs:{theme:n.active?"safe":"danger"}},[t("span",{domProps:{textContent:e._s(n.active?e.$gettext("Yes"):e.$gettext("No"))}})])]}},{key:"col:ip",fn:function({item:n}){return[t("ui-tooltip",{scopedSlots:e._u([{key:"trigger",fn:function(){return[t("span",{domProps:{textContent:e._s(n.ip)}})]},proxy:!0}],null,!0)},[e._v(" "),t("ul",e._l(n.flags,function(l){return t("li",{key:l,domProps:{textContent:e._s(l)}})}),0)])]}},{key:"row:actions",fn:function({item:n}){return[t("ui-actions",[n.active?t("ui-link",{on:{click:function(l){return e.$emit("ip:remove",n)}}},[t("span",{domProps:{textContent:e._s(e.$gettext("Remove IP"))}})]):t("ui-link",{on:{click:function(l){return e.$emit("ip:add",n)}}},[t("span",{domProps:{textContent:e._s(e.$gettext("Add IP"))}})])],1)]}}])})]},proxy:!0}])})},E=[],D={props:{device:{type:String,required:!0},ips:{type:Array,required:!1,default:()=>[]}}},j=D,$=(0,h.Z)(j,N,E,!1,null,null,null),y=$.exports,C=c("./js/composables/index.ts"),x=c("./js/composables/filters.ts");const O=(0,C.Rh)("DEVICE_IPS_DIALOG");var w={name:"AdminIpManager",preload:d.getIps,commands:d,api:[{command:d.getIps,bind:"data"}],components:{AddIpDialog:k.Z,AssignIpDialog:Z,DeviceIpsDialog:y},data(){return{select:[],device:"",remove:"all"}},computed:{rows(){return this.$api.data.rows},selectedRows(){return this.rows.filter(s=>this.select.includes(s.ip))},selectedRowsResellers(){return this.selectedRows.reduce((s,e)=>(e.resellers?e.resellers.forEach(t=>{s[t]=t}):s[e.reseller]=e.reseller,s),{all:this.$gettext("All Resellers")})},enableAssign(){return this.selectedRows.every(s=>s.status!=="server")},enableRemove(){return this.selectedRows.every(s=>s.reseller)},enableDelete(){return this.selectedRows.every(s=>!s.reseller&&s.status==="free")},enableGlobal(){return{set:this.selectedRows.some(s=>!s.global),disabled:this.selectedRows.some(s=>s.status==="server")}},ifaMessages(){return this.$api.data.device_ips.ifa_flags},devices(){const s=t=>{const n=Number(t);return isFinite(n)?Object.entries(this.ifaMessages).reduce((l,o)=>{const v=Number(o[0]);return isFinite(v)&&n&v&&l.push(o[1]),l},[]):[]};return p.UID(p.zGw(p.Zpf,p.UID(([t,n])=>({ip:t,...n})),p.UID(t=>({...t,flags:s(t.ifa_flags),active:this.rows.some(n=>n.ip===t.ip)}))))(this.$api.data.device_ips.devices)},ipToDevice(){return p.zGw(p.UID(p.XPQ),p.Zpf,p.u4g((e,t)=>(p.Ed_(n=>{e[n]=t[0]},t[1]),e),{}))(this.$api.data.device_ips.devices)},ipPool(){return Object.entries(this.devices).reduce((s,[e,t])=>(t.forEach(({ip:n,netmask:l,active:o,flags:v,ifa_flags:_},m)=>{const G=Boolean(Number(_)&8);s.push({device:e,ip:n,netmask:l,flags:v,loopback:G,active:o,first:m===0})}),s),[])}},methods:{p6eUnicode:x.n9,rowsMapper(s){const e=this.ipToDevice[s.ip]||null,t=e?this.devices[e].find(n=>n.ip===s.ip).flags:[];return{...s,device:e,flags:t}},openDeviceModal(s){this.device=s,O.open()},reloadTable(){this.$reloadApiTable(),this.select=[]},assignIp(s){d.assignReseller({select:this.select,reseller:s}).then(this.reloadTable)},async removeIpReseller(){await d.removeReseller({select:this.select,reseller:this.remove==="all"?null:this.remove}),this.reloadTable(),this.remove="all"},clearIpNamespace(){d.clearNamespace({select:this.select}).then(this.reloadTable)},deleteIps(){d.deleteIps({select:this.select}).then(this.reloadTable)},addIp(s){return d.addIp(s).then(this.reloadTable)},setGlobal(){d.setGlobal({select:this.select,global:this.enableGlobal.set}).then(this.reloadTable)},async addIpFromDevice(s){await this.addIp({ip:s.ip,netmask:s.netmask,add_to_device:!1}),d.getIps()},async removeIpFromDevice(s){await d.deleteIps({select:[s.ip]}),d.getIps()},async share(){await g.BN({select:this.select}),this.reloadTable()},async free(){await g.gd({select:this.select}),this.reloadTable()}}},i=w,r=(0,h.Z)(i,M,u,!1,null,null,null),a=r.exports}}]);
