"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[6179],{"./js/pages/user/unit/index.vue":function(D,u,a){a.r(u),a.d(u,{default:function(){return E}});var c=function(){var t=this,e=t._self._c;return e("app-page",{attrs:{id:"unit",actions:[{label:t.$gettext("Create Application"),icon:"#plus-fill",name:"user/unit/create",key:"create-application"},{label:t.$gettext("Create Route"),handler:t.createRoute,icon:"#plus-fill",key:"create-route",theme:"safe"}]},scopedSlots:t._u([{key:"default",fn:function(){return[e("app-page-section",[e("ui-tabs",t._b({scopedSlots:t._u([{key:"tab:apps",fn:function(){return[e("div",[e("ui-r-table",{attrs:{"checked-rows":t.selectedApps,columns:[{id:"name",label:t.$gettext("Name")},{id:"type",label:t.$gettext("Type")},{id:"wd",label:t.$gettext("Associated Directory")},{id:"restart",label:t.$gettext(" ")}],rows:t.$api.apps},on:{"update:checkedRows":function(o){t.selectedApps=o}},scopedSlots:t._u([{key:"table:actions",fn:function(){return[e("ui-table-action",{on:{click:t.deleteApps}},[e("span",{domProps:{textContent:t._s(t.$gettext("Delete"))}})])]},proxy:!0},{key:"col:name",fn:function({name:o}){return[e("ui-link",{staticClass:"txt:uppercase txt:bold",attrs:{name:"user/unit/modify",params:{id:o}}},[e("ui-icon",{directives:[{name:"margin",rawName:"v-margin:right",value:"5px",expression:"'5px'",arg:"right"}],attrs:{id:"pencil",size:"small",theme:"primary"}}),t._v(`
                                    `+t._s(o)+`
                                `)],1)]}},{key:"col:type",fn:function({type:o}){return[t._v(`
                                `+t._s(t.types[o])+`
                            `)]}},{key:"col:wd",fn:function({app:o}){return[o.type==="python"?[t._v(`
                                    `+t._s(o.path?o.path.join(", "):"")+`
                                `)]:o.type==="php"?[t._v(`
                                    `+t._s(t.getPHPRoot(o))+`
                                `)]:[t._v(`
                                    `+t._s(o.working_directory)+`
                                `)]]}},{key:"col:restart",fn:function({name:o,app:r}){return[e("ui-actions",[e("ui-link",{on:{click:function(C){return t.restartApp(o,r)}}},[e("span",{domProps:{textContent:t._s(t.$gettext("Restart Application"))}})]),t._v(" "),e("ui-link",{on:{click:function(C){return t.createRoute(o)}}},[e("span",{domProps:{textContent:t._s(t.$gettext("Create Route"))}})])],1)]}}])})],1)]},proxy:!0},{key:"tab:routes",fn:function(){return[e("route-tab")]},proxy:!0}])},"ui-tabs",{tabs:t.tabs},!1)),t._v(" "),e("create-route-dialog",{attrs:{"app-name":t.newRoute.app,"force-app-name":t.newRoute.force},on:{done:t.getUnits}})],1)]},proxy:!0}])})},l=[],s=a("./js/api/commands/user/unit/index.js"),p=function(){var t=this,e=t._self._c;return e("app-page-section",[e("ui-r-table",{attrs:{columns:[{id:"location",label:t.$gettext("Location")}],rows:t.locations,"checked-rows":t.checkedRows},on:{"update:checkedRows":function(o){t.checkedRows=o}},scopedSlots:t._u([{key:"table:actions",fn:function(){return[e("ui-table-action",{on:{click:t.deleteLocations}},[e("span",{domProps:{textContent:t._s(t.$gettext("Delete"))}})])]},proxy:!0},{key:"col:location",fn:function({location:o}){return[e("div",{directives:[{name:"flex",rawName:"v-flex",value:{main:"between"},expression:"{ main: 'between' }"}]},[e("ui-link",{on:{click:function(r){return t.editRoute(o)}}},[e("ui-icon",{directives:[{name:"margin",rawName:"v-margin:right",value:"5px",expression:"'5px'",arg:"right"}],attrs:{id:"pencil",size:"small",color:"primary"}}),t._v(`
                    `+t._s(o)+`
                `)],1)],1)]}}])}),t._v(" "),e("edit-route-dialog",{attrs:{name:t.selectedLocation},on:{done:t.loadData}})],1)},d=[],_=function(){var t=this,e=t._self._c;return e("ui-dialog",{attrs:{id:"EDIT_ROUTE",theme:"primary",size:"normal",title:t.$gettext("Edit Route"),"no-auto-close":""},on:{"dialog:open":t.onOpen,"dialog:close":t.onClose},scopedSlots:t._u([{key:"content",fn:function(){return[t.loading?e("ui-center",{attrs:{height:"10rem"}},[e("ui-loader-icon",{attrs:{size:32}})],1):e("route-editor",{on:{"update:valid":function(o){t.valid=o}},model:{value:t.json,callback:function(o){t.json=o},expression:"json"}})]},proxy:!0},{key:"buttons",fn:function(){return[e("ui-button",{attrs:{theme:"safe",disabled:!t.valid},on:{click:t.saveRoute}},[e("span",{domProps:{textContent:t._s(t.$gettext("Save"))}})])]},proxy:!0}])})},m=[],g=a("./js/pages/user/unit/_components/route-editor.vue"),h={components:{RouteEditor:g.Z},props:{name:{type:String,required:!0}},data:()=>({loading:!1,json:"[]",valid:!1}),computed:{location(){const[n,...t]=this.name.split("/");return["",...t].join("/")}},methods:{async onOpen(){this.loading=!0;const n=await(0,s.Bv)({name:this.name});this.json=JSON.stringify(n.route,null,2),this.loading=!1},onClose(){this.json="[]"},async saveRoute(){await(0,s.pV)({routes:this.json,location:this.location})instanceof Error||this.$emit("done")}}},v=h,i=a("../node_modules/vue-loader/lib/runtime/componentNormalizer.js"),f=(0,i.Z)(v,_,m,!1,null,null,null),y=f.exports,x={api:s.rY,components:{EditRouteDialog:y},data:()=>({checkedRows:[],selectedLocation:""}),computed:{locations(){return this.$api.routes.map(n=>({location:n}))}},methods:{loadData(){this.checkedRows=[],this.selectedLocation="",(0,s.rY)()},getLocationFromName(n){const[t,...e]=n.split("/");return["",...e].join("/")},deleteLocations(){const n=this.checkedRows.map(t=>t.location);(0,s.Hg)({select:n}).then(this.loadData)},changeLocation(n){this.selectedLocation=n,this.$nextTick(()=>{this.$dialog("RENAME_ROUTE").open()})},editRoute(n){this.selectedLocation=n,this.$dialog("EDIT_ROUTE").open()}}},R=x,b=(0,i.Z)(R,p,d,!1,null,null,null),$=b.exports,k=a("./js/pages/user/unit/_components/create-route.vue");const w=s.dt.extend({notifySuccess:!1,notifyError:!1});var j={preload:s.rY,api:s.rY,components:{RouteTab:$,CreateRouteDialog:k.Z},data:()=>({selectedApps:[],newRoute:{app:"",force:!1}}),computed:{tabs(){return[{id:"apps",label:this.$gettext("Applications")},{id:"routes",label:this.$gettext("Routes")}]},types(){return{external:this.$gettext("Node.js"),php:this.$gettext("PHP"),"php 7.3":this.$gettext("PHP 7.3"),python:this.$gettext("Python"),java:this.$gettext("Java"),perl:this.$gettext("Perl"),ruby:this.$gettext("Ruby")}},routes(){return this.$api.routes.map(n=>({route:n}))},select(){return this.selectedApps.map(n=>n.name)}},watch:{$domain(n){(0,s.rY)({domain:n})}},methods:{getUnits:s.rY,async deleteApps(){await(0,s.lJ)({select:this.select}),this.selectedApps=[],(0,s.rY)()},async createRoute(n="",t=!1){this.newRoute.app=n,this.newRoute.force=t,this.$dialog("CREATE_ROUTE_DIALOG").open()},async restartApp(n,t){const e={...t,environment:{...t.environment||{},APPGEN:Date.now().toString()}};await w({name:n,json:JSON.stringify(e,null,2)}),this.$notifications.success({title:"Success"})},getPHPRoot(n){if(n.targets){const t=Object.values(n.targets);if(t.length===1)return t[0].root;const e=t.length,o=t[0].root,r=e-1;return this.$gettextInterpolate(this.$ngettext("%{root} + %{n} more target","%{root} + %{n} more targets",r),{n:r,root:o})}return n.root}}},A=j,P=(0,i.Z)(A,c,l,!1,null,null,null),E=P.exports}}]);
