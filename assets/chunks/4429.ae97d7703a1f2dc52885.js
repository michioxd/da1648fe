"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[4429],{"./js/api/commands/fm.js":function(y,h,a){a.d(h,{Dp:function(){return v},rx:function(){return i},yC:function(){return d}});var e=a("./js/api/command/index.js"),p=a("../node_modules/ramda/es/index.js");const f="/CMD_FILE_MANAGER",c=u=>{const t=n=>p.zGw(p.Zpf,p.UID(s=>({path:s[0],size:Number(s[1]),type:n})));return p.mNm(p.vgT("path"),[...t("file")(u.files),...t("directory")(u.files)])},l={type:String,required:!1,default:"/"},v=e.Z.get({url:f,id:"FOLDER_TREE",params:{action:"parent_tree"},schema:{path:l},after:u=>u.flow(t=>typeof t=="string"?JSON.parse(t.replace(`[
,`,`[
`)):t,u.mapArray(u.mapProps({path:t=>t.replace(/\/\//g,"/").replace(/\/$/g,""),dirs:u.convert.toAppNumber,files:u.convert.toAppNumber,files_size:u.convert.toAppNumber})))}),g=e.Z.get({url:f,id:"FOLDER_DIRS",params:{action:"json_dirs",ipp:1e5},schema:{path:l},after:u=>u.flow(t=>{if(t.error)throw new Error(u.convert.toAppHtml(t.error));return t},u.transformObject(t=>({[t.truepath]:{path:t.truepath,dirs:Number(t.sub_directories||0),files:Number(t.files||0)}})))}),i=e.Z.get({url:f,id:"FILE_EXISTS",response:!1,params:{action:"exists"},schema:{path:e.Z.REQUIRED_STRING},after:u=>u.flow(u.getProp("exists"),u.isEqual("1"))}),d=e.Z.get({id:"FM_SEARCH",url:"/CMD_FILE_MANAGER",params:{action:"recursive_search"},schema:{path:e.Z.REQUIRED_STRING,search:e.Z.REQUIRED_STRING,type:e.Z.OPTIONAL_STRING},response:[],mapResponse:c})},"./js/api/commands/user/ftp.js":function(y,h,a){a.d(h,{$j:function(){return d},D0:function(){return p},Gw:function(){return u},T8:function(){return f},Ti:function(){return g},UH:function(){return i},VP:function(){return t},o1:function(){return c},sG:function(){return l}});var e=a("./js/api/command/index.js");const p=e.Z.get({id:"FTP_ACCOUNT",url:"/CMD_FTP_SHOW",domain:!0,schema:{user:e.Z.REQUIRED_STRING}}),f=e.Z.get({id:"FTP_ACCOUNTS",url:"/CMD_FTP",response:[],params:{full_json:!0},domain:!0,after:s=>s.flow(s.project({accounts:"users",anonLogin:"ANONLOGIN"}),s.mapProp("accounts",s.flow(s.mapValues((o,r)=>({login:r,...o})),s.toArray,s.mapArrayProps({suspended:s.convert.toAppBoolean}))))}),c=e.Z.post({url:"/CMD_FTP",params:{action:"create"},domain:!0,schema:{user:e.Z.REQUIRED_STRING,passwd:e.Z.REQUIRED_STRING,passwd2:e.Z.REQUIRED_STRING,type:e.Z.REQUIRED_STRING,custom_val:e.Z.OPTIONAL_STRING},notifySuccess:!1}),l=c.extend({params:{action:"modify"},schema:{passwd:e.Z.OPTIONAL_STRING,passwd2:e.Z.OPTIONAL_STRING}}),v=e.Z.select({url:"/CMD_FTP",domain:!0,params:{action:"delete"},notifySuccess:!1,notifyError:!1}),g=v.extend({params:{suspend:!0}}),i=v.extend({params:{unsuspend:!0}}),d=v.extend({params:{delete:!0}}),u=e.Z.get({id:"FTP_SETTINGS",url:"/CMD_FTP_SETTINGS",domain:!0,after:s=>o=>({access:s.convert.toAppBoolean(o.Anonymous),upload:s.convert.toAppBoolean(o.AnonymousUpload),message:s.flow(s.convert.toAppString,s.convert.toAppText)(o.message)})}),t=e.Z.post({url:"/CMD_FTP_SETTINGS",params:{action:"modify"},domain:!0,schema:{anon:e.Z.REQUIRED_BOOL,anonup:e.Z.REQUIRED_BOOL,message:e.Z.REQUIRED_STRING}}),n=e.Z.post({url:"/CMD_CHANGE_FTP_PASSWORD",schema:{ftp:e.Z.REQUIRED_STRING,password1:e.Z.REQUIRED_STRING,password2:e.Z.REQUIRED_STRING}})},"./js/api/commands/validation/index.js":function(y,h,a){a.d(h,{i9:function(){return o},ty:function(){return n},l7:function(){return u},OE:function(){return s},ub:function(){return D},oH:function(){return g},U5:function(){return i},k_:function(){return v},PR:function(){return t},uo:function(){return E},Jj:function(){return m},rV:function(){return r}});var e=a("./js/api/command/index.js"),p=a("../node_modules/punycode/punycode.es6.js"),f=a("./js/api/commands/converters/index.ts"),c={isValid(_){return typeof _.error=="undefined"},getMessage(_){return(0,f.S8)(_.error||"")}};const l=e.Z.get({url:"/CMD_JSON_VALIDATE",schema:{value:e.Z.REQUIRED_STRING},response:{valid:!0,message:""},mapResponse:{valid:c.isValid,message:c.getMessage}}),v=l.extend({id:"VALIDATE_FORWARDER",params:{type:"forwarder",ignore_system_default:!0}}),g=l.extend({id:"VALIDATE_EMAIL",params:{type:"email",check_mailing_list:!0},schema:{check_exists:{type:Boolean,required:!1,default:!0}}}),i=l.extend({id:"VALIDATE_FTP",params:{type:"ftp"},domain:!0}),d=l.extend({params:{type:"dns"},domain:!0,schema:{record:e.Z.REQUIRED_STRING}}),u=d.extend({id:"VALIDATE_DNS_VALUE",params:{check:"value",name:!0},domain:!0,schema:{value:e.Z.REQUIRED_STRING}}),t=u.extend({id:"VALIDATE_MX_VALUE",params:{record:"MX"},before:({value:_})=>({value:"10",mx_value:_})}),n=d.extend({id:"VALIDATE_DNS_NAME",params:{check:"name",value:!0,mx_value:!0},schema:{name:e.Z.REQUIRED_STRING,value:null}}),s=l.extend({id:"VALIDATE_DATABASE",params:{type:"dbname"}}),o=l.extend({id:"VALIDATE_DATABASE_USER",params:{type:"dbusername"}}),r=l.extend({id:"VALIDATE_USERNAME",params:{type:"username"}}),m=l.extend({id:"VALIDATE_SUBDOMAIN",domain:!0,params:{type:"subdomain"}}),E=l.extend({id:"VALIDATE_PASSWORD",params:{type:"password"}}),D=l.extend({id:"VALIDATE_DOMAIN",params:{type:"domain"},before:({value:_})=>({value:p.ZP.toASCII(_)})}),x=l.extend({id:"VALIDATE_IP_RANGE_LIST",params:{type:"ip_range_list"}})},"./js/api/commands/converters/customItems.ts":function(y,h,a){a.d(h,{CR:function(){return l}});var e=a("../node_modules/ramda/es/index.js"),p=a("./js/api/commands/converters/index.ts"),f=a("./js/api/commands/utils/transduce.ts"),c=a("./js/api/commands/converters/toSelectData.ts");const l=i=>{const d={name:i.name,type:i.type==="listbox"?"select":i.type,label:i.string,description:i.desc||"",value:i.type==="checkbox"?(0,p.sw)(i.checked||"no"):i.value||""};return d.type==="select"?e.BPw(d,(0,c.M1)(i.select||{})):d},v=i=>(0,f.vr)([(0,f.uD)(d=>/^item\d+val$/.test(d)),(0,f.r5)(d=>{const u=d,t=d.replace("val","txt"),n=i[u],s=i[t];return{[n]:s}})],Object.keys(i)),g=(i,d)=>e.qCK(t=>{const n={name:t.name,type:t.type==="listbox"?"select":t.type,description:t.desc||"",value:t.value||"",label:t.string};return t.type==="listbox"?(n.value=t.default,n.options=v(t)):t.type==="checkbox"&&(n.value=t.checked==="yes"),n},e.BPw({name:i}),(0,f.vr)([(0,f.r5)(t=>{const[n,s]=e.Vl2("=",t);return{[n]:s}})]),e.Vl2("&"))(d);h.ZP={fromObject:l,fromString:g}},"./js/api/commands/converters/index.ts":function(y,h,a){a.d(h,{l$:function(){return u.ZP},t0:function(){return e.t0},S8:function(){return e.S8},ql:function(){return e.ql},sw:function(){return e.sw},Qu:function(){return e.Qu},He:function(){return e.He},M1:function(){return d.M1},sf:function(){return n},cc:function(){return i}});var e=a("./js/api/commands/converters/primitive.ts"),p=a("../node_modules/monet/dist/monet.js"),f=a("./js/api/commands/types.ts");const c=s=>typeof s=="object"?p.Either.Right(s):p.Either.Left(new Error("Passed param is not an object")),l=s=>typeof s.usage=="string"?p.Either.Right(s):p.Either.Left(new Error("usage property is required")),v=s=>({usage:(0,e.He)(s.usage),limit:(0,e.Qu)(s.limit)}),g=({usage:s,limit:o})=>{let r=f.H.Normal;const m=Math.floor(s/o*100);return m>=100?r=f.H.OverUsed:m>80&&(r=f.H.AlmostUsed),{usage:s,limit:o,status:r}},i=s=>{const o=p.Either.Right(s).flatMap(c).flatMap(l).map(v).map(g);if(o.isLeft())throw o.left();return o.right()};var d=a("./js/api/commands/converters/toSelectData.ts"),u=a("./js/api/commands/converters/customItems.ts"),t=a("../node_modules/ramda/es/index.js");const n=s=>o=>{const{info:r}=o,m=t.CEd(["info"],o);return{columns:r.columns,rowsCount:Number(r.rows),rows:t.UID(s,t.VO0(m))}}},"./js/api/commands/converters/toSelectData.ts":function(y,h,a){a.d(h,{M1:function(){return g}});var e=a("../node_modules/monet/dist/monet.js"),p=a.n(e),f=a("./js/api/commands/utils/transduce.ts"),c=a("../node_modules/ramda/es/index.js");const l=i=>e.Maybe.Some(i).flatMap(d=>{const u=d.find(t=>t.selected==="yes");return u?e.Maybe.Some(u):e.Maybe.None()}).flatMap(d=>e.Maybe.fromNull(d.value)).orSome(""),v=(0,f.vr)([(0,f.r5)(i=>({[i.value]:i.text}))]),g=i=>{const d=(0,c.VO0)(i);return{value:l(d),options:v(d)}}},"./js/api/commands/types.ts":function(y,h,a){a.d(h,{H:function(){return e}});var e;(function(p){p.Normal="normal",p.AlmostUsed="almost_used",p.OverUsed="overused"})(e||(e={}))},"./js/api/commands/utils/transduce.ts":function(y,h,a){a.d(h,{Re:function(){return c},r5:function(){return p},uD:function(){return f},vr:function(){return d},zh:function(){return g}});var e=a("../node_modules/ramda/es/index.js");const p=u=>t=>(n,s)=>{const o=u(s);return t(n,o)},f=u=>t=>(n,s)=>u(s)?t(n,s):n,c=(u,t)=>(u.push(t),u),l=(u,t)=>e.BPw(u,t),v=(u,t,n,s)=>{const o=e.qCK(...n);return s.reduce(o(t),u)},g=e.WAo(v),i=g([],c),d=g({},l)},"./js/pages/user/ftp-accounts/_components/path-suggest.vue":function(y,h,a){a.d(h,{Z:function(){return u}});var e=function(){var n=this,s=n._self._c;return s("ui-input-group",{scopedSlots:n._u([{key:"additions:left",fn:function(){return[s("ui-button",{attrs:{disabled:"disabled"}},[n._v(`
            `+n._s(n.$_session.homeDir)+`
        `)])]},proxy:!0},{key:"input",fn:function(){return[s("input-autocomplete",{attrs:{value:n.path,values:n.folders,"suggest-after":0,focused:n.selected,"force-all-values":"","focus-on-mouse-over":!1},on:{input:n.onInput,"update:focused":function(o){n.selected=o}},nativeOn:{keydown:[function(o){return!o.type.indexOf("key")&&n._k(o.keyCode,"tab",9,o.key,"Tab")?null:(o.stopPropagation(),o.preventDefault(),n.autocomplete.apply(null,arguments))},function(o){return!o.type.indexOf("key")&&n._k(o.keyCode,"right",39,o.key,["Right","ArrowRight"])||"button"in o&&o.button!==2?null:(o.stopPropagation(),o.preventDefault(),n.autocomplete.apply(null,arguments))},function(o){return!o.type.indexOf("key")&&n._k(o.keyCode,"backspace",void 0,o.key,void 0)||!o.ctrlKey?null:(o.preventDefault(),n.smartBackspace.apply(null,arguments))}]}})]},proxy:!0}])})},p=[],f=a("./js/api/commands/fm.js"),c=a("../node_modules/ramda/es/index.js");const l=f.Dp.extend({notifyError:!1,params:{filemanager_du:0,action:"parent_tree"}});var v={name:"PathSuggest",model:{prop:"value",event:"update:value"},props:{value:{type:String,required:!0}},data(){return{path:this.value,selected:null,loaded:[],loading:!1,state:[]}},computed:{folders(){const t=this.getParent(this.path),n=c.hXT(c.sv4([s=>this.getParent(s)===t,s=>s.startsWith(this.path),s=>s!==this.path]));return c.zGw(n,c.HCG([c.zU3(c.kE),c.zU3(s=>s)]))(this.state)}},watch:{value(t){t!==this.path&&this.setModel(t)}},methods:{getParent(t){return`/${t.slice(1).split("/").slice(0,-1).join("/")}`},async treeRequest(t){const n=await l({path:t});return n instanceof Error?[]:n.map(c.vgT("path"))},async loadDir(t){if(this.loaded.includes(t))return;this.loaded.push(t),this.loading=!0;const n=await this.treeRequest(t);this.state=c.hXT(Boolean,c.jj$(c.zoF(this.state,n))),this.loading=!1},onInput(t){if(t===""){this.setModel(t);return}t[0]!=="/"&&(t=`/${t}`),this.$refs.dropdown,this.setModel(t)},setModel(t){if(this.folders.includes(t))this.loadDir(t);else{const n=this.getParent(t);this.loadDir(n)}this.path=t,this.$emit("update:value",t)},autocomplete(){const t=this.folders;if(t.length===0)return;if(this.selected!==null){this.setModel(this.folders[this.selected]);return}if(t.length===1){this.setModel(t[0]);return}let n=this.path;t.shift().replace(n,"").split("").forEach(o=>{const r=n+o;t.every(m=>m.startsWith(r))&&(n=r)}),this.setModel(n)},smartBackspace(){const t=this.getParent(this.path);this.setModel(t)}}},g=v,i=a("../node_modules/vue-loader/lib/runtime/componentNormalizer.js"),d=(0,i.Z)(g,e,p,!1,null,null,null),u=d.exports},"./js/pages/user/ftp-accounts/create.vue":function(y,h,a){a.r(h),a.d(h,{default:function(){return s}});var e=function(){var r=this,m=r._self._c;return m("app-page",{scopedSlots:r._u([{key:"footer:buttons",fn:function(){return[m("ui-button",{attrs:{theme:"safe","validate-group":"createFtpAccount"},on:{click:r.createFtpAccount}},[m("span",{domProps:{textContent:r._s(r.$gettext("Create"))}})])]},proxy:!0},{key:"default",fn:function(){return[m("app-page-section",[m("ui-form-element",{attrs:{group:"createFtpAccount",validators:{required:!0,isUserExists:r.isUserExists,regex:/^[a-z0-9\-]+$/i,api:r.$commands.validateFTP},vertical:r.clientStore.isPhone},scopedSlots:r._u([{key:"title",fn:function(){return[m("span",{domProps:{textContent:r._s(r.$gettext("FTP Username"))}})]},proxy:!0},{key:"content",fn:function(){return[m("input-text",{attrs:{suffix:`${r.ftpSep}${r.$p6e.toU(r.$domain)}`},model:{value:r.username,callback:function(E){r.username=E},expression:"username"}})]},proxy:!0},{key:"error:isUserExists",fn:function(){return[m("span",{domProps:{textContent:r._s(r.$gettext("User already exists"))}})]},proxy:!0},{key:"error:regex",fn:function(){return[m("span",{domProps:{textContent:r._s(r.$gettext("Wrong username format"))}})]},proxy:!0}])}),r._v(" "),m("ui-form-element",{attrs:{group:"createFtpAccount",validators:{required:!0,api:r.$commands.validatePassword},vertical:r.clientStore.isPhone},scopedSlots:r._u([{key:"title",fn:function(){return[m("span",{domProps:{textContent:r._s(r.$gettext("Enter Password"))}})]},proxy:!0},{key:"content",fn:function(){return[m("input-password",{directives:[{name:"flex-item",rawName:"v-flex-item",value:{grow:!0},expression:"{ grow: true }"}],ref:"password",attrs:{"show-generator":""},model:{value:r.password,callback:function(E){r.password=E},expression:"password"}})]},proxy:!0}])}),r._v(" "),m("ui-form-element",{attrs:{underline:!1},scopedSlots:r._u([{key:"content",fn:function(){return[m("ui-tabs",{attrs:{radio:"",tabs:r.ftpOptions,selected:r.type},on:{"update:selected":function(E){r.type=E}},scopedSlots:r._u([{key:"tab:custom",fn:function(){return[m("ui-form-element",{attrs:{underline:!1,"hide-title":r.clientStore.isPhone},scopedSlots:r._u([r.clientStore.isPhone?null:{key:"title",fn:function(){return[m("span",{domProps:{textContent:r._s(r.$gettext("Directory"))}})]},proxy:!0},{key:"content",fn:function(){return[m("path-suggest",{model:{value:r.customDir,callback:function(E){r.customDir=E},expression:"customDir"}})]},proxy:!0}],null,!0)})]},proxy:!0}])})]},proxy:!0}])})],1)]},proxy:!0}])})},p=[],f=a("./js/stores/index.ts"),c=a("./js/api/commands/user/ftp.js"),l=a("./js/api/commands/validation/index.js"),v=a("./js/modules/utils/other.js"),g=a("./js/vue-globals/helpers.js"),i=a("./js/pages/user/ftp-accounts/_components/path-suggest.vue"),d={name:"CreateFtpAccount",preload:[c.T8],components:{PathSuggest:i.Z},api:[{command:c.T8,bind:"ftp"}],commands:{validateFTP:l.U5,validatePassword:l.uo},data(){return{username:"",password:"",type:"domain",customDir:""}},computed:{existingUsers(){return this.$api.ftp.accounts.map(({user:o})=>o)},customDirPrefix(){return this.$_session.homeDir},ftpSep(){return this.$_session.ftpSeparator},ftpOptions(){return[{id:"domain",label:this.$gettext("Domain"),desc:this.$gettext("FTP account with the root directory in the domains home directory (one up from the public_html)")},{id:"ftp",label:this.$gettext("FTP"),desc:this.$gettext("FTP account with the root directory in the domains public_ftp directory")},{id:"user",label:this.$gettext("User"),desc:this.$gettext("FTP account with the root directory as the user name in the public_html directory")},{id:"custom",label:this.$gettext("Custom"),desc:this.$gettext("Please provide custom directory in the field below")}]},...(0,f.Kc)(["client"])},methods:{async createFtpAccount(){const o=await(0,c.o1)({user:this.username,passwd:this.password,passwd2:this.password,type:this.type,custom_val:`${this.customDirPrefix}${this.customDir}`});if(!(o instanceof Error)){const m=`<table class="table-elem">${[[this.$gettext("Login"),o.login],[this.$gettext("Password"),o.passwd],[this.$gettext("Path"),o.path]].map(([D,x])=>`<tr><td>${D}:</td><td>${x}</td></tr>`).join("")}</table>`,E={title:this.$gettext("FTP account created"),content:m,extended:!0};this.$notifications.success(E),g.uY.emit("request:results",E),this.$router.push({name:"user/ftp-accounts"})}},isUserExists(o){return!this.existingUsers.includes(o)},copyPassword(){(0,v.ml)(this.password)&&this.$nextTick(()=>{this.$notifications.success({title:"Password copied!"})})}}},u=d,t=a("../node_modules/vue-loader/lib/runtime/componentNormalizer.js"),n=(0,t.Z)(u,e,p,!1,null,null,null),s=n.exports}}]);
