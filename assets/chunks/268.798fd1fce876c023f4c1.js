"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[268],{"../node_modules/date-fns/esm/formatDistance/index.js":function(j,$,s){s.d($,{Z:function(){return n}});var D=s("../node_modules/date-fns/esm/_lib/defaultOptions/index.js"),l=s("../node_modules/date-fns/esm/toDate/index.js"),f=s("../node_modules/date-fns/esm/_lib/requiredArgs/index.js");function p(e,o){(0,f.Z)(2,arguments);var a=(0,l.Z)(e),m=(0,l.Z)(o),_=a.getTime()-m.getTime();return _<0?-1:_>0?1:_}function x(e,o){(0,f.Z)(2,arguments);var a=(0,l.Z)(e),m=(0,l.Z)(o),_=a.getFullYear()-m.getFullYear(),w=a.getMonth()-m.getMonth();return _*12+w}function g(e){(0,f.Z)(1,arguments);var o=(0,l.Z)(e);return o.setHours(23,59,59,999),o}function y(e){(0,f.Z)(1,arguments);var o=(0,l.Z)(e),a=o.getMonth();return o.setFullYear(o.getFullYear(),a+1,0),o.setHours(23,59,59,999),o}function M(e){(0,f.Z)(1,arguments);var o=(0,l.Z)(e);return g(o).getTime()===y(o).getTime()}function S(e,o){(0,f.Z)(2,arguments);var a=(0,l.Z)(e),m=(0,l.Z)(o),_=p(a,m),w=Math.abs(x(a,m)),u;if(w<1)u=0;else{a.getMonth()===1&&a.getDate()>27&&a.setDate(30),a.setMonth(a.getMonth()-_*w);var Z=p(a,m)===-_;M((0,l.Z)(e))&&w===1&&p(e,m)===1&&(Z=!1),u=_*(w-Number(Z))}return u===0?0:u}function T(e,o){return(0,f.Z)(2,arguments),(0,l.Z)(e).getTime()-(0,l.Z)(o).getTime()}var k={ceil:Math.ceil,round:Math.round,floor:Math.floor,trunc:function(o){return o<0?Math.ceil(o):Math.floor(o)}},O="trunc";function E(e){return e?k[e]:k[O]}function I(e,o,a){(0,f.Z)(2,arguments);var m=T(e,o)/1e3;return E(a==null?void 0:a.roundingMethod)(m)}var R=s("../node_modules/date-fns/esm/_lib/defaultLocale/index.js");function b(e,o){if(e==null)throw new TypeError("assign requires that input parameter not be null or undefined");for(var a in o)Object.prototype.hasOwnProperty.call(o,a)&&(e[a]=o[a]);return e}function B(e){return b({},e)}var r=s("../node_modules/date-fns/esm/_lib/getTimezoneOffsetInMilliseconds/index.js"),d=1440,v=2520,i=43200,t=86400;function n(e,o,a){var m,_;(0,f.Z)(2,arguments);var w=(0,D.j)(),u=(m=(_=a==null?void 0:a.locale)!==null&&_!==void 0?_:w.locale)!==null&&m!==void 0?m:R.Z;if(!u.formatDistance)throw new RangeError("locale must contain formatDistance property");var Z=p(e,o);if(isNaN(Z))throw new RangeError("Invalid time value");var c=b(B(a),{addSuffix:Boolean(a==null?void 0:a.addSuffix),comparison:Z}),C,A;Z>0?(C=(0,l.Z)(o),A=(0,l.Z)(e)):(C=(0,l.Z)(e),A=(0,l.Z)(o));var P=I(A,C),L=((0,r.Z)(A)-(0,r.Z)(C))/1e3,h=Math.round((P-L)/60),F;if(h<2)return a!=null&&a.includeSeconds?P<5?u.formatDistance("lessThanXSeconds",5,c):P<10?u.formatDistance("lessThanXSeconds",10,c):P<20?u.formatDistance("lessThanXSeconds",20,c):P<40?u.formatDistance("halfAMinute",0,c):P<60?u.formatDistance("lessThanXMinutes",1,c):u.formatDistance("xMinutes",1,c):h===0?u.formatDistance("lessThanXMinutes",1,c):u.formatDistance("xMinutes",h,c);if(h<45)return u.formatDistance("xMinutes",h,c);if(h<90)return u.formatDistance("aboutXHours",1,c);if(h<d){var U=Math.round(h/60);return u.formatDistance("aboutXHours",U,c)}else{if(h<v)return u.formatDistance("xDays",1,c);if(h<i){var W=Math.round(h/d);return u.formatDistance("xDays",W,c)}else if(h<t)return F=Math.round(h/i),u.formatDistance("aboutXMonths",F,c)}if(F=S(A,C),F<12){var X=Math.round(h/i);return u.formatDistance("xMonths",X,c)}else{var z=F%12,N=Math.floor(F/12);return z<3?u.formatDistance("aboutXYears",N,c):z<9?u.formatDistance("overXYears",N,c):u.formatDistance("almostXYears",N+1,c)}}},"./js/composables/dateFilter.ts":function(j,$,s){s.d($,{W:function(){return x},f:function(){return f.f}});var D=s("../node_modules/ramda/es/index.js"),l=s("../node_modules/date-fns/esm/format/index.js"),f=s("./js/modules/date-formats.ts"),p=s("./js/modules/customizations/date-formats/default.ts");const x=D.WAo((g,y)=>{if(y)try{return(0,l.Z)(y,f.f.value[g])}catch(M){return console.warn(`Given ${g} format is incorrect:
${M.message}`),(0,l.Z)(y,p.d[g])}return""})},"./js/composables/filters.ts":function(j,$,s){s.d($,{Q0:function(){return I},aS:function(){return b},d5:function(){return R},eB:function(){return k},hT:function(){return S},kC:function(){return M},n9:function(){return E},zM:function(){return T}});var D=s("../node_modules/date-fns/esm/formatDistance/index.js"),l=s("../node_modules/punycode/punycode.es6.js"),f=s("./js/composables/dateFilter.ts"),p=s("./js/composables/gettext.ts");const{$gettext:x,$ngettext:g,$gettextInterpolate:y}=(0,p.Z)(),M=r=>{var d;return r?((d=r.at(0))===null||d===void 0?void 0:d.toUpperCase())+r.slice(1):""},S=(r,d="datetime")=>(0,f.W)(d,r),T=r=>(0,D.Z)(r,new Date),k=(r,d=1024)=>{const v=Number(r);if(!v)return"0 B";const i=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],t=Math.floor(Math.log(v)/Math.log(d));return`${parseFloat((v/d**t).toFixed(2))} ${i[t]}`},O=r=>{try{return(0,l.xX)(r)}catch(d){return r}},E=r=>(0,l.xX)(r),I=r=>{if(!r||!r.includes("@"))return r;const[d,v]=r.split("@");return[d,O(v)].join("@")},R=r=>{if(r<60)return x("less than a minute");const d=Math.floor(r/60)%60,v=Math.floor(r/3600)%24,i=Math.floor(r/(3600*24)),t=[i?g("%{days} day","%{days} days",i):null,v?g("%{hours} hour","%{hours} hours",v):null,d?g("%{minutes} minute","%{minutes} minutes",d):null].filter(Boolean).join(", ");return y(t,{days:i,hours:v,minutes:d})},b=(r,d)=>r.length<=d?r:`${r.substring(0,d)}...`,B=()=>({capitalize:M,date:S,distanceFromNow:T,humanReadableSize:k,p6eUnicode:E,p6eUnicodeEmail:I,formatUptime:R,truncateString:b})},"./js/pages/user/email/filters.vue":function(j,$,s){s.r($),s.d($,{default:function(){return v}});var D=function(){var t=this,n=t._self._c;return n("app-page",{scopedSlots:t._u([{key:"default",fn:function(){return[n("app-page-section",[n("ui-r-table",t._b({key:`${t.add.type}-type-select`,attrs:{"checked-rows":t.checkedRows,editable:!1},on:{"update:checkedRows":function(e){t.checkedRows=e}},scopedSlots:t._u([{key:"table:actions",fn:function(){return[n("ui-table-action",{on:{click:function(e){t.$dialog("DELETE_ITEMS_DIALOG").open()}}},[n("span",{domProps:{textContent:t._s(t.$gettext("Delete"))}})])]},proxy:!0},{key:"col:type",fn:function({type:e}){return[t._v(`
                    `+t._s(t.filterTypeStrings[e].label)+`
                `)]}},{key:"col:value",fn:function({value:e,item:o}){return[o.type==="size"?[t._v(`
                        `+t._s(t.humanReadableSize(e))+`
                    `)]:o.type==="email"?[t._v(`
                        `+t._s(t.p6eUnicodeEmail(e))+`
                    `)]:[t._v(`
                        `+t._s(e)+`
                    `)]]}},t.clientStore.isPhone?null:{key:"col:after:type",fn:function(){return[n("ui-form-element",{attrs:{vertical:""},scopedSlots:t._u([{key:"content",fn:function(){return[n("input-select",{directives:[{name:"flex-item",rawName:"v-flex-item",value:{grow:!0},expression:"{ grow: true }"}],attrs:{options:{email:t.$gettext("E-mail"),domain:t.$gettext("Domain"),word:t.$gettext("Stop word"),size:t.$gettext("Size")}},model:{value:t.add.type,callback:function(e){t.$set(t.add,"type",e)},expression:"add.type"}}),t._v(" "),n("ui-tooltip",{directives:[{name:"flex-item",rawName:"v-flex-item",value:{grow:!1},expression:"{ grow: false }"},{name:"margin",rawName:"v-margin",value:[0,1],expression:"[0, 1]"}],attrs:{theme:"primary"}},[t._v(`
                                `+t._s(t.filterTypeStrings[t.add.type].tooltip)+`
                                `),t.add.type==="word"?n("p",{domProps:{textContent:t._s(t.$gettext('Note: the word filter matches partial words. For example, if you block the word "put" and the email contains "computer", then the email will be blocked. If you expect it to be its own word, then block " put ", with spaces beside it to avoid partial matching.'))}}):t._e()])]},proxy:!0}],null,!1,3416679607)})]},proxy:!0},{key:"col:after:value",fn:function(){return[t.showAddFilter&&!t.clientStore.isPhone?n("filter-input",{attrs:{type:t.add.type},on:{block:t.addFilter},model:{value:t.add.value,callback:function(e){t.$set(t.add,"value",e)},expression:"add.value"}}):t._e()]},proxy:!0}],null,!0)},"ui-r-table",{rows:t.$api.filters.rows,columns:[{id:"type",label:t.$gettext("Block By"),width:"200px"},{id:"value",label:t.$gettext("Value"),grow:!0}],rowsCount:t.$api.filters.rows.length,isCheckable:!0,isSortable:!1,verticalLayout:t.clientStore.isPhone},!1)),t._v(" "),t.clientStore.isPhone?[n("ui-form-element",{attrs:{vertical:""},scopedSlots:t._u([{key:"title",fn:function(){return[n("span",{domProps:{textContent:t._s(t.$gettext("Block By"))}})]},proxy:!0},{key:"content",fn:function(){return[n("input-select",{attrs:{options:{email:t.$gettext("E-mail"),domain:t.$gettext("Domain"),word:t.$gettext("Stop word"),size:t.$gettext("Size")}},model:{value:t.add.type,callback:function(e){t.$set(t.add,"type",e)},expression:"add.type"}})]},proxy:!0}],null,!1,280737364)}),t._v(" "),n("ui-form-element",{attrs:{vertical:""},scopedSlots:t._u([{key:"title",fn:function(){return[n("span",{domProps:{textContent:t._s(t.$gettext("Value"))}})]},proxy:!0},{key:"content",fn:function(){return[t.showAddFilter?n("filter-input",{attrs:{type:t.add.type},on:{block:t.addFilter},model:{value:t.add.value,callback:function(e){t.$set(t.add,"value",e)},expression:"add.value"}}):t._e()]},proxy:!0}],null,!1,4276590350)}),t._v(" "),n("ui-form-element",{attrs:{vertical:""},scopedSlots:t._u([{key:"content",fn:function(){return[n("span",[t._v(`
                            `+t._s(t.filterTypeStrings[t.add.type].tooltip)+`
                            `),t.add.type==="word"?n("p",{domProps:{textContent:t._s(t.$gettext('Note: the word filter matches partial words. For example, if you block the word "put" and the email contains "computer", then the email will be blocked. If you expect it to be its own word, then block " put ", with spaces beside it to avoid partial matching.'))}}):t._e()])]},proxy:!0}],null,!1,2277079491)})]:t._e()],2),t._v(" "),n("app-page-section",{scopedSlots:t._u([{key:"section:title",fn:function(){return[n("span",{domProps:{textContent:t._s(t.$gettext("Options"))}})]},proxy:!0}])},[t._v(" "),n("ui-form-element",{scopedSlots:t._u([{key:"title",fn:function(){return[n("div",{directives:[{name:"flex",rawName:"v-flex",value:{cross:"center"},expression:"{ cross: 'center' }"},{name:"gutter",rawName:"v-gutter",value:1,expression:"1"}]},[n("span",{domProps:{textContent:t._s(t.$gettext("Adult Filter:"))}}),t._v(" "),n("ui-tooltip",[n("span",{domProps:{textContent:t._s(t.$gettext("Blocks out common adult phrases, words, an addresses"))}})])],1)]},proxy:!0},{key:"content",fn:function(){return[n("input-checkbox",{on:{change:t.updateAdult},model:{value:t.adult,callback:function(e){t.adult=e},expression:"adult"}},[n("span",{domProps:{textContent:t._s(t.adult?t.$gettext("Enabled"):t.$gettext("Disabled"))}})])]},proxy:!0}])}),t._v(" "),n("ui-form-element",{scopedSlots:t._u([{key:"title",fn:function(){return[n("span",{domProps:{textContent:t._s(t.$gettext("Action for filter matches:"))}})]},proxy:!0},{key:"content",fn:function(){return[n("div",{directives:[{name:"flex",rawName:"v-flex",value:{cross:t.clientStore.isPhone?"start":"center",dir:t.clientStore.isPhone?"column":"row"},expression:`{
                            cross: clientStore.isPhone ? 'start' : 'center',
                            dir: clientStore.isPhone ? 'column' : 'row',
                        }`},{name:"gutter",rawName:"v-gutter",value:[0,1],expression:"[0, 1]"}]},[n("input-radio",{attrs:{value:"drop"},on:{change:t.updateAction},model:{value:t.action,callback:function(e){t.action=e},expression:"action"}},[n("span",{domProps:{textContent:t._s(t.$gettext("Drop E-mail"))}})]),t._v(" "),n("input-radio",{attrs:{value:"email"},on:{change:t.updateAction},model:{value:t.action,callback:function(e){t.action=e},expression:"action"}},[n("span",{domProps:{textContent:t._s(t.$gettext("Send to spambox"))}})])],1)]},proxy:!0}])})],1),t._v(" "),n("ui-dialog-delete-items",{attrs:{subject:t.$ngettext("filter","filters",t.checkedRows.length)},on:{"click:confirm":t.deleteFilters}})]},proxy:!0}])})},l=[],f=s("./js/stores/index.ts"),p=s("./js/api/command/index.js");const x=p.Z.get({id:"FILTERS",url:"/CMD_EMAIL_FILTER",params:{bytes:!0},domain:!0,after:i=>t=>({options:{action:(t.action||"action=drop").replace("action=",""),adult:t.adult==="ON"},rows:i.toArray(t.filters)})}),g=p.Z.post({url:"/CMD_EMAIL_FILTER",params:{action:"add"},domain:!0,schema:{type:p.Z.REQUIRED_STRING,value:p.Z.REQUIRED_STRING}}),y=p.Z.post({url:"/CMD_EMAIL_FILTER",domain:!0,params:{option:{...p.Z.REQUIRED_STRING,validator:i=>["adult","action"].includes(i)},value:{required:!0}},before:({option:i,value:t})=>i==="adult"?{action:"adult",enabled:t,add:t?"Enable":"Disable"}:{action:"action",value:t}}),M=p.Z.select({url:"/CMD_EMAIL_FILTER",params:{action:"delete"},domain:!0});var S=function(){var t=this,n=t._self._c;return n("ui-form-element",t._b({key:t.type,attrs:{vertical:"",group:"filterInput"},scopedSlots:t._u([{key:"content",fn:function(){return[n("ui-input-group",{scopedSlots:t._u([{key:"input",fn:function(){return[n(t.input,{key:t.type,tag:"component",attrs:{units:"KB"},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.submit.apply(null,arguments)}},model:{value:t.dataValue,callback:function(e){t.dataValue=e},expression:"dataValue"}})]},proxy:!0},{key:"additions:right",fn:function(){return[n("ui-button",{attrs:{theme:"safe","validate-group":"filterInput"},on:{click:t.submit}},[n("span",{domProps:{textContent:t._s(t.$gettext("Block"))}})])]},proxy:!0}])})]},proxy:!0},{key:"error:email",fn:function(){return[n("span",{domProps:{textContent:t._s(t.$gettext("Should be valid email"))}})]},proxy:!0},{key:"error:domain",fn:function(){return[n("span",{domProps:{textContent:t._s(t.$gettext("Should be valid domain"))}})]},proxy:!0}])},"ui-form-element",{validators:t.validators},!1))},T=[],k={props:{value:{type:[String,Number],required:!0},type:{type:String,required:!0}},data(){return{dataValue:this.value}},computed:{input(){return this.type==="size"?"input-size":"input-text"},validators(){const i={required:!0};return(this.type==="email"||this.type==="domain")&&(i[this.type]=!0),i}},watch:{type(){this.dataValue="",this.$emit("input","")},dataValue(i){this.$emit("input",i)}},methods:{submit(){this.$emit("block")}}},O=k,E=s("../node_modules/vue-loader/lib/runtime/componentNormalizer.js"),I=(0,E.Z)(O,S,T,!1,null,null,null),R=I.exports,b=s("./js/composables/filters.ts"),B={preload:x,api:[{command:x,bind:"filters"}],components:{FilterInput:R},data(){return{add:{type:"email",value:""},adult:!1,action:"drop",checkedRows:[],showAddFilter:!0}},computed:{checkedFilters(){return this.checkedRows.map(i=>this.$api.filters.rows.indexOf(i))},...(0,f.Kc)(["client"])},watch:{$domain:{async handler(){await x(),this.checkedRows=[],this.adult=this.$api.filters.options.adult,this.action=this.$api.filters.options.action}}},created(){this.adult=this.$api.filters.options.adult,this.action=this.$api.filters.options.action,this.$watch("add.type",()=>{this.add.value=""}),this.filterTypeStrings={email:{label:this.$gettext("E-mail"),tooltip:this.$gettext("Block a specific E-mail address")},domain:{label:this.$gettext("Domain"),tooltip:this.$gettext("Block mail from an entire domain")},word:{label:this.$gettext("Stop word"),tooltip:this.$gettext("Block all e-mails containing stop words")},size:{label:this.$gettext("Size"),tooltip:this.$gettext("Block all e-mails larger than (KB)")}}},methods:{p6eUnicodeEmail:b.Q0,humanReadableSize:b.eB,reloadFilters(){x(),this.checkedRows=[]},updateAdult(){y({option:"adult",value:this.adult})},updateAction(){y({option:"action",value:this.action})},async addFilter(){this.showAddFilter=!1,this.$nextTick(()=>{this.showAddFilter=!0});let{value:i}=this.add;const{type:t}=this.add;if(i=i.toString(),this.add.type==="email"?i=this.$p6e.email2ascii(i):this.add.type==="size"&&(i=`${i}B`),await g({type:this.add.type,value:i})){if(Object.assign(this.$data,this.$options.data.apply(this)),this.adult=this.$api.filters.options.adult,this.action=this.$api.filters.options.action,t==="size"){const e=this.$api.filters.rows.filter(o=>o.type==="size");e.length&&await M({select:e.map(o=>this.$api.filters.rows.indexOf(o))})}this.reloadFilters(),this.add.type=t}},async deleteFilters(){await M({select:this.checkedFilters})&&(this.checkedRows=[],this.reloadFilters())}}},r=B,d=(0,E.Z)(r,D,l,!1,null,null,null),v=d.exports}}]);
